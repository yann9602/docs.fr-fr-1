---
title: "Dépannage des problèmes liés à l'interopérabilité (Visual Basic)"
ms.custom: 
ms.date: 07/20/2015
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: devlang-visual-basic
ms.topic: article
helpviewer_keywords:
- interop, deploying assemblies
- assemblies [Visual Basic]
- interop, installing assemblies that share components
- COM objects, troubleshooting
- interop, sharing components
- troubleshooting interoperability [Visual Basic]
- interoperability, troubleshooting
- COM interop [Visual Basic], troubleshooting
- assemblies [Visual Basic], deploying
- troubleshooting Visual Basic, interoperability
- interop assemblies
- interoperability, sharing components
- shared components, using with assemblies
ms.assetid: b324cc1e-b03c-4f39-aea6-6a6d5bfd0e37
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
ms.openlocfilehash: 988d07fe08a6a78ae295d13f694c55a3b8f9d2e4
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2017
---
# <a name="troubleshooting-interoperability-visual-basic"></a><span data-ttu-id="342c7-102">Dépannage des problèmes liés à l'interopérabilité (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="342c7-102">Troubleshooting Interoperability (Visual Basic)</span></span>
<span data-ttu-id="342c7-103">Lorsque vous interagissez entre COM et le code managé de la [!INCLUDE[dnprdnshort](~/includes/dnprdnshort-md.md)], vous pouvez rencontrer un ou plusieurs des problèmes courants suivants.</span><span class="sxs-lookup"><span data-stu-id="342c7-103">When you interoperate between COM and the managed code of the [!INCLUDE[dnprdnshort](~/includes/dnprdnshort-md.md)], you may encounter one or more of the following common issues.</span></span>  
  
##  <span data-ttu-id="342c7-104"><a name="vbconinteroperabilitymarshalinganchor1"></a>Marshaling d’interopérabilité</span><span class="sxs-lookup"><span data-stu-id="342c7-104"><a name="vbconinteroperabilitymarshalinganchor1"></a> Interop Marshaling</span></span>  
 <span data-ttu-id="342c7-105">Dans certains cas, vous devrez peut-être utiliser des types de données qui ne sont pas dans le cadre de la [!INCLUDE[dnprdnshort](~/includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="342c7-105">At times, you may have to use data types that are not part of the [!INCLUDE[dnprdnshort](~/includes/dnprdnshort-md.md)].</span></span> <span data-ttu-id="342c7-106">Assemblys d’interopérabilité gèrent la plupart du travail pour les objets COM, mais vous devrez peut-être contrôler les types de données qui sont utilisées lorsque des objets gérés sont exposées à COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-106">Interop assemblies handle most of the work for COM objects, but you may have to control the data types that are used when managed objects are exposed to COM.</span></span> <span data-ttu-id="342c7-107">Par exemple, les structures de bibliothèques de classes doivent indiquer la `BStr` non managé de type sur les chaînes envoyées à des objets COM créés par Visual Basic 6.0 et versions antérieures.</span><span class="sxs-lookup"><span data-stu-id="342c7-107">For example, structures in class libraries must specify the `BStr` unmanaged type on strings sent to COM objects created by Visual Basic 6.0 and earlier versions.</span></span> <span data-ttu-id="342c7-108">Dans ce cas, vous pouvez utiliser la <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribut pour que les types managés à exposer en tant que types non managés.</span><span class="sxs-lookup"><span data-stu-id="342c7-108">In such cases, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to cause managed types to be exposed as unmanaged types.</span></span>  
  
##  <span data-ttu-id="342c7-109"><a name="vbconinteroperabilitymarshalinganchor2"></a>Exportation des chaînes de longueur fixe au Code non managé</span><span class="sxs-lookup"><span data-stu-id="342c7-109"><a name="vbconinteroperabilitymarshalinganchor2"></a> Exporting Fixed-Length Strings to Unmanaged Code</span></span>  
 <span data-ttu-id="342c7-110">Dans Visual Basic 6.0 et versions antérieures, les chaînes sont exportées à des objets COM en tant que séquence d’octets sans caractère null de fin.</span><span class="sxs-lookup"><span data-stu-id="342c7-110">In Visual Basic 6.0 and earlier versions, strings are exported to COM objects as sequences of bytes without a null termination character.</span></span> <span data-ttu-id="342c7-111">Pour la compatibilité avec d’autres langages, Visual Basic .NET inclut un caractère de fin lors de l’exportation de chaînes.</span><span class="sxs-lookup"><span data-stu-id="342c7-111">For compatibility with other languages, Visual Basic .NET includes a termination character when exporting strings.</span></span> <span data-ttu-id="342c7-112">La meilleure façon de résoudre cette incompatibilité consiste à exporter les chaînes qui n’ont pas le caractère de fin comme des tableaux de `Byte` ou `Char`.</span><span class="sxs-lookup"><span data-stu-id="342c7-112">The best way to address this incompatibility is to export strings that lack the termination character as arrays of `Byte` or `Char`.</span></span>  
  
##  <span data-ttu-id="342c7-113"><a name="vbconinteroperabilitymarshalinganchor3"></a>Exportation de hiérarchies d’héritage</span><span class="sxs-lookup"><span data-stu-id="342c7-113"><a name="vbconinteroperabilitymarshalinganchor3"></a> Exporting Inheritance Hierarchies</span></span>  
 <span data-ttu-id="342c7-114">Hiérarchies vous pouvez aplatir lorsqu’elle est exposée en tant qu’objets COM de classe managée.</span><span class="sxs-lookup"><span data-stu-id="342c7-114">Managed class hierarchies flatten out when exposed as COM objects.</span></span> <span data-ttu-id="342c7-115">Par exemple, si vous définissez une classe de base avec un membre, puis héritez de la classe de base dans une classe dérivée qui est exposée comme un objet COM, les clients qui utilisent la classe dérivée de l’objet COM ne sera pas en mesure d’utiliser les membres hérités.</span><span class="sxs-lookup"><span data-stu-id="342c7-115">For example, if you define a base class with a member, and then inherit the base class in a derived class that is exposed as a COM object, clients that use the derived class in the COM object will not be able to use the inherited members.</span></span> <span data-ttu-id="342c7-116">Les membres de classe de base est accessible à partir des objets COM uniquement en tant qu’instances d’une classe de base et uniquement si la classe de base est également créée comme un objet COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-116">Base class members can be accessed from COM objects only as instances of a base class, and then only if the base class is also created as a COM object.</span></span>  
  
## <a name="overloaded-methods"></a><span data-ttu-id="342c7-117">Méthodes surchargées</span><span class="sxs-lookup"><span data-stu-id="342c7-117">Overloaded Methods</span></span>  
 <span data-ttu-id="342c7-118">Bien que vous puissiez créer des méthodes surchargées avec [!INCLUDE[vbprvb](~/includes/vbprvb-md.md)], elles ne sont pas prises en charge par COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-118">Although you can create overloaded methods with [!INCLUDE[vbprvb](~/includes/vbprvb-md.md)], they are not supported by COM.</span></span> <span data-ttu-id="342c7-119">Lorsqu’une classe qui contient des méthodes surchargées est exposée comme un objet COM, les nouveaux noms de méthodes sont générés pour les méthodes surchargées.</span><span class="sxs-lookup"><span data-stu-id="342c7-119">When a class that contains overloaded methods is exposed as a COM object, new method names are generated for the overloaded methods.</span></span>  
  
 <span data-ttu-id="342c7-120">Par exemple, considérez une classe qui a deux surcharges de la `Synch` (méthode).</span><span class="sxs-lookup"><span data-stu-id="342c7-120">For example, consider a class that has two overloads of the `Synch` method.</span></span> <span data-ttu-id="342c7-121">Lorsque la classe est exposée comme un objet COM, les nouveaux noms de méthode générée peut être `Synch` et `Synch_2`.</span><span class="sxs-lookup"><span data-stu-id="342c7-121">When the class is exposed as a COM object, the new generated method names could be `Synch` and `Synch_2`.</span></span>  
  
 <span data-ttu-id="342c7-122">Le changement de nom peut provoquer deux problèmes pour les consommateurs de l’objet COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-122">The renaming can cause two problems for consumers of the COM object.</span></span>  
  
1.  <span data-ttu-id="342c7-123">Les clients ne peuvent pas attendre les noms de méthode générée.</span><span class="sxs-lookup"><span data-stu-id="342c7-123">Clients might not expect the generated method names.</span></span>  
  
2.  <span data-ttu-id="342c7-124">Les noms de méthode générée dans la classe exposée comme un objet COM peuvent changer lorsque de nouvelles surcharges sont ajoutés à la classe ou de sa classe de base.</span><span class="sxs-lookup"><span data-stu-id="342c7-124">The generated method names in the class exposed as a COM object can change when new overloads are added to the class or its base class.</span></span> <span data-ttu-id="342c7-125">Cela peut entraîner des problèmes de versioning.</span><span class="sxs-lookup"><span data-stu-id="342c7-125">This can cause versioning problems.</span></span>  
  
 <span data-ttu-id="342c7-126">Pour résoudre les problèmes, attribuez un nom unique, au lieu d’utiliser la surcharge, lorsque vous développez des objets qui seront exposées en tant qu’objets COM à chaque méthode.</span><span class="sxs-lookup"><span data-stu-id="342c7-126">To solve both problems, give each method a unique name, instead of using overloading, when you develop objects that will be exposed as COM objects.</span></span>  
  
##  <span data-ttu-id="342c7-127"><a name="vbconinteroperabilitymarshalinganchor4"></a>Utilisation d’objets COM via les assemblys d’interopérabilité</span><span class="sxs-lookup"><span data-stu-id="342c7-127"><a name="vbconinteroperabilitymarshalinganchor4"></a> Use of COM Objects Through Interop Assemblies</span></span>  
 <span data-ttu-id="342c7-128">Vous utilisez des assemblys PIA presque comme s’ils sont des remplacements de code managé pour les objets COM qu’ils représentent.</span><span class="sxs-lookup"><span data-stu-id="342c7-128">You use interop assemblies almost as if they are managed code replacements for the COM objects they represent.</span></span> <span data-ttu-id="342c7-129">Toutefois, car elles sont des wrappers et des objets COM réels pas, il existe certaines différences entre l’utilisation d’assemblys PIA et standard.</span><span class="sxs-lookup"><span data-stu-id="342c7-129">However, because they are wrappers and not actual COM objects, there are some differences between using interop assemblies and standard assemblies.</span></span> <span data-ttu-id="342c7-130">Ces différences comprennent l’exposition des classes et des types de données pour les paramètres et valeurs de retour.</span><span class="sxs-lookup"><span data-stu-id="342c7-130">These areas of difference include the exposure of classes, and data types for parameters and return values.</span></span>  
  
##  <span data-ttu-id="342c7-131"><a name="vbconinteroperabilitymarshalinganchor5"></a>Classes exposées en tant que les deux Interfaces et Classes</span><span class="sxs-lookup"><span data-stu-id="342c7-131"><a name="vbconinteroperabilitymarshalinganchor5"></a> Classes Exposed as Both Interfaces and Classes</span></span>  
 <span data-ttu-id="342c7-132">Contrairement aux classes dans les assemblys standard, les classes COM sont exposées dans les assemblys PIA comme une interface et une classe qui représente la classe COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-132">Unlike classes in standard assemblies, COM classes are exposed in interop assemblies as both an interface and a class that represents the COM class.</span></span> <span data-ttu-id="342c7-133">Nom de l’interface est identique à celui de la classe COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-133">The interface's name is identical to that of the COM class.</span></span> <span data-ttu-id="342c7-134">Le nom de la classe d’interopérabilité est le même que celui de la classe COM d’origine, mais avec le mot « Classe » ajouté.</span><span class="sxs-lookup"><span data-stu-id="342c7-134">The name of the interop class is the same as that of the original COM class, but with the word "Class" appended.</span></span> <span data-ttu-id="342c7-135">Par exemple, supposons que vous avez un projet avec une référence à un assembly d’interopérabilité pour un objet COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-135">For example, suppose you have a project with a reference to an interop assembly for a COM object.</span></span> <span data-ttu-id="342c7-136">Si la classe COM est nommée `MyComClass`, IntelliSense et l’Explorateur d’objets affichent une interface nommée `MyComClass` et une classe nommée `MyComClassClass`.</span><span class="sxs-lookup"><span data-stu-id="342c7-136">If the COM class is named `MyComClass`, IntelliSense and the Object Browser show an interface named `MyComClass` and a class named `MyComClassClass`.</span></span>  
  
##  <span data-ttu-id="342c7-137"><a name="vbconinteroperabilitymarshalinganchor6"></a>Création d’Instances d’une classe .NET Framework</span><span class="sxs-lookup"><span data-stu-id="342c7-137"><a name="vbconinteroperabilitymarshalinganchor6"></a> Creating Instances of a .NET Framework Class</span></span>  
 <span data-ttu-id="342c7-138">En général, vous créez une instance d’un [!INCLUDE[dnprdnshort](~/includes/dnprdnshort-md.md)] à l’aide de la classe la `New` instruction avec un nom de classe.</span><span class="sxs-lookup"><span data-stu-id="342c7-138">Generally, you create an instance of a [!INCLUDE[dnprdnshort](~/includes/dnprdnshort-md.md)] class using the `New` statement with a class name.</span></span> <span data-ttu-id="342c7-139">Une classe COM représentée par un assembly d’interopérabilité est le seul cas dans lequel vous pouvez utiliser la `New` instruction avec une interface.</span><span class="sxs-lookup"><span data-stu-id="342c7-139">Having a COM class represented by an interop assembly is the one case in which you can use the `New` statement with an interface.</span></span> <span data-ttu-id="342c7-140">Sauf si vous utilisez la classe COM avec une `Inherits` instruction, vous pouvez utiliser l’interface comme vous le feriez pour une classe.</span><span class="sxs-lookup"><span data-stu-id="342c7-140">Unless you are using the COM class with an `Inherits` statement, you can use the interface just as you would a class.</span></span> <span data-ttu-id="342c7-141">Le code suivant montre comment créer un `Command` objet dans un projet qui fait référence à l’objet COM de la bibliothèque Microsoft ActiveX Data Objects 2.8 :</span><span class="sxs-lookup"><span data-stu-id="342c7-141">The following code demonstrates how to create a `Command` object in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object:</span></span>  
  
 [!code-vb[VbVbalrInterop#20](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_1.vb)]  
  
 <span data-ttu-id="342c7-142">Toutefois, si vous utilisez la classe COM comme base d’une classe dérivée, vous devez utiliser la classe d’interopérabilité qui représente la classe COM, comme dans le code suivant :</span><span class="sxs-lookup"><span data-stu-id="342c7-142">However, if you are using the COM class as the base for a derived class, you must use the interop class that represents the COM class, as in the following code:</span></span>  
  
 [!code-vb[VbVbalrInterop#21](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_2.vb)]  
  
> [!NOTE]
>  <span data-ttu-id="342c7-143">Assemblys d’interopérabilité implémentent implicitement des interfaces qui représentent des classes COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-143">Interop assemblies implicitly implement interfaces that represent COM classes.</span></span> <span data-ttu-id="342c7-144">Vous ne devez pas essayer d’utiliser le `Implements` génère l’instruction pour implémenter ces interfaces ou une erreur.</span><span class="sxs-lookup"><span data-stu-id="342c7-144">You should not try to use the `Implements` statement to implement these interfaces or an error will result.</span></span>  
  
##  <span data-ttu-id="342c7-145"><a name="vbconinteroperabilitymarshalinganchor7"></a>Types de données pour les paramètres et valeurs de retour</span><span class="sxs-lookup"><span data-stu-id="342c7-145"><a name="vbconinteroperabilitymarshalinganchor7"></a> Data Types for Parameters and Return Values</span></span>  
 <span data-ttu-id="342c7-146">Contrairement aux membres des assemblys standards, les membres de l’assembly PIA peuvent avoir des types de données qui diffèrent de ceux utilisés dans la déclaration d’objet d’origine.</span><span class="sxs-lookup"><span data-stu-id="342c7-146">Unlike members of standard assemblies, interop assembly members may have data types that differ from those used in the  original object declaration.</span></span> <span data-ttu-id="342c7-147">Bien que les assemblys PIA convertissent implicitement les types de COM pour les types common language runtime compatibles, vous devez prêter attention aux types de données qui sont utilisés par les deux côtés pour empêcher les erreurs d’exécution.</span><span class="sxs-lookup"><span data-stu-id="342c7-147">Although interop assemblies implicitly convert COM types to compatible common language runtime types, you should pay attention to the data types that are used by both sides to prevent runtime errors.</span></span> <span data-ttu-id="342c7-148">Par exemple, dans les objets COM créés dans Visual Basic 6.0 et versions antérieures, les valeurs de type `Integer` supposent la [!INCLUDE[dnprdnshort](~/includes/dnprdnshort-md.md)] type équivalent, `Short`.</span><span class="sxs-lookup"><span data-stu-id="342c7-148">For example, in COM objects created in Visual Basic 6.0 and earlier versions, values of type `Integer` assume the [!INCLUDE[dnprdnshort](~/includes/dnprdnshort-md.md)] equivalent type, `Short`.</span></span> <span data-ttu-id="342c7-149">Il est recommandé d’utiliser l’Explorateur d’objets pour examiner les caractéristiques des membres importés avant de les utiliser.</span><span class="sxs-lookup"><span data-stu-id="342c7-149">It is recommended that you use the Object Browser to examine the characteristics of imported members before you use them.</span></span>  
  
##  <span data-ttu-id="342c7-150"><a name="vbconinteroperabilitymarshalinganchor8"></a>Méthodes COM de niveau module</span><span class="sxs-lookup"><span data-stu-id="342c7-150"><a name="vbconinteroperabilitymarshalinganchor8"></a> Module level COM methods</span></span>  
 <span data-ttu-id="342c7-151">La plupart des objets COM sont utilisés par la création d’une instance d’une classe COM à l’aide du `New` (mot clé), puis à appeler les méthodes de l’objet.</span><span class="sxs-lookup"><span data-stu-id="342c7-151">Most COM objects are used by creating an instance of a COM class using the `New` keyword and then calling methods of the object.</span></span> <span data-ttu-id="342c7-152">Une exception à cette règle implique des objets COM qui contiennent des `AppObj` ou `GlobalMultiUse` classes COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-152">One exception to this rule involves COM objects that contain `AppObj` or `GlobalMultiUse` COM classes.</span></span> <span data-ttu-id="342c7-153">Ces classes sont semblables aux méthodes niveau module des classes Visual Basic .NET.</span><span class="sxs-lookup"><span data-stu-id="342c7-153">Such classes resemble module level methods in Visual Basic .NET classes.</span></span> <span data-ttu-id="342c7-154">Visual Basic 6.0 et les versions antérieures créent implicitement des instances de ces objets pour vous la première fois que vous appelez l’une de leurs méthodes.</span><span class="sxs-lookup"><span data-stu-id="342c7-154">Visual Basic 6.0 and earlier versions implicitly create instances of such objects for you the first time that you call one of their methods.</span></span> <span data-ttu-id="342c7-155">Par exemple, dans Visual Basic 6.0, vous pouvez ajouter une référence à la bibliothèque d’objets Microsoft DAO 3.6 et appeler le `DBEngine` méthode sans d’abord créer une instance :</span><span class="sxs-lookup"><span data-stu-id="342c7-155">For example, in Visual Basic 6.0 you can add a reference to the Microsoft DAO 3.6 Object Library and call the `DBEngine` method without first creating an instance:</span></span>  
  
```vb  
Dim db As DAO.Database  
' Open the database.  
Set db = DBEngine.OpenDatabase("C:\nwind.mdb")  
' Use the database object.  
```  
  
 <span data-ttu-id="342c7-156">Visual Basic .NET requiert toujours créer les instances des objets COM avant de pouvoir utiliser leurs méthodes.</span><span class="sxs-lookup"><span data-stu-id="342c7-156">Visual Basic .NET requires that you always create instances of COM objects before you can use their methods.</span></span> <span data-ttu-id="342c7-157">Pour utiliser ces méthodes dans Visual Basic, déclarez une variable de la classe souhaitée et utilisez le mot clé new pour assigner l’objet à la variable objet.</span><span class="sxs-lookup"><span data-stu-id="342c7-157">To use these methods in Visual Basic, declare a variable of the desired class and use the new keyword to assign the object to the object variable.</span></span> <span data-ttu-id="342c7-158">Le `Shared` mot clé peut être utilisé lorsque vous souhaitez vous assurer que seule une instance de la classe est créée.</span><span class="sxs-lookup"><span data-stu-id="342c7-158">The `Shared` keyword can be used when you want to make sure that only one instance of the class is created.</span></span>  
  
 [!code-vb[VbVbalrInterop#23](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_3.vb)]  
  
##  <span data-ttu-id="342c7-159"><a name="vbconinteroperabilitymarshalinganchor9"></a>Erreurs non gérées dans les gestionnaires d’événements</span><span class="sxs-lookup"><span data-stu-id="342c7-159"><a name="vbconinteroperabilitymarshalinganchor9"></a> Unhandled Errors in Event Handlers</span></span>  
 <span data-ttu-id="342c7-160">Un problème d’interopérabilité courant concerne les erreurs dans les gestionnaires d’événements qui gèrent les événements déclenchés par des objets COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-160">One common interop problem involves errors in event handlers that handle events raised by COM objects.</span></span> <span data-ttu-id="342c7-161">Ces erreurs sont ignorées, sauf si vous recherchez en particulier les erreurs à l’aide de `On Error` ou `Try...Catch...Finally` instructions.</span><span class="sxs-lookup"><span data-stu-id="342c7-161">Such errors are ignored unless you specifically check for errors using `On Error` or `Try...Catch...Finally` statements.</span></span> <span data-ttu-id="342c7-162">Par exemple, l’exemple suivant provient d’un projet Visual Basic .NET qui fait référence à l’objet COM de la bibliothèque Microsoft ActiveX Data Objects 2.8.</span><span class="sxs-lookup"><span data-stu-id="342c7-162">For example, the following example is from a Visual Basic .NET project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object.</span></span>  
  
 [!code-vb[VbVbalrInterop#24](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_4.vb)]  
  
 <span data-ttu-id="342c7-163">Cet exemple génère une erreur comme prévu.</span><span class="sxs-lookup"><span data-stu-id="342c7-163">This example raises an error as expected.</span></span> <span data-ttu-id="342c7-164">Toutefois, si vous essayez le même exemple sans le `Try...Catch...Finally` bloc, l’erreur est ignorée comme si vous avez utilisé la `OnError Resume Next` instruction.</span><span class="sxs-lookup"><span data-stu-id="342c7-164">However, if you try the same example without the `Try...Catch...Finally` block, the error is ignored as if you used the `OnError Resume Next` statement.</span></span> <span data-ttu-id="342c7-165">Sans la gestion des erreurs, la division par zéro échoue sans avertissement.</span><span class="sxs-lookup"><span data-stu-id="342c7-165">Without error handling, the division by zero silently fails.</span></span> <span data-ttu-id="342c7-166">Étant donné que ces erreurs ne déclenchent jamais d’erreurs d’exception non gérée, il est important que vous utilisez une forme de gestion des exceptions dans les gestionnaires d’événements qui gèrent des événements à partir des objets COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-166">Because such errors never raise unhandled exception errors, it is important that you use some form of exception handling in event handlers that handle events from COM objects.</span></span>  
  
### <a name="understanding-com-interop-errors"></a><span data-ttu-id="342c7-167">Présentation des erreurs d’interopérabilité COM</span><span class="sxs-lookup"><span data-stu-id="342c7-167">Understanding COM interop errors</span></span>  
 <span data-ttu-id="342c7-168">Sans la gestion des erreurs, les appels interop génèrent souvent des erreurs qui fournissent peu d’informations.</span><span class="sxs-lookup"><span data-stu-id="342c7-168">Without error handling, interop calls often generate errors that provide little information.</span></span> <span data-ttu-id="342c7-169">Si possible, utilisez gestion pour fournir plus d’informations sur les problèmes lorsqu’ils se produisent structurée des erreurs.</span><span class="sxs-lookup"><span data-stu-id="342c7-169">Whenever possible, use structured error handling to provide more information about problems when they occur.</span></span> <span data-ttu-id="342c7-170">Cela peut être particulièrement utile lorsque vous déboguez des applications.</span><span class="sxs-lookup"><span data-stu-id="342c7-170">This can be especially helpful when you debug applications.</span></span> <span data-ttu-id="342c7-171">Exemple :</span><span class="sxs-lookup"><span data-stu-id="342c7-171">For example:</span></span>  
  
 [!code-vb[VbVbalrInterop#25](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_5.vb)]  
  
 <span data-ttu-id="342c7-172">Vous trouverez des informations telles que la description d’erreur HRESULT et la source des erreurs COM en examinant le contenu de l’objet exception.</span><span class="sxs-lookup"><span data-stu-id="342c7-172">You can find information such as the error description, HRESULT, and the source of COM errors by examining the contents of the exception object.</span></span>  
  
##  <span data-ttu-id="342c7-173"><a name="vbconinteroperabilitymarshalinganchor10"></a>Problèmes de contrôle ActiveX</span><span class="sxs-lookup"><span data-stu-id="342c7-173"><a name="vbconinteroperabilitymarshalinganchor10"></a> ActiveX Control Issues</span></span>  
 <span data-ttu-id="342c7-174">La plupart des contrôles ActiveX qui fonctionnent avec Visual Basic 6.0 fonctionne avec Visual Basic .NET sans problème.</span><span class="sxs-lookup"><span data-stu-id="342c7-174">Most ActiveX controls that work with Visual Basic 6.0 work with Visual Basic .NET without trouble.</span></span> <span data-ttu-id="342c7-175">Les principales exceptions sont les contrôles conteneurs, des contrôles qui contiennent visuellement d’autres contrôles.</span><span class="sxs-lookup"><span data-stu-id="342c7-175">The main exceptions are container controls, or controls that visually contain other controls.</span></span> <span data-ttu-id="342c7-176">Quelques exemples d’anciens contrôles qui ne fonctionnent pas correctement avec [!INCLUDE[vsprvs](~/includes/vsprvs-md.md)] sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="342c7-176">Some examples of older controls that do not work correctly with [!INCLUDE[vsprvs](~/includes/vsprvs-md.md)] are as follows:</span></span>  
  
-   <span data-ttu-id="342c7-177">Contrôle Frame de Microsoft Forms 2.0</span><span class="sxs-lookup"><span data-stu-id="342c7-177">Microsoft Forms 2.0 Frame control</span></span>  
  
-   <span data-ttu-id="342c7-178">Contrôle Up-Down, également connu sous le contrôle spin</span><span class="sxs-lookup"><span data-stu-id="342c7-178">Up-Down control, also known as the spin control</span></span>  
  
-   <span data-ttu-id="342c7-179">Contrôle Sheridan Tab</span><span class="sxs-lookup"><span data-stu-id="342c7-179">Sheridan Tab Control</span></span>  
  
 <span data-ttu-id="342c7-180">Il existe peu de solutions pour les problèmes de contrôle ActiveX non pris en charge.</span><span class="sxs-lookup"><span data-stu-id="342c7-180">There are only a few workarounds for unsupported ActiveX control problems.</span></span> <span data-ttu-id="342c7-181">Vous pouvez migrer des contrôles existants à [!INCLUDE[vsprvs](~/includes/vsprvs-md.md)] si vous possédez le code source d’origine.</span><span class="sxs-lookup"><span data-stu-id="342c7-181">You can migrate existing controls to [!INCLUDE[vsprvs](~/includes/vsprvs-md.md)] if you own the original source code.</span></span> <span data-ttu-id="342c7-182">Sinon, vous pouvez vérifier avec les éditeurs de logiciels pour la mise à jour. NET-compatible avec les versions des contrôles pour remplacer non pris en charge les contrôles ActiveX.</span><span class="sxs-lookup"><span data-stu-id="342c7-182">Otherwise, you can check with software vendors for updated .NET-compatible versions of controls to replace unsupported ActiveX controls.</span></span>  
  
##  <span data-ttu-id="342c7-183"><a name="vbconinteroperabilitymarshalinganchor11"></a>Passage de propriétés en lecture seule de contrôles avec ByRef</span><span class="sxs-lookup"><span data-stu-id="342c7-183"><a name="vbconinteroperabilitymarshalinganchor11"></a> Passing ReadOnly Properties of Controls ByRef</span></span>  
 <span data-ttu-id="342c7-184">Visual Basic .NET génère parfois des erreurs COM par exemple, « Error 0x800A017F CTL_E_SETNOTSUPPORTED » lorsque vous transmettez `ReadOnly` propriétés de certains anciens contrôles ActiveX comme `ByRef` paramètres à d’autres procédures.</span><span class="sxs-lookup"><span data-stu-id="342c7-184">Visual Basic .NET sometimes raises COM errors such as, "Error 0x800A017F CTL_E_SETNOTSUPPORTED", when you pass `ReadOnly` properties of some older ActiveX controls as `ByRef` parameters to other procedures.</span></span> <span data-ttu-id="342c7-185">Les appels de procédure similaires à partir de Visual Basic 6.0 ne génèrent pas d’erreur et les paramètres sont traités comme si vous les avez passé par valeur.</span><span class="sxs-lookup"><span data-stu-id="342c7-185">Similar procedure calls from Visual Basic 6.0 do not raise an error, and the parameters are treated as if you passed them by value.</span></span> <span data-ttu-id="342c7-186">Le message d’erreur Visual Basic .NET indique que vous essayez de modifier une propriété qui n’a pas de propriété `Set` procédure.</span><span class="sxs-lookup"><span data-stu-id="342c7-186">The Visual Basic .NET error message indicates that you are trying to change a property that does not have a property `Set` procedure.</span></span>  
  
 <span data-ttu-id="342c7-187">Si vous avez accès à la procédure appelée, vous pouvez éviter cette erreur à l’aide de la `ByVal` (mot clé) pour déclarer des paramètres qui acceptent les `ReadOnly` propriétés.</span><span class="sxs-lookup"><span data-stu-id="342c7-187">If you have access to the procedure being called, you can prevent this error by using the `ByVal` keyword to declare parameters that accept `ReadOnly` properties.</span></span> <span data-ttu-id="342c7-188">Exemple :</span><span class="sxs-lookup"><span data-stu-id="342c7-188">For example:</span></span>  
  
 [!code-vb[VbVbalrInterop#26](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_6.vb)]  
  
 <span data-ttu-id="342c7-189">Si vous n’avez pas d’accès au code source pour la procédure appelée, vous pouvez forcer la propriété soient passés par valeur en ajoutant un jeu supplémentaire de la procédure appelante entre crochets.</span><span class="sxs-lookup"><span data-stu-id="342c7-189">If you do not have access to the source code for the procedure being called, you can force the property to be passed by value by adding an extra set of brackets around the calling procedure.</span></span> <span data-ttu-id="342c7-190">Par exemple, dans un projet qui fait référence à l’objet COM de la bibliothèque Microsoft ActiveX Data Objects 2.8, vous pouvez utiliser :</span><span class="sxs-lookup"><span data-stu-id="342c7-190">For example, in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object, you can use:</span></span>  
  
 [!code-vb[VbVbalrInterop#27](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_7.vb)]  
  
##  <span data-ttu-id="342c7-191"><a name="vbconinteroperabilitymarshalinganchor12"></a>Déploiement d’assemblys exposant l’interopérabilité</span><span class="sxs-lookup"><span data-stu-id="342c7-191"><a name="vbconinteroperabilitymarshalinganchor12"></a> Deploying Assemblies That Expose Interop</span></span>  
 <span data-ttu-id="342c7-192">Déploiement d’assemblys qui exposent les interfaces COM présente des défis uniques.</span><span class="sxs-lookup"><span data-stu-id="342c7-192">Deploying assemblies that expose COM interfaces presents some unique challenges.</span></span> <span data-ttu-id="342c7-193">Par exemple, un problème potentiel se produit lorsque des applications distinctes référencent le même assembly COM.</span><span class="sxs-lookup"><span data-stu-id="342c7-193">For example, a potential problem occurs when separate applications reference the same COM assembly.</span></span> <span data-ttu-id="342c7-194">Cette situation est courante lorsqu’une nouvelle version d’un assembly est installée et une autre application utilise toujours l’ancienne version de l’assembly.</span><span class="sxs-lookup"><span data-stu-id="342c7-194">This situation is common when a new version of an assembly is installed and another application is still using the old version of the assembly.</span></span> <span data-ttu-id="342c7-195">Si vous désinstallez un assembly partageant une DLL, vous pouvez involontairement rendre non disponible aux autres assemblys.</span><span class="sxs-lookup"><span data-stu-id="342c7-195">If you uninstall an assembly that shares a DLL, you can unintentionally make it unavailable to the other assemblies.</span></span>  
  
 <span data-ttu-id="342c7-196">Pour éviter ce problème, vous devez installer les assemblys partagés pour le Global Assembly Cache (GAC) et utiliser un module de fusion pour le composant.</span><span class="sxs-lookup"><span data-stu-id="342c7-196">To avoid this problem, you should install shared assemblies to the Global Assembly Cache (GAC) and use a MergeModule for the component.</span></span> <span data-ttu-id="342c7-197">Si vous ne pouvez pas installer l’application dans le GAC, il doit être installé dans un sous-répertoire spécifique à la version du répertoire CommonFilesFolder.</span><span class="sxs-lookup"><span data-stu-id="342c7-197">If you cannot install the application in the GAC, it should be installed to CommonFilesFolder in a version-specific subdirectory.</span></span>  
  
 <span data-ttu-id="342c7-198">Les assemblys qui ne sont pas partagés doivent se trouver côte à côte dans le répertoire avec l’application appelante.</span><span class="sxs-lookup"><span data-stu-id="342c7-198">Assemblies that are not shared should be located side by side in the directory with the calling application.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="342c7-199">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="342c7-199">See Also</span></span>  
 <xref:System.Runtime.InteropServices.MarshalAsAttribute>  
 [<span data-ttu-id="342c7-200">COM Interop</span><span class="sxs-lookup"><span data-stu-id="342c7-200">COM Interop</span></span>](../../../visual-basic/programming-guide/com-interop/index.md)  
 [<span data-ttu-id="342c7-201">Tlbimp.exe (importateur de bibliothèques de types)</span><span class="sxs-lookup"><span data-stu-id="342c7-201">Tlbimp.exe (Type Library Importer)</span></span>](http://msdn.microsoft.com/library/ec0a8d63-11b3-4acd-b398-da1e37e97382)  
 [<span data-ttu-id="342c7-202">Tlbexp.exe (exportateur de bibliothèques de types)</span><span class="sxs-lookup"><span data-stu-id="342c7-202">Tlbexp.exe (Type Library Exporter)</span></span>](http://msdn.microsoft.com/library/a487d61b-d166-467b-a7ca-d8b52fbff42d)  
 [<span data-ttu-id="342c7-203">Procédure pas à pas : implémentation de l’héritage avec les objets COM</span><span class="sxs-lookup"><span data-stu-id="342c7-203">Walkthrough: Implementing Inheritance with COM Objects</span></span>](../../../visual-basic/programming-guide/com-interop/walkthrough-implementing-inheritance-with-com-objects.md)  
 [<span data-ttu-id="342c7-204">Inherits (instruction)</span><span class="sxs-lookup"><span data-stu-id="342c7-204">Inherits Statement</span></span>](../../../visual-basic/language-reference/statements/inherits-statement.md)  
 [<span data-ttu-id="342c7-205">Global Assembly Cache</span><span class="sxs-lookup"><span data-stu-id="342c7-205">Global Assembly Cache</span></span>](../../../framework/app-domains/gac.md)
