---
title: "Meilleures pratiques pour implémenter le modèle asynchrone basé sur des événements"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- AsyncOperation class
- AsyncCompletedEventArgs class
ms.assetid: 4acd2094-4f46-4eff-9190-92d0d9ff47db
caps.latest.revision: "8"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: b6a98c6854bc935eb8b319bd8a26dba8f12380ae
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2017
---
# <a name="best-practices-for-implementing-the-event-based-asynchronous-pattern"></a><span data-ttu-id="2c2db-102">Meilleures pratiques pour implémenter le modèle asynchrone basé sur des événements</span><span class="sxs-lookup"><span data-stu-id="2c2db-102">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="2c2db-103">Le modèle asynchrone basé sur les événements vous permet d’exposer efficacement un comportement asynchrone dans les classes, en utilisant une sémantique d’événement et de délégué familière.</span><span class="sxs-lookup"><span data-stu-id="2c2db-103">The Event-based Asynchronous Pattern provides you with an effective way to expose asynchronous behavior in classes, with familiar event and delegate semantics.</span></span> <span data-ttu-id="2c2db-104">Pour implémenter le modèle asynchrone basé sur les événements, vous devez respecter certaines contraintes liées au comportement.</span><span class="sxs-lookup"><span data-stu-id="2c2db-104">To implement Event-based Asynchronous Pattern, you need to follow some specific behavioral requirements.</span></span> <span data-ttu-id="2c2db-105">Les sections ci-après décrivent les exigences et les recommandations que vous devez prendre en compte quand vous implémentez une classe qui suit le modèle asynchrone basé sur les événements.</span><span class="sxs-lookup"><span data-stu-id="2c2db-105">The following sections describe requirements and guidelines you should consider when you implement a class that follows the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="2c2db-106">Pour une présentation, consultez [Implémentation du modèle asynchrone basé sur des événements](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="2c2db-106">For an overview, see [Implementing the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="required-behavioral-guarantees"></a><span data-ttu-id="2c2db-107">Garanties de comportement obligatoires</span><span class="sxs-lookup"><span data-stu-id="2c2db-107">Required Behavioral Guarantees</span></span>  
 <span data-ttu-id="2c2db-108">Si vous implémentez le modèle asynchrone basé sur les événements, vous devez fournir une série de garanties pour que votre classe se comporte correctement et que les clients de votre classe puissent s'appuyer sur ce comportement.</span><span class="sxs-lookup"><span data-stu-id="2c2db-108">If you implement the Event-based Asynchronous Pattern, you must provide a number of guarantees to ensure that your class will behave properly and clients of your class can rely on such behavior.</span></span>  
  
### <a name="completion"></a><span data-ttu-id="2c2db-109">Achèvement</span><span class="sxs-lookup"><span data-stu-id="2c2db-109">Completion</span></span>  
 <span data-ttu-id="2c2db-110">Appelez toujours le gestionnaire d’événements *nom_méthode*`Completed` quand l’opération s’est terminée correctement, ou bien en cas d’erreur ou d’annulation.</span><span class="sxs-lookup"><span data-stu-id="2c2db-110">Always invoke the *MethodName*`Completed` event handler when you have successful completion, an error, or a cancellation.</span></span> <span data-ttu-id="2c2db-111">Les applications ne doivent jamais rencontrer de situation dans laquelle elles demeurent inactives sans jamais terminer l'opération en cours.</span><span class="sxs-lookup"><span data-stu-id="2c2db-111">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span> <span data-ttu-id="2c2db-112">Une exception à cette règle est la situation dans laquelle l'opération asynchrone elle-même est conçue de manière à ne jamais se terminer.</span><span class="sxs-lookup"><span data-stu-id="2c2db-112">One exception to this rule is if the asynchronous operation itself it designed so that it never completes.</span></span>  
  
### <a name="completed-event-and-eventargs"></a><span data-ttu-id="2c2db-113">Événement Completed et classe EventArgs</span><span class="sxs-lookup"><span data-stu-id="2c2db-113">Completed Event and EventArgs</span></span>  
 <span data-ttu-id="2c2db-114">Pour chaque méthode *nom_méthode*`Async` distincte, appliquez les contraintes de conception suivantes :</span><span class="sxs-lookup"><span data-stu-id="2c2db-114">For each separate *MethodName*`Async` method, apply the following design requirements:</span></span>  
  
-   <span data-ttu-id="2c2db-115">Définissez un événement *nom_méthode*`Completed` sur la même classe que la méthode.</span><span class="sxs-lookup"><span data-stu-id="2c2db-115">Define a *MethodName*`Completed` event on the same class as the method.</span></span>  
  
-   <span data-ttu-id="2c2db-116">Définissez une classe <xref:System.EventArgs> et le délégué associé pour l’événement *nom_méthode*`Completed` qui dérive de la classe <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-116">Define an <xref:System.EventArgs> class and accompanying delegate for the *MethodName*`Completed` event that derives from the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span> <span data-ttu-id="2c2db-117">Le nom de classe par défaut doit être de la forme *nom_méthode*`CompletedEventArgs`.</span><span class="sxs-lookup"><span data-stu-id="2c2db-117">The default class name should be of the form *MethodName*`CompletedEventArgs`.</span></span>  
  
-   <span data-ttu-id="2c2db-118">Vérifiez que la classe <xref:System.EventArgs> est spécifique des valeurs de retour de la méthode *nom_méthode*.</span><span class="sxs-lookup"><span data-stu-id="2c2db-118">Ensure that the <xref:System.EventArgs> class is specific to the return values of the *MethodName* method.</span></span> <span data-ttu-id="2c2db-119">Quand vous utilisez la classe <xref:System.EventArgs>, vous ne devez jamais obliger les développeurs à effectuer un transtypage du résultat.</span><span class="sxs-lookup"><span data-stu-id="2c2db-119">When you use the <xref:System.EventArgs> class, you should never require developers to cast the result.</span></span>  
  
     <span data-ttu-id="2c2db-120">L'exemple de code suivant montre une bonne implémentation de cette contrainte de conception, suivie d'une mauvaise.</span><span class="sxs-lookup"><span data-stu-id="2c2db-120">The following code example shows good and bad implementation of this design requirement respectively.</span></span>  
  
```csharp  
// Good design  
private void Form1_MethodNameCompleted(object sender, xxxCompletedEventArgs e)   
{   
    DemoType result = e.Result;  
}  
  
// Bad design  
private void Form1_MethodNameCompleted(object sender, MethodNameCompletedEventArgs e)   
{   
    DemoType result = (DemoType)(e.Result);  
}  
```  
  
-   <span data-ttu-id="2c2db-121">Ne définissez pas de classe <xref:System.EventArgs> pour les méthodes de retour qui retournent `void`.</span><span class="sxs-lookup"><span data-stu-id="2c2db-121">Do not define an <xref:System.EventArgs> class for returning methods that return `void`.</span></span> <span data-ttu-id="2c2db-122">À la place, utilisez une instance de la classe <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-122">Instead, use an instance of the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span>  
  
-   <span data-ttu-id="2c2db-123">Veillez à toujours déclencher l’événement *nom_méthode*`Completed`.</span><span class="sxs-lookup"><span data-stu-id="2c2db-123">Ensure that you always raise the *MethodName*`Completed` event.</span></span> <span data-ttu-id="2c2db-124">Cet événement doit être déclenché quand l'opération s'est terminée correctement, ou bien en cas d'erreur ou d'annulation.</span><span class="sxs-lookup"><span data-stu-id="2c2db-124">This event should be raised on successful completion, on an error, or on cancellation.</span></span> <span data-ttu-id="2c2db-125">Les applications ne doivent jamais rencontrer de situation dans laquelle elles demeurent inactives sans jamais terminer l'opération en cours.</span><span class="sxs-lookup"><span data-stu-id="2c2db-125">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span>  
  
-   <span data-ttu-id="2c2db-126">Veillez à intercepter toutes les exceptions qui se produisent au cours de l'opération asynchrone et à affecter l'exception interceptée à la propriété <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-126">Ensure that you catch any exceptions that occur in the asynchronous operation and assign the caught exception to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
-   <span data-ttu-id="2c2db-127">Si une erreur se produit pendant l'exécution de la tâche, les résultats doivent être inaccessibles.</span><span class="sxs-lookup"><span data-stu-id="2c2db-127">If there was an error completing the task, the results should not be accessible.</span></span> <span data-ttu-id="2c2db-128">Quand la propriété <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> n'a pas pour valeur `null`, assurez-vous que l'accès à toute propriété dans la structure <xref:System.EventArgs> lève une exception.</span><span class="sxs-lookup"><span data-stu-id="2c2db-128">When the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property is not `null`, ensure that accessing any property in the <xref:System.EventArgs> structure raises an exception.</span></span> <span data-ttu-id="2c2db-129">Utilisez la méthode <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> pour effectuer cette vérification.</span><span class="sxs-lookup"><span data-stu-id="2c2db-129">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method to perform this verification.</span></span>  
  
-   <span data-ttu-id="2c2db-130">Modélisez un délai au terme duquel une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="2c2db-130">Model a time out as an error.</span></span> <span data-ttu-id="2c2db-131">Quand un délai arrive à expiration, déclenchez l’événement *nom_méthode*`Completed` et affectez une <xref:System.TimeoutException> à la propriété <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-131">When a time out occurs, raise the *MethodName*`Completed` event and assign a <xref:System.TimeoutException> to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
-   <span data-ttu-id="2c2db-132">Si votre classe prend en charge plusieurs appels simultanés, vérifiez que l’événement *nom_méthode*`Completed` contient l’objet `userSuppliedState` approprié.</span><span class="sxs-lookup"><span data-stu-id="2c2db-132">If your class supports multiple concurrent invocations, ensure that the *MethodName*`Completed` event contains the appropriate `userSuppliedState` object.</span></span>  
  
-   <span data-ttu-id="2c2db-133">Vérifiez que l’événement *nom_méthode*`Completed` est déclenché sur le thread approprié et au moment adéquat pendant le cycle de vie de l’application.</span><span class="sxs-lookup"><span data-stu-id="2c2db-133">Ensure that the *MethodName*`Completed` event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="2c2db-134">Pour plus d'informations, voir la section Thread et contextes.</span><span class="sxs-lookup"><span data-stu-id="2c2db-134">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="simultaneously-executing-operations"></a><span data-ttu-id="2c2db-135">Exécution d'opérations simultanément</span><span class="sxs-lookup"><span data-stu-id="2c2db-135">Simultaneously Executing Operations</span></span>  
  
-   <span data-ttu-id="2c2db-136">Si votre classe prend en charge plusieurs appels simultanés, autorisez le développeur à effectuer le suivi de chaque appel séparément en définissant la surcharge de *nom_méthode*`Async` qui prend un paramètre d’état à valeur d’objet, ou un ID de tâche, appelé `userSuppliedState`.</span><span class="sxs-lookup"><span data-stu-id="2c2db-136">If your class supports multiple concurrent invocations, enable the developer to track each invocation separately by defining the *MethodName*`Async` overload that takes an object-valued state parameter, or task ID, called `userSuppliedState`.</span></span> <span data-ttu-id="2c2db-137">Ce paramètre doit toujours être le dernier paramètre de la signature de la méthode *nom_méthode*`Async`.</span><span class="sxs-lookup"><span data-stu-id="2c2db-137">This parameter should always be the last parameter in the *MethodName*`Async` method's signature.</span></span>  
  
-   <span data-ttu-id="2c2db-138">Si votre classe définit la surcharge de *nom_méthode*`Async` qui accepte un paramètre d’état à valeur d’objet, ou un ID de tâche, veillez à effectuer le suivi de la durée de vie de l’opération avec cet ID de tâche, et à le fournir en retour au gestionnaire d’achèvement.</span><span class="sxs-lookup"><span data-stu-id="2c2db-138">If your class defines the *MethodName*`Async` overload that takes an object-valued state parameter, or task ID, be sure to track the lifetime of the operation with that task ID, and be sure to provide it back into the completion handler.</span></span> <span data-ttu-id="2c2db-139">Vous pouvez vous aider de classes d'assistance.</span><span class="sxs-lookup"><span data-stu-id="2c2db-139">There are helper classes available to assist.</span></span> <span data-ttu-id="2c2db-140">Pour plus d’informations sur la gestion de l’accès concurrentiel, voir [Procédure pas à pas : implémentation d’un composant qui prend en charge le modèle asynchrone basé sur des événements](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="2c2db-140">For more information on concurrency management, see [Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
-   <span data-ttu-id="2c2db-141">Si votre classe définit la méthode *nom_méthode*`Async` sans le paramètre d’état et qu’elle ne prend pas en charge plusieurs appels simultanés, vérifiez que toute tentative d’appel de *nom_méthode*`Async` avant que soit achevé l’appel précédent de *nom_méthode*`Async` lève une <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-141">If your class defines the *MethodName*`Async` method without the state parameter, and it does not support multiple concurrent invocations, ensure that any attempt to invoke *MethodName*`Async` before the prior *MethodName*`Async` invocation has completed raises an <xref:System.InvalidOperationException>.</span></span>  
  
-   <span data-ttu-id="2c2db-142">D’une façon générale, ne levez pas d’exception si la méthode *nom_méthode*`Async` sans le paramètre `userSuppliedState` est appelée plusieurs fois et que plusieurs opérations se trouvent ainsi en attente.</span><span class="sxs-lookup"><span data-stu-id="2c2db-142">In general, do not raise an exception if the *MethodName*`Async` method without the `userSuppliedState` parameter is invoked multiple times so that there are multiple outstanding operations.</span></span> <span data-ttu-id="2c2db-143">Vous pouvez lever une exception quand votre classe ne peut pas explicitement gérer cette situation, mais partez du principe que les développeurs peuvent gérer ces différents rappels impossibles à distinguer.</span><span class="sxs-lookup"><span data-stu-id="2c2db-143">You can raise an exception when your class explicitly cannot handle that situation, but assume that developers can handle these multiple indistinguishable callbacks</span></span>  
  
### <a name="accessing-results"></a><span data-ttu-id="2c2db-144">Accès aux résultats</span><span class="sxs-lookup"><span data-stu-id="2c2db-144">Accessing Results</span></span>  
  
-   <span data-ttu-id="2c2db-145">Si une erreur se produit pendant l'exécution de l'opération asynchrone, les résultats doivent être inaccessibles.</span><span class="sxs-lookup"><span data-stu-id="2c2db-145">If there was an error during execution of the asynchronous operation, the results should not be accessible.</span></span> <span data-ttu-id="2c2db-146">Assurez-vous que l'accès à toute propriété dans la classe <xref:System.ComponentModel.AsyncCompletedEventArgs> quand <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> n'a pas pour valeur `null` lève l'exception référencée par <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-146">Ensure that accessing any property in the <xref:System.ComponentModel.AsyncCompletedEventArgs> when <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> is not `null` raises the exception referenced by <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span></span> <span data-ttu-id="2c2db-147">À cette fin, la classe <xref:System.ComponentModel.AsyncCompletedEventArgs> fournit la méthode <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-147">The <xref:System.ComponentModel.AsyncCompletedEventArgs> class provides the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method for this purpose.</span></span>  
  
-   <span data-ttu-id="2c2db-148">Assurez-vous que toute tentative d'accéder au résultat lève une exception <xref:System.InvalidOperationException> signalant que l'opération a été annulée.</span><span class="sxs-lookup"><span data-stu-id="2c2db-148">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="2c2db-149">Utilisez la méthode <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> pour effectuer cette vérification.</span><span class="sxs-lookup"><span data-stu-id="2c2db-149">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
### <a name="progress-reporting"></a><span data-ttu-id="2c2db-150">Rapport de progression</span><span class="sxs-lookup"><span data-stu-id="2c2db-150">Progress Reporting</span></span>  
  
-   <span data-ttu-id="2c2db-151">Dans la mesure du possible, prenez en charge le rapport de progression.</span><span class="sxs-lookup"><span data-stu-id="2c2db-151">Support progress reporting, if possible.</span></span> <span data-ttu-id="2c2db-152">Cela permet aux développeurs de fournir une meilleure expérience utilisateur d'application quand ils utilisent votre classe.</span><span class="sxs-lookup"><span data-stu-id="2c2db-152">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
-   <span data-ttu-id="2c2db-153">Si vous implémentez un événement `ProgressChanged`/*nom_méthode*`ProgressChanged`, vérifiez qu’aucun événement de ce type n’est déclenché pour une opération asynchrone particulière après que l’événement *nom_méthode*`Completed` de cette opération a été déclenché.</span><span class="sxs-lookup"><span data-stu-id="2c2db-153">If you implement a `ProgressChanged`/*MethodName*`ProgressChanged` event, ensure that there are no such events raised for a particular asynchronous operation after that operation's *MethodName*`Completed` event has been raised.</span></span>  
  
-   <span data-ttu-id="2c2db-154">Si la classe <xref:System.ComponentModel.ProgressChangedEventArgs> standard est remplie, assurez-vous que la propriété <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> peut toujours être interprétée en tant que pourcentage.</span><span class="sxs-lookup"><span data-stu-id="2c2db-154">If the standard <xref:System.ComponentModel.ProgressChangedEventArgs> is being populated, ensure that the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> can always be interpreted as a percentage.</span></span> <span data-ttu-id="2c2db-155">La valeur de pourcentage n'a pas besoin d'être précise, mais elle doit représenter un pourcentage.</span><span class="sxs-lookup"><span data-stu-id="2c2db-155">The percentage does not need to be accurate, but it should represent a percentage.</span></span> <span data-ttu-id="2c2db-156">Si la mesure du rapport de progression doit être autre chose qu'un pourcentage, dérivez une classe de la classe <xref:System.ComponentModel.ProgressChangedEventArgs> et laissez <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> défini sur 0.</span><span class="sxs-lookup"><span data-stu-id="2c2db-156">If your progress reporting metric must be something other than a percentage, derive a class from the <xref:System.ComponentModel.ProgressChangedEventArgs> class and leave <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> at 0.</span></span> <span data-ttu-id="2c2db-157">Évitez d'utiliser une mesure d'indication autre qu'un pourcentage.</span><span class="sxs-lookup"><span data-stu-id="2c2db-157">Avoid using a reporting metric other than a percentage.</span></span>  
  
-   <span data-ttu-id="2c2db-158">Assurez-vous que l'événement `ProgressChanged` est déclenché sur le thread approprié et au moment adéquat pendant le cycle de vie de l'application.</span><span class="sxs-lookup"><span data-stu-id="2c2db-158">Ensure that the `ProgressChanged` event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="2c2db-159">Pour plus d'informations, voir la section Thread et contextes.</span><span class="sxs-lookup"><span data-stu-id="2c2db-159">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="isbusy-implementation"></a><span data-ttu-id="2c2db-160">Implémentation d'IsBusy</span><span class="sxs-lookup"><span data-stu-id="2c2db-160">IsBusy Implementation</span></span>  
  
-   <span data-ttu-id="2c2db-161">N'exposez pas de propriété `IsBusy` si votre classe prend en charge plusieurs appels simultanés.</span><span class="sxs-lookup"><span data-stu-id="2c2db-161">Do not expose an `IsBusy` property if your class supports multiple concurrent invocations.</span></span> <span data-ttu-id="2c2db-162">Par exemple, les proxys de service web XML n'exposent pas de propriété `IsBusy`, car ils prennent en charge plusieurs appels simultanés de méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="2c2db-162">For example, XML Web service proxies do not expose an `IsBusy` property because they support multiple concurrent invocations of asynchronous methods.</span></span>  
  
-   <span data-ttu-id="2c2db-163">La propriété `IsBusy` doit retourner `true` une fois que la méthode *nom_méthode*`Async` a été appelée et avant que l’événement *nom_méthode*`Completed` n’ait été déclenché.</span><span class="sxs-lookup"><span data-stu-id="2c2db-163">The `IsBusy` property should return `true` after the *MethodName*`Async` method has been called and before the *MethodName*`Completed` event has been raised.</span></span> <span data-ttu-id="2c2db-164">Sinon elle doit retourner `false`.</span><span class="sxs-lookup"><span data-stu-id="2c2db-164">Otherwise it should return `false`.</span></span> <span data-ttu-id="2c2db-165">Les composants <xref:System.ComponentModel.BackgroundWorker> et <xref:System.Net.WebClient> sont des exemples de classes qui exposent une propriété `IsBusy`.</span><span class="sxs-lookup"><span data-stu-id="2c2db-165">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.Net.WebClient> components are examples of classes that expose an `IsBusy` property.</span></span>  
  
### <a name="cancellation"></a><span data-ttu-id="2c2db-166">Annulation</span><span class="sxs-lookup"><span data-stu-id="2c2db-166">Cancellation</span></span>  
  
-   <span data-ttu-id="2c2db-167">Dans la mesure du possible, prenez en charge l'annulation.</span><span class="sxs-lookup"><span data-stu-id="2c2db-167">Support cancellation, if possible.</span></span> <span data-ttu-id="2c2db-168">Cela permet aux développeurs de fournir une meilleure expérience utilisateur d'application quand ils utilisent votre classe.</span><span class="sxs-lookup"><span data-stu-id="2c2db-168">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
-   <span data-ttu-id="2c2db-169">Dans le cas de l'annulation, définissez l'indicateur <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> dans l'objet <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-169">In the case of cancellation, set the <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> flag in the <xref:System.ComponentModel.AsyncCompletedEventArgs> object.</span></span>  
  
-   <span data-ttu-id="2c2db-170">Assurez-vous que toute tentative d'accéder au résultat lève une exception <xref:System.InvalidOperationException> signalant que l'opération a été annulée.</span><span class="sxs-lookup"><span data-stu-id="2c2db-170">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="2c2db-171">Utilisez la méthode <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> pour effectuer cette vérification.</span><span class="sxs-lookup"><span data-stu-id="2c2db-171">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
-   <span data-ttu-id="2c2db-172">Assurez-vous que les appels d'une méthode d'annulation réussissent toujours et qu'ils ne déclenchent jamais d'exception.</span><span class="sxs-lookup"><span data-stu-id="2c2db-172">Ensure that calls to a cancellation method always return successfully, and never raise an exception.</span></span> <span data-ttu-id="2c2db-173">En général, un client n'est pas informé qu'il peut ou non annuler une opération à tout moment, ni qu'une annulation précédemment émise a effectivement réussi.</span><span class="sxs-lookup"><span data-stu-id="2c2db-173">In general, a client is not notified as to whether an operation is truly cancelable at any given time, and is not notified as to whether a previously issued cancellation has succeeded.</span></span> <span data-ttu-id="2c2db-174">Toutefois, l'application est toujours avertie qu'une annulation a réussi, car elle est impliquée dans la gestion de l'état d'achèvement.</span><span class="sxs-lookup"><span data-stu-id="2c2db-174">However, the application will always be given notification when a cancellation succeeded, because the application takes part in the completion status.</span></span>  
  
-   <span data-ttu-id="2c2db-175">Déclenchez l’événement *nom_méthode*`Completed` quand l’opération est annulée.</span><span class="sxs-lookup"><span data-stu-id="2c2db-175">Raise the *MethodName*`Completed` event when the operation is canceled.</span></span>  
  
### <a name="errors-and-exceptions"></a><span data-ttu-id="2c2db-176">Erreurs et exceptions</span><span class="sxs-lookup"><span data-stu-id="2c2db-176">Errors and Exceptions</span></span>  
  
-   <span data-ttu-id="2c2db-177">Interceptez toute exception qui se produit pendant l'opération asynchrone et définissez la valeur de la propriété <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> sur cette exception.</span><span class="sxs-lookup"><span data-stu-id="2c2db-177">Catch any exceptions that occur in the asynchronous operation and set the value of the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> property to that exception.</span></span>  
  
### <a name="threading-and-contexts"></a><span data-ttu-id="2c2db-178">Thread et contextes</span><span class="sxs-lookup"><span data-stu-id="2c2db-178">Threading and Contexts</span></span>  
 <span data-ttu-id="2c2db-179">Pour que votre classe fonctionne correctement, il est primordial que les gestionnaires d'événements du client soient appelés sur le thread ou contexte adéquat en fonction du modèle d'application, notamment en ce qui concerne les applications Windows Forms et [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2c2db-179">For correct operation of your class, it is critical that the client's event handlers are invoked on the proper thread or context for the given application model, including [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] and Windows Forms applications.</span></span> <span data-ttu-id="2c2db-180">Deux classes d'assistance importantes vous permettent de vous assurer que votre classe asynchrone se comporte correctement dans le cadre de n'importe quel modèle d'application : <xref:System.ComponentModel.AsyncOperation> et <xref:System.ComponentModel.AsyncOperationManager>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-180">Two important helper classes are provided to ensure that your asynchronous class behaves correctly under any application model: <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager>.</span></span>  
  
 <span data-ttu-id="2c2db-181"><xref:System.ComponentModel.AsyncOperationManager> fournit une méthode, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, qui retourne un objet <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-181"><xref:System.ComponentModel.AsyncOperationManager> provides one method, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, which returns an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="2c2db-182">Votre méthode *nom_méthode*`Async` appelle <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> et votre classe utilise l’objet <xref:System.ComponentModel.AsyncOperation> retourné pour effectuer le suivi de la durée de vie de la tâche asynchrone.</span><span class="sxs-lookup"><span data-stu-id="2c2db-182">Your *MethodName*`Async` method calls <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> and your class uses the returned <xref:System.ComponentModel.AsyncOperation> to track the lifetime of the asynchronous task.</span></span>  
  
 <span data-ttu-id="2c2db-183">Pour indiquer la progression, les résultats incrémentiels et l'achèvement au client, appelez les méthodes <xref:System.ComponentModel.AsyncOperation.Post%2A> et <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> sur la classe <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-183">To report progress, incremental results, and completion to the client, call the <xref:System.ComponentModel.AsyncOperation.Post%2A> and <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> methods on the <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="2c2db-184"><xref:System.ComponentModel.AsyncOperation> prend en charge le marshaling des appels des gestionnaires d'événements du client en thread ou contexte adéquat.</span><span class="sxs-lookup"><span data-stu-id="2c2db-184"><xref:System.ComponentModel.AsyncOperation> is responsible for marshaling calls to the client's event handlers to the proper thread or context.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2c2db-185">Vous pouvez contourner ces règles si vous souhaitez explicitement aller à l'encontre de la stratégie du modèle d'application, tout en tirant parti des autres avantages de l'utilisation du modèle asynchrone basé sur les événements.</span><span class="sxs-lookup"><span data-stu-id="2c2db-185">You can circumvent these rules if you explicitly want to go against the policy of the application model, but still benefit from the other advantages of using the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="2c2db-186">Par exemple, vous pouvez souhaiter qu'une classe fonctionnant dans Windows Forms soit libre de threads.</span><span class="sxs-lookup"><span data-stu-id="2c2db-186">For example, you may want a class operating in Windows Forms to be free threaded.</span></span> <span data-ttu-id="2c2db-187">Vous pouvez créer une classe libre de threads, sous réserve que les développeurs comprennent les restrictions que cela implique.</span><span class="sxs-lookup"><span data-stu-id="2c2db-187">You can create a free threaded class, as long as developers understand the implied restrictions.</span></span> <span data-ttu-id="2c2db-188">Les applications console ne synchronisent pas l'exécution des appels <xref:System.ComponentModel.AsyncOperation.Post%2A>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-188">Console applications do not synchronize the execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls.</span></span> <span data-ttu-id="2c2db-189">Cela peut entraîner le déclenchement d'événements `ProgressChanged` dans le désordre.</span><span class="sxs-lookup"><span data-stu-id="2c2db-189">This can cause `ProgressChanged` events to be raised out of order.</span></span> <span data-ttu-id="2c2db-190">Si vous souhaitez que l'exécution des appels <xref:System.ComponentModel.AsyncOperation.Post%2A> soit sérialisée, implémentez et installez une classe <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-190">If you wish to have serialized execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls, implement and install a <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType> class.</span></span>  
  
 <span data-ttu-id="2c2db-191">Pour plus d’informations sur l’utilisation de <xref:System.ComponentModel.AsyncOperation> et <xref:System.ComponentModel.AsyncOperationManager> pour activer vos opérations asynchrones, consultez [procédure pas à pas : implémentation d’un composant qui prend en charge le modèle asynchrone basé sur événement](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="2c2db-191">For more information about using <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager> to enable your asynchronous operations, see [Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="guidelines"></a><span data-ttu-id="2c2db-192">Recommandations</span><span class="sxs-lookup"><span data-stu-id="2c2db-192">Guidelines</span></span>  
  
-   <span data-ttu-id="2c2db-193">Dans l'idéal, chaque appel de méthode doit être indépendant des autres appels.</span><span class="sxs-lookup"><span data-stu-id="2c2db-193">Ideally, each method invocation should be independent of others.</span></span> <span data-ttu-id="2c2db-194">Vous devez éviter d'associer des appels qui partagent des ressources.</span><span class="sxs-lookup"><span data-stu-id="2c2db-194">You should avoid coupling invocations with shared resources.</span></span> <span data-ttu-id="2c2db-195">Si des ressources doivent être partagées par des appels, vous devez prévoir un mécanisme de synchronisation approprié dans votre implémentation.</span><span class="sxs-lookup"><span data-stu-id="2c2db-195">If resources are to be shared among invocations, you will need to provide a proper synchronization mechanism in your implementation.</span></span>  
  
-   <span data-ttu-id="2c2db-196">Les conceptions qui obligent le client à implémenter une synchronisation sont déconseillées.</span><span class="sxs-lookup"><span data-stu-id="2c2db-196">Designs that require the client to implement synchronization are discouraged.</span></span> <span data-ttu-id="2c2db-197">Par exemple, dans le cas d'une méthode asynchrone qui reçoit un objet statique global comme paramètre, plusieurs appels simultanés de ce type de méthode peuvent entraîner une altération des données ou des interblocages.</span><span class="sxs-lookup"><span data-stu-id="2c2db-197">For example, you could have an asynchronous method that receives a global static object as a parameter; multiple concurrent invocations of such a method could result in data corruption or deadlocks.</span></span>  
  
-   <span data-ttu-id="2c2db-198">Si vous implémentez une méthode avec la surcharge de plusieurs appels (`userState` dans la signature), votre classe doit gérer une collection d'états utilisateur, ou d'ID de tâche, ainsi que leurs opérations en attente correspondantes.</span><span class="sxs-lookup"><span data-stu-id="2c2db-198">If you implement a method with the multiple-invocation overload (`userState` in the signature), your class will need to manage a collection of user states, or task IDs, and their corresponding pending operations.</span></span> <span data-ttu-id="2c2db-199">Cette collection doit être protégée avec des régions `lock`, car les différents appels ajoutent et suppriment des objets `userState` dans la collection.</span><span class="sxs-lookup"><span data-stu-id="2c2db-199">This collection should be protected with `lock` regions, because the various invocations add and remove `userState` objects in the collection.</span></span>  
  
-   <span data-ttu-id="2c2db-200">Pensez à réutiliser les classes `CompletedEventArgs` si cela est possible et approprié.</span><span class="sxs-lookup"><span data-stu-id="2c2db-200">Consider reusing `CompletedEventArgs` classes where feasible and appropriate.</span></span> <span data-ttu-id="2c2db-201">Dans ce cas, l'affectation des noms n'est pas cohérente avec le nom de la méthode, car un délégué et un type <xref:System.EventArgs> donnés ne sont pas liés à une même méthode.</span><span class="sxs-lookup"><span data-stu-id="2c2db-201">In this case, the naming is not consistent with the method name, because a given delegate and <xref:System.EventArgs> type are not tied to a single method.</span></span> <span data-ttu-id="2c2db-202">Toutefois, évitez absolument que les développeurs soit obligés d'effectuer un transtypage de la valeur récupérée d'une propriété sur la classe <xref:System.EventArgs>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-202">However, forcing developers to cast the value retrieved from a property on the <xref:System.EventArgs> is never acceptable.</span></span>  
  
-   <span data-ttu-id="2c2db-203">Si vous créez une classe qui dérive de <xref:System.ComponentModel.Component>, n'implémentez pas et n'installez pas votre propre classe <xref:System.Threading.SynchronizationContext>.</span><span class="sxs-lookup"><span data-stu-id="2c2db-203">If you are authoring a class that derives from <xref:System.ComponentModel.Component>, do not implement and install your own <xref:System.Threading.SynchronizationContext> class.</span></span> <span data-ttu-id="2c2db-204">Ce sont les modèles d'application, pas les composants, qui contrôlent la classe <xref:System.Threading.SynchronizationContext> utilisée.</span><span class="sxs-lookup"><span data-stu-id="2c2db-204">Application models, not components, control the <xref:System.Threading.SynchronizationContext> that is used.</span></span>  
  
-   <span data-ttu-id="2c2db-205">Quand vous utilisez un type quelconque de multithreading, vous vous exposez potentiellement à des bogues sérieux et complexes.</span><span class="sxs-lookup"><span data-stu-id="2c2db-205">When you use multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="2c2db-206">Consultez les [Meilleures pratiques pour le threading managé](../../../docs/standard/threading/managed-threading-best-practices.md) avant d'implémenter une solution qui utilise le multithreading.</span><span class="sxs-lookup"><span data-stu-id="2c2db-206">Before implementing any solution that uses multithreading, see [Managed Threading Best Practices](../../../docs/standard/threading/managed-threading-best-practices.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2c2db-207">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="2c2db-207">See Also</span></span>  
 <xref:System.ComponentModel.AsyncOperation>  
 <xref:System.ComponentModel.AsyncOperationManager>  
 <xref:System.ComponentModel.AsyncCompletedEventArgs>  
 <xref:System.ComponentModel.ProgressChangedEventArgs>  
 <xref:System.ComponentModel.BackgroundWorker>  
 [<span data-ttu-id="2c2db-208">Implémentation du modèle asynchrone basé sur les événements</span><span class="sxs-lookup"><span data-stu-id="2c2db-208">Implementing the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="2c2db-209">Programmation multithread avec le modèle asynchrone basé sur les événements</span><span class="sxs-lookup"><span data-stu-id="2c2db-209">Multithreaded Programming with the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/multithreaded-programming-with-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="2c2db-210">Choix du moment auquel implémenter le modèle asynchrone basé sur les événements</span><span class="sxs-lookup"><span data-stu-id="2c2db-210">Deciding When to Implement the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/deciding-when-to-implement-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="2c2db-211">Meilleures pratiques pour implémenter le modèle asynchrone basé sur les événements</span><span class="sxs-lookup"><span data-stu-id="2c2db-211">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/best-practices-for-implementing-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="2c2db-212">Guide pratique : utiliser des composants qui prennent en charge le modèle asynchrone basé sur les événements</span><span class="sxs-lookup"><span data-stu-id="2c2db-212">How to: Use Components That Support the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/how-to-use-components-that-support-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="2c2db-213">Procédure pas à pas : implémenter un composant qui prend en charge le modèle asynchrone basé sur les événements</span><span class="sxs-lookup"><span data-stu-id="2c2db-213">Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)
