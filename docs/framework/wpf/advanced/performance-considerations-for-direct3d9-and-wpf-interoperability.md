---
title: "Considérations sur les performances de l'interopérabilité entre Direct3D9 et WPF"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
caps.latest.revision: "19"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 886ef6c8c9df9d14b5c2a805da2e3948d5e55f69
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2017
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="11155-102">Considérations sur les performances de l'interopérabilité entre Direct3D9 et WPF</span><span class="sxs-lookup"><span data-stu-id="11155-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="11155-103">Vous pouvez héberger le contenu Direct3D9 à l’aide de la <xref:System.Windows.Interop.D3DImage> classe.</span><span class="sxs-lookup"><span data-stu-id="11155-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="11155-104">Hébergement du contenu de Direct3D9 peut affecter les performances de votre application.</span><span class="sxs-lookup"><span data-stu-id="11155-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="11155-105">Cette rubrique décrit les meilleures pratiques pour optimiser les performances lors de l’hébergement de contenu Direct3D9 dans une application Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="11155-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="11155-106">Ces meilleures pratiques incluent l’utilisation de <xref:System.Windows.Interop.D3DImage> et les meilleures pratiques lorsque vous utilisez Windows Vista, Windows XP, et affiche des écrans multiples.</span><span class="sxs-lookup"><span data-stu-id="11155-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="11155-107">Pour obtenir des exemples de code qui illustrent ces meilleures pratiques, consultez [WPF et Direct3D9 interopérabilité](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="11155-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="11155-108">Utilisez avec modération de D3DImage</span><span class="sxs-lookup"><span data-stu-id="11155-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="11155-109">Le contenu Direct3D9 hébergé dans un <xref:System.Windows.Interop.D3DImage> instance ne rend pas aussi rapide que dans une application Direct3D pure.</span><span class="sxs-lookup"><span data-stu-id="11155-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="11155-110">Copie de la surface et de vider le tampon de commande peuvent être des opérations coûteuses.</span><span class="sxs-lookup"><span data-stu-id="11155-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="11155-111">Comme le nombre de <xref:System.Windows.Interop.D3DImage> augmente d’instances, plus se produit et dégradent les performances.</span><span class="sxs-lookup"><span data-stu-id="11155-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="11155-112">Par conséquent, vous devez utiliser <xref:System.Windows.Interop.D3DImage> avec parcimonie.</span><span class="sxs-lookup"><span data-stu-id="11155-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="11155-113">Meilleures pratiques sur Windows Vista</span><span class="sxs-lookup"><span data-stu-id="11155-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="11155-114">Pour de meilleures performances sur Windows Vista avec un affichage qui est configuré pour utiliser le modèle de pilote d’affichage de Windows (WDDM), créez votre surface Direct3D9 sur un `IDirect3DDevice9Ex` appareil.</span><span class="sxs-lookup"><span data-stu-id="11155-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="11155-115">Cela permet le partage de surface.</span><span class="sxs-lookup"><span data-stu-id="11155-115">This enables surface sharing.</span></span> <span data-ttu-id="11155-116">La carte vidéo doit prendre en charge la `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` et `D3DCAPS2_CANSHARERESOURCE` fonctionnalités du pilote sur Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="11155-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="11155-117">Tous les autres paramètres entraînent la surface à être copiée via le logiciel, ce qui réduit considérablement les performances.</span><span class="sxs-lookup"><span data-stu-id="11155-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="11155-118">Si Windows Vista a un affichage qui est configuré pour utiliser le modèle de pilote d’affichage de Windows XP (XDDM), la surface est toujours copiée via le logiciel, indépendamment des paramètres.</span><span class="sxs-lookup"><span data-stu-id="11155-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="11155-119">Avec les paramètres appropriés et de la carte vidéo, vous verrez meilleures performances sur Windows Vista lorsque vous utilisez le WDDM, car la copie de la surface est effectuées dans le matériel.</span><span class="sxs-lookup"><span data-stu-id="11155-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="11155-120">Meilleures pratiques sur Windows XP</span><span class="sxs-lookup"><span data-stu-id="11155-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="11155-121">Pour de meilleures performances sur Windows XP, qui utilise le modèle de pilote affichage (XDDM) de Windows XP, créez une surface verrouillable qui se comporte correctement lorsque le `IDirect3DSurface9::GetDC` méthode est appelée.</span><span class="sxs-lookup"><span data-stu-id="11155-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="11155-122">En interne, le `BitBlt` méthode transfère la surface pour les appareils dans le matériel.</span><span class="sxs-lookup"><span data-stu-id="11155-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="11155-123">Le `GetDC` méthode fonctionne toujours sur les surfaces XRGB.</span><span class="sxs-lookup"><span data-stu-id="11155-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="11155-124">Toutefois, si l’ordinateur client exécute Windows XP avec SP3 ou SP2, et si le client a également le correctif logiciel pour la fonctionnalité de superposition des fenêtres, cette méthode fonctionne uniquement sur les surfaces ARVB.</span><span class="sxs-lookup"><span data-stu-id="11155-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="11155-125">La carte vidéo doit prendre en charge la `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` fonctionnalité de pilote.</span><span class="sxs-lookup"><span data-stu-id="11155-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="11155-126">Une profondeur de l’affichage du bureau 16 bits peut réduire considérablement les performances.</span><span class="sxs-lookup"><span data-stu-id="11155-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="11155-127">Un ordinateur 32 bits est recommandé.</span><span class="sxs-lookup"><span data-stu-id="11155-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="11155-128">Si vous développez pour Windows Vista et Windows XP, testez les performances sur Windows XP.</span><span class="sxs-lookup"><span data-stu-id="11155-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="11155-129">Exécution de la mémoire vidéo sur Windows XP est une préoccupation.</span><span class="sxs-lookup"><span data-stu-id="11155-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="11155-130">En outre, <xref:System.Windows.Interop.D3DImage> sur Windows XP utilise plus de mémoire vidéo et de bande passante que Windows Vista WDDM, en raison d’une copie de mémoire vidéo supplémentaire nécessaire.</span><span class="sxs-lookup"><span data-stu-id="11155-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="11155-131">Par conséquent, vous pouvez prévoir les performances soient moins bonnes sur Windows XP que sur Windows Vista pour le même matériel vidéo.</span><span class="sxs-lookup"><span data-stu-id="11155-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="11155-132">XDDM est disponible sur Windows XP et Windows Vista. Toutefois, WDDM est disponible uniquement sur Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="11155-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="11155-133">Meilleures pratiques générales</span><span class="sxs-lookup"><span data-stu-id="11155-133">General Best Practices</span></span>  
 <span data-ttu-id="11155-134">Lorsque vous créez le périphérique, utilisez le `D3DCREATE_MULTITHREADED` indicateur de création.</span><span class="sxs-lookup"><span data-stu-id="11155-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="11155-135">Cela réduit les performances, mais le système de rendu WPF appelle les méthodes sur ce périphérique à partir d’un autre thread.</span><span class="sxs-lookup"><span data-stu-id="11155-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="11155-136">Veillez à suivre le protocole de verrouillage correctement, afin qu’aucun des deux threads y accéder en même temps.</span><span class="sxs-lookup"><span data-stu-id="11155-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="11155-137">Si votre rendu est exécuté sur un thread managé WPF, il est fortement recommandé de créer le périphérique avec le `D3DCREATE_FPU_PRESERVE` indicateur de création.</span><span class="sxs-lookup"><span data-stu-id="11155-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="11155-138">Sans ce paramètre, le rendu D3D peut réduire la précision des opérations à double précision WPF et de présenter des problèmes de rendu.</span><span class="sxs-lookup"><span data-stu-id="11155-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="11155-139">Affichage en mosaïque un <xref:System.Windows.Interop.D3DImage> est rapide, sauf si vous disposer en mosaïque une surface non pow2 sans prise en charge matérielle, ou si vous mettez en mosaïque une <xref:System.Windows.Media.DrawingBrush> ou <xref:System.Windows.Media.VisualBrush> qui contient un <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="11155-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="11155-140">Meilleures pratiques pour l’affichage sur plusieurs écrans</span><span class="sxs-lookup"><span data-stu-id="11155-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="11155-141">Si vous utilisez un ordinateur qui dispose de plusieurs moniteurs, vous devez suivre les meilleures pratiques décrites précédemment.</span><span class="sxs-lookup"><span data-stu-id="11155-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="11155-142">Il existe également certaines considérations supplémentaires sur les performances d’une configuration à plusieurs écran.</span><span class="sxs-lookup"><span data-stu-id="11155-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="11155-143">Lorsque vous créez la mémoire tampon d’arrière-plan, il est créé sur un périphérique spécifique et l’adaptateur, mais WPF peut afficher le tampon d’affichage sur toutes les cartes.</span><span class="sxs-lookup"><span data-stu-id="11155-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="11155-144">Copie pour des adaptateurs pour mettre à jour le tampon d’affichage peut être très coûteuse.</span><span class="sxs-lookup"><span data-stu-id="11155-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="11155-145">Sur Windows Vista, qui est configuré pour utiliser le WDDM avec plusieurs cartes vidéos et un `IDirect3DDevice9Ex` appareil, si le tampon d’affichage se trouve sur un autre adaptateur mais toujours sur la même carte vidéo, il n’existe aucune altération des performances.</span><span class="sxs-lookup"><span data-stu-id="11155-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="11155-146">Toutefois, sur Windows XP et le XDDM possède plusieurs cartes vidéo, il est sensiblement les performances lorsque le tampon d’affichage s’affiche sur un autre adaptateur que la mémoire tampon d’arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="11155-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="11155-147">Pour plus d’informations, consultez [WPF et Direct3D9 interopérabilité](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="11155-147">For more information, see [WPF and Direct3D9 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="11155-148">Résumé des performances</span><span class="sxs-lookup"><span data-stu-id="11155-148">Performance Summary</span></span>  
 <span data-ttu-id="11155-149">Le tableau suivant montre les performances de la mise à jour du tampon d’affichage en fonction du système d’exploitation, le format de pixel et verrouillabilité de la surface.</span><span class="sxs-lookup"><span data-stu-id="11155-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="11155-150">Le tampon d’affichage et de la mémoire tampon d’arrière-plan sont supposées pour se trouver sur la même carte.</span><span class="sxs-lookup"><span data-stu-id="11155-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="11155-151">Selon la configuration de la carte, les mises à jour matérielles sont généralement beaucoup plus rapides que les mises à jour logicielles.</span><span class="sxs-lookup"><span data-stu-id="11155-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="11155-152">Format de pixel de la surface</span><span class="sxs-lookup"><span data-stu-id="11155-152">Surface pixel format</span></span>|<span data-ttu-id="11155-153">9Ex, WDDM et Windows Vista</span><span class="sxs-lookup"><span data-stu-id="11155-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="11155-154">Autres configurations Windows Vista</span><span class="sxs-lookup"><span data-stu-id="11155-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="11155-155">Windows XP SP3 ou SP2 avec correctif logiciel</span><span class="sxs-lookup"><span data-stu-id="11155-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="11155-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="11155-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="11155-157">D3DFMT_X8R8G8B8 (non verrouillable)</span><span class="sxs-lookup"><span data-stu-id="11155-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="11155-158">**Mise à jour du matériel**</span><span class="sxs-lookup"><span data-stu-id="11155-158">**Hardware Update**</span></span>|<span data-ttu-id="11155-159">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-159">Software Update</span></span>|<span data-ttu-id="11155-160">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-160">Software Update</span></span>|<span data-ttu-id="11155-161">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-161">Software Update</span></span>|  
|<span data-ttu-id="11155-162">D3DFMT_X8R8G8B8 (verrouillable)</span><span class="sxs-lookup"><span data-stu-id="11155-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="11155-163">**Mise à jour du matériel**</span><span class="sxs-lookup"><span data-stu-id="11155-163">**Hardware Update**</span></span>|<span data-ttu-id="11155-164">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-164">Software Update</span></span>|<span data-ttu-id="11155-165">**Mise à jour du matériel**</span><span class="sxs-lookup"><span data-stu-id="11155-165">**Hardware Update**</span></span>|<span data-ttu-id="11155-166">**Mise à jour du matériel**</span><span class="sxs-lookup"><span data-stu-id="11155-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="11155-167">D3DFMT_A8R8G8B8 (non verrouillable)</span><span class="sxs-lookup"><span data-stu-id="11155-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="11155-168">**Mise à jour du matériel**</span><span class="sxs-lookup"><span data-stu-id="11155-168">**Hardware Update**</span></span>|<span data-ttu-id="11155-169">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-169">Software Update</span></span>|<span data-ttu-id="11155-170">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-170">Software Update</span></span>|<span data-ttu-id="11155-171">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-171">Software Update</span></span>|  
|<span data-ttu-id="11155-172">D3DFMT_A8R8G8B8 (verrouillable)</span><span class="sxs-lookup"><span data-stu-id="11155-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="11155-173">**Mise à jour du matériel**</span><span class="sxs-lookup"><span data-stu-id="11155-173">**Hardware Update**</span></span>|<span data-ttu-id="11155-174">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-174">Software Update</span></span>|<span data-ttu-id="11155-175">**Mise à jour du matériel**</span><span class="sxs-lookup"><span data-stu-id="11155-175">**Hardware Update**</span></span>|<span data-ttu-id="11155-176">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="11155-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="11155-177">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="11155-177">See Also</span></span>  
 <xref:System.Windows.Interop.D3DImage>  
 [<span data-ttu-id="11155-178">Interopérabilité WPF et Direct3D9</span><span class="sxs-lookup"><span data-stu-id="11155-178">WPF and Direct3D9 Interoperation</span></span>](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md)  
 [<span data-ttu-id="11155-179">Procédure pas à pas : création de contenu Direct3D9 à héberger dans WPF</span><span class="sxs-lookup"><span data-stu-id="11155-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)  
 [<span data-ttu-id="11155-180">Procédure pas à pas : hébergement de contenu Direct3D9 dans WPF</span><span class="sxs-lookup"><span data-stu-id="11155-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-direct3d9-content-in-wpf.md)
