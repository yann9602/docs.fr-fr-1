---
title: "Procédure pas à pas : utilisation des services d'application cliente"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- application services host [client application services]
- client application services, walkthroughs
ms.assetid: bb7c8950-4517-4dae-b705-b74a14059b26
caps.latest.revision: 47
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.translationtype: HT
ms.sourcegitcommit: 306c608dc7f97594ef6f72ae0f5aaba596c936e1
ms.openlocfilehash: 64a27269ee6f3711f0c51f2c97cd8876c3ea6103
ms.contentlocale: fr-fr
ms.lasthandoff: 07/28/2017

---
# <a name="walkthrough-using-client-application-services"></a><span data-ttu-id="4d838-102">Procédure pas à pas : utilisation des services d'application cliente</span><span class="sxs-lookup"><span data-stu-id="4d838-102">Walkthrough: Using Client Application Services</span></span>
<span data-ttu-id="4d838-103">Cette rubrique décrit comment créer une application Windows qui utilise des services d'application cliente pour authentifier les utilisateurs et récupérer des rôles d'utilisateur et des paramètres.</span><span class="sxs-lookup"><span data-stu-id="4d838-103">This topic describes how to create a Windows application that uses client application services to authenticate users and retrieve user roles and settings.</span></span>  
  
 <span data-ttu-id="4d838-104">Lors de cette procédure pas à pas, vous allez exécuter les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="4d838-104">In this walkthrough, you perform the following tasks:</span></span>  
  
-   <span data-ttu-id="4d838-105">créer une application Windows Forms et utiliser le concepteur de projets [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] pour activer et configurer les services d'application cliente ;</span><span class="sxs-lookup"><span data-stu-id="4d838-105">Create a Windows Forms application and use the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] project designer to enable and configure client application services.</span></span>  
  
-   <span data-ttu-id="4d838-106">créer une application de service web ASP.NET simple pour héberger les services d'application et tester votre configuration client ;</span><span class="sxs-lookup"><span data-stu-id="4d838-106">Create a simple ASP.NET Web Service application to host the application services and test your client configuration.</span></span>  
  
-   <span data-ttu-id="4d838-107">ajouter l'authentification par formulaire à votre application.</span><span class="sxs-lookup"><span data-stu-id="4d838-107">Add forms authentication to your application.</span></span> <span data-ttu-id="4d838-108">Vous commencerez par utiliser un nom d'utilisateur et un mot de passe codés en dur pour tester le service.</span><span class="sxs-lookup"><span data-stu-id="4d838-108">You will start by using a hard-coded user name and password to test the service.</span></span> <span data-ttu-id="4d838-109">vous ajouterez ensuite un formulaire de connexion en le définissant comme fournisseur d'informations d'identification dans la configuration de l'application ;</span><span class="sxs-lookup"><span data-stu-id="4d838-109">You will then add a login form by specifying it as a credentials provider in your application configuration.</span></span>  
  
-   <span data-ttu-id="4d838-110">ajouter des fonctionnalités basées sur les rôles, avec activation et affichage d'un bouton uniquement pour les utilisateurs ayant le rôle de gestionnaire (« manager ») ;</span><span class="sxs-lookup"><span data-stu-id="4d838-110">Add role-based functionality, enabling and displaying a button only for users in the "manager" role.</span></span>  
  
-   <span data-ttu-id="4d838-111">accéder aux paramètres web.</span><span class="sxs-lookup"><span data-stu-id="4d838-111">Access Web settings.</span></span> <span data-ttu-id="4d838-112">Vous commencerez par charger les paramètres web pour un utilisateur authentifié (test) sur la page **Paramètres** du concepteur de projets.</span><span class="sxs-lookup"><span data-stu-id="4d838-112">You will start by loading Web settings for an authenticated (test) user on the **Settings** page of the project designer.</span></span> <span data-ttu-id="4d838-113">Vous utiliserez ensuite le concepteur Windows Forms pour lier une zone de texte à un paramètre web.</span><span class="sxs-lookup"><span data-stu-id="4d838-113">You will then use the Windows Forms Designer to bind a text box to a Web setting.</span></span> <span data-ttu-id="4d838-114">Enfin, vous enregistrerez la valeur modifiée sur le serveur ;</span><span class="sxs-lookup"><span data-stu-id="4d838-114">Finally, you will save the modified value back to the server.</span></span>  
  
-   <span data-ttu-id="4d838-115">implémenter la déconnexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-115">Implement logout.</span></span> <span data-ttu-id="4d838-116">Vous ajouterez une option de déconnexion au formulaire et appellerez une méthode de déconnexion ;</span><span class="sxs-lookup"><span data-stu-id="4d838-116">You will add a logout option to the form and call a logout method.</span></span>  
  
-   <span data-ttu-id="4d838-117">activer le mode hors connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-117">Enable offline mode.</span></span> <span data-ttu-id="4d838-118">Vous fournirez une case à cocher afin que les utilisateurs puissent spécifier leur état de connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-118">You will provide a check box so that users can specify their connection status.</span></span> <span data-ttu-id="4d838-119">Vous utiliserez ensuite cette valeur pour spécifier si les fournisseurs de services d'application cliente utiliseront les données mises en cache localement au lieu d'accéder à leurs services web.</span><span class="sxs-lookup"><span data-stu-id="4d838-119">You will then use this value to specify whether the client application service providers will use locally cached data instead of accessing their Web services.</span></span> <span data-ttu-id="4d838-120">Enfin, vous authentifierez une nouvelle fois l'utilisateur actuel lorsque l'application repassera en mode en ligne.</span><span class="sxs-lookup"><span data-stu-id="4d838-120">Finally, you will re-authenticate the current user when the application returns to online mode.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="4d838-121">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="4d838-121">Prerequisites</span></span>  
 <span data-ttu-id="4d838-122">Pour exécuter cette procédure pas à pas, vous devez disposer du composant suivant :</span><span class="sxs-lookup"><span data-stu-id="4d838-122">You need the following component to complete this walkthrough:</span></span>  
  
-   [!INCLUDE[vs_orcas_long](../../../includes/vs-orcas-long-md.md)]<span data-ttu-id="4d838-123">.</span><span class="sxs-lookup"><span data-stu-id="4d838-123">.</span></span>  
  
## <a name="creating-the-client-application"></a><span data-ttu-id="4d838-124">Création de l'application cliente</span><span class="sxs-lookup"><span data-stu-id="4d838-124">Creating the Client Application</span></span>  
 <span data-ttu-id="4d838-125">La première chose à faire est de créer un projet Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4d838-125">The first thing that you will do is create a Windows Forms project.</span></span> <span data-ttu-id="4d838-126">Cette procédure pas à pas utilise des projets Windows Forms car ils sont davantage connus, mais le processus est semblable pour les projets Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="4d838-126">This walkthrough uses Windows Forms because more people are familiar with it, but the process is similar for Windows Presentation Foundation (WPF) projects.</span></span>  
  
#### <a name="to-create-a-client-application-and-enable-client-application-services"></a><span data-ttu-id="4d838-127">Pour créer une application cliente et activer les services d'application cliente</span><span class="sxs-lookup"><span data-stu-id="4d838-127">To create a client application and enable client application services</span></span>  
  
1.  <span data-ttu-id="4d838-128">Dans [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], sélectionnez l’option de menu **Fichier &#124; Nouveau &#124; Projet**.</span><span class="sxs-lookup"><span data-stu-id="4d838-128">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], select the **File &#124; New &#124; Project** menu option.</span></span>  
  
2.  <span data-ttu-id="4d838-129">Dans le volet **Types de projets** de la boîte de dialogue **Nouveau projet**, développez le nœud **Visual Basic** ou **Visual C#**, puis sélectionnez le type de projet **Windows**.</span><span class="sxs-lookup"><span data-stu-id="4d838-129">In the **New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Windows** project type.</span></span>  
  
3.  <span data-ttu-id="4d838-130">Assurez-vous que **.NET Framework 3.5** est sélectionné, puis sélectionnez le modèle **Application Windows Forms** .</span><span class="sxs-lookup"><span data-stu-id="4d838-130">Make sure that **.NET Framework 3.5** is selected, and then select the **Windows Forms Application** template.</span></span>  
  
4.  <span data-ttu-id="4d838-131">Remplacez le **Nom** du projet par `ClientAppServicesDemo`, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="4d838-131">Change the project **Name** to `ClientAppServicesDemo`, and then click **OK**.</span></span>  
  
     <span data-ttu-id="4d838-132">Un nouveau projet Windows Forms est ouvert dans [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d838-132">A new Windows Forms project is opened in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span></span>  
  
5.  <span data-ttu-id="4d838-133">Dans le menu **Projet** , sélectionnez **Propriétés ClientAppServicesDemo**.</span><span class="sxs-lookup"><span data-stu-id="4d838-133">On the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="4d838-134">Le concepteur de projet s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-134">The project designer appears.</span></span>  
  
6.  <span data-ttu-id="4d838-135">Sous l'onglet **Services** , sélectionnez **Activer les services d'application cliente**.</span><span class="sxs-lookup"><span data-stu-id="4d838-135">On the **Services** tab, select **Enable client application services**.</span></span>  
  
7.  <span data-ttu-id="4d838-136">Vérifiez que l’option **Utiliser l’authentification par formulaire** est sélectionnée, puis affectez à **Emplacement du service d’authentification**, **Emplacement des services de rôles**et **Emplacement des services de paramètres web** la valeur `http://localhost:55555/AppServices`.</span><span class="sxs-lookup"><span data-stu-id="4d838-136">Make sure that **Use Forms authentication** is selected, and then set **Authentication service location**, **Roles service location**, and **Web settings service location** to `http://localhost:55555/AppServices`.</span></span>  
  
8.  <span data-ttu-id="4d838-137">Pour [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)], sous l'onglet **Application** , affectez à **Mode d'authentification** la valeur **Défini au niveau de l'application**.</span><span class="sxs-lookup"><span data-stu-id="4d838-137">For [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)], on the **Application** tab, set **Authentication mode** to **Application-defined**.</span></span>  
  
 <span data-ttu-id="4d838-138">Le concepteur stocke les paramètres spécifiés dans le fichier app.config de l'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-138">The designer stores the specified settings in the application's app.config file.</span></span>  
  
 <span data-ttu-id="4d838-139">À ce stade, l'application est configurée pour accéder aux trois services du même hôte.</span><span class="sxs-lookup"><span data-stu-id="4d838-139">At this point, the application is configured to access all three services from the same host.</span></span> <span data-ttu-id="4d838-140">Dans la section suivante, vous allez créer l'hôte comme une application de service web simple, ce qui vous permettra de tester votre configuration client.</span><span class="sxs-lookup"><span data-stu-id="4d838-140">In the next section, you will create the host as a simple Web service application, enabling you to test your client configuration.</span></span>  
  
## <a name="creating-the-application-services-host"></a><span data-ttu-id="4d838-141">Création de l'hôte de services d'application</span><span class="sxs-lookup"><span data-stu-id="4d838-141">Creating the Application Services Host</span></span>  
 <span data-ttu-id="4d838-142">Dans cette section, vous allez créer une application de service web simple qui accède aux données utilisateur à partir d'un fichier de base de données SQL Server Compact local.</span><span class="sxs-lookup"><span data-stu-id="4d838-142">In this section, you will create a simple Web service application that accesses user data from a local SQL Server Compact database file.</span></span> <span data-ttu-id="4d838-143">Vous allez ensuite renseigner la base de données à l’aide de l’ [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec).</span><span class="sxs-lookup"><span data-stu-id="4d838-143">Then, you will populate the database using the [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec).</span></span> <span data-ttu-id="4d838-144">Cette configuration simple vous permet de tester rapidement votre application cliente.</span><span class="sxs-lookup"><span data-stu-id="4d838-144">This simple configuration enables you to quickly test your client application.</span></span> <span data-ttu-id="4d838-145">Vous pouvez également configurer l'hôte de service web de façon à ce qu'il accède aux données utilisateur d'une base de données SQL Server complète ou via les classes <xref:System.Web.Security.MembershipProvider> et <xref:System.Web.Security.RoleProvider> personnalisées.</span><span class="sxs-lookup"><span data-stu-id="4d838-145">As an alternative, you can configure the Web service host to access user data from a full SQL Server database or through custom <xref:System.Web.Security.MembershipProvider> and <xref:System.Web.Security.RoleProvider> classes.</span></span> <span data-ttu-id="4d838-146">Pour plus d'informations, consultez [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).</span><span class="sxs-lookup"><span data-stu-id="4d838-146">For more information, see [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).</span></span>  
  
 <span data-ttu-id="4d838-147">Dans la procédure suivante, vous créez et configurez le service web AppServices.</span><span class="sxs-lookup"><span data-stu-id="4d838-147">In the following procedure, you create and configure the AppServices Web service.</span></span>  
  
#### <a name="to-create-and-configure-the-application-services-host"></a><span data-ttu-id="4d838-148">Pour créer et configurer l'hôte de services d'application</span><span class="sxs-lookup"><span data-stu-id="4d838-148">To create and configure the application services host</span></span>  
  
1.  <span data-ttu-id="4d838-149">Dans l’**Explorateur de solutions**, sélectionnez la solution ClientAppServicesDemo, puis dans le menu **Fichier**, sélectionnez **Ajouter | Nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="4d838-149">In **Solution Explorer**, select the ClientAppServicesDemo solution, and then on the **File** menu, select **Add &#124; New Project**.</span></span>  
  
2.  <span data-ttu-id="4d838-150">Dans le volet **Types de projets** de la boîte de dialogue **Nouveau projet**, développez le nœud **Visual Basic** ou **Visual C#**, puis sélectionnez le type de projet **Web**.</span><span class="sxs-lookup"><span data-stu-id="4d838-150">In the **Add New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Web** project type.</span></span>  
  
3.  <span data-ttu-id="4d838-151">Assurez-vous que **.NET Framework 3.5** est sélectionné, puis sélectionnez le modèle **Application de service web ASP.NET** .</span><span class="sxs-lookup"><span data-stu-id="4d838-151">Make sure that **.NET Framework 3.5** is selected, and then select the **ASP.NET Web Service Application** template.</span></span>  
  
4.  <span data-ttu-id="4d838-152">Remplacez le **Nom** du projet par `AppServices` , puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="4d838-152">Change the project **Name** to `AppServices` and then click **OK**.</span></span>  
  
     <span data-ttu-id="4d838-153">Un nouveau projet d'application de service web ASP.NET est ajouté à la solution, et le fichier Service1.asmx.vb ou le fichier Service1.asmx.cs apparaît dans l'éditeur.</span><span class="sxs-lookup"><span data-stu-id="4d838-153">A new ASP.NET Web service application project is added to the solution, and the Service1.asmx.vb or Service1.asmx.cs file appears in the editor.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4d838-154">Le fichier Service1.asmx.vb ou le fichier Service1.asmx.cs n'est pas utilisé dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="4d838-154">The Service1.asmx.vb or Service1.asmx.cs file is not used in this example.</span></span> <span data-ttu-id="4d838-155">Pour que votre environnement de travail ne soit pas encombré, vous pouvez le fermer et le supprimer de l' **Explorateur de solutions**.</span><span class="sxs-lookup"><span data-stu-id="4d838-155">If you want to keep your work environment uncluttered, you can close it and delete it from **Solution Explorer**.</span></span>  
  
5.  <span data-ttu-id="4d838-156">Dans l' **Explorateur de solutions**, sélectionnez le projet AppServices, puis dans le menu **Projet** , sélectionnez **Propriétés AppServices**.</span><span class="sxs-lookup"><span data-stu-id="4d838-156">In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **AppServices Properties**.</span></span>  
  
     <span data-ttu-id="4d838-157">Le concepteur de projet s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-157">The project designer appears.</span></span>  
  
6.  <span data-ttu-id="4d838-158">Sous l'onglet **Web** , assurez-vous que l'option **Utiliser le serveur de développement Visual Studio** est sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="4d838-158">On the **Web** tab, make sure that **Use Visual Studio Development Server** is selected.</span></span>  
  
7.  <span data-ttu-id="4d838-159">Sélectionnez **Port spécifique**, indiquez la valeur `55555`, puis affectez à **Chemin d’accès virtuel** la valeur `/AppServices`.</span><span class="sxs-lookup"><span data-stu-id="4d838-159">Select **Specific port**, specify a value of `55555`, and then set **Virtual path** to `/AppServices`.</span></span>  
  
8.  <span data-ttu-id="4d838-160">Enregistrez tous les fichiers.</span><span class="sxs-lookup"><span data-stu-id="4d838-160">Save all files.</span></span>  
  
9. <span data-ttu-id="4d838-161">Dans l' **Explorateur de solutions**, ouvrez Web.config et recherchez la balise d'ouverture `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="4d838-161">In **Solution Explorer**, open Web.config and find the `<system.web>` opening tag.</span></span>  
  
10. <span data-ttu-id="4d838-162">Ajoutez le balisage suivant avant la balise `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="4d838-162">Add the following markup before the `<system.web>` tag.</span></span>  
  
     <span data-ttu-id="4d838-163">Les éléments `authenticationService`, `profileService`et `roleService` de ce balisage activent et configurent les services d'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-163">The `authenticationService`, `profileService`, and `roleService` elements in this markup enable and configure the application services.</span></span> <span data-ttu-id="4d838-164">À des fins de test, la valeur « false » est affectée à l'attribut `requireSSL` de l'élément `authenticationService` .</span><span class="sxs-lookup"><span data-stu-id="4d838-164">For testing purposes, the `requireSSL` attribute of the `authenticationService` element is set to "false".</span></span> <span data-ttu-id="4d838-165">Les attributs `readAccessProperties` et `writeAccessProperties` de l'élément `profileService` indiquent que la propriété `WebSettingsTestText` est en lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="4d838-165">The `readAccessProperties` and `writeAccessProperties` attributes of the `profileService` element indicate that the `WebSettingsTestText` property is read/write.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4d838-166">Dans le code de production, vous devez toujours accéder au service d'authentification via le protocole SSL (Secure Sockets Layer, en utilisant le protocole HTTPS).</span><span class="sxs-lookup"><span data-stu-id="4d838-166">In production code, you should always access the authentication service over the secure sockets layer (SSL, by using the HTTPS protocol).</span></span> <span data-ttu-id="4d838-167">Pour plus d’informations sur la configuration de SSL, consultez [Configuration de SSL (Secure Sockets Layer) (Guide des opérations IIS 6.0)](http://go.microsoft.com/fwlink/?LinkId=91844).</span><span class="sxs-lookup"><span data-stu-id="4d838-167">For information about how to set up SSL, see [Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)](http://go.microsoft.com/fwlink/?LinkId=91844).</span></span>  
  
    ```xml  
    <system.web.extensions>  
      <scripting>  
        <webServices>  
          <authenticationService enabled="true" requireSSL = "false"/>  
          <profileService enabled="true"  
            readAccessProperties="WebSettingsTestText"  
            writeAccessProperties="WebSettingsTestText" />  
          <roleService enabled="true"/>  
        </webServices>  
      </scripting>  
    </system.web.extensions>  
    ```  
  
11. <span data-ttu-id="4d838-168">Ajoutez le balisage suivant après la balise d'ouverture `<system.web>` afin qu'il soit dans l'élément `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="4d838-168">Add the following markup after the `<system.web>` opening tag so that it is within the `<system.web>` element.</span></span>  
  
     <span data-ttu-id="4d838-169">L'élément `profile` configure un paramètre web unique nommé `WebSettingsTestText`.</span><span class="sxs-lookup"><span data-stu-id="4d838-169">The `profile` element configures a single Web setting named `WebSettingsTestText`.</span></span>  
  
    ```xml  
    <profile enabled="true" >  
      <properties>  
        <add name="WebSettingsTestText" type="string"   
          readOnly="false" defaultValue="DefaultText"   
          serializeAs="String" allowAnonymous="false" />  
      </properties>  
    </profile>  
    ```  
  
 <span data-ttu-id="4d838-170">Dans la procédure suivante, vous utilisez l'outil Administration de site Web ASP.NET pour effectuer la configuration du service et renseigner le fichier de base de données local.</span><span class="sxs-lookup"><span data-stu-id="4d838-170">In the following procedure, you use the ASP.NET Web Site Administration tool to complete the service configuration and populate the local database file.</span></span> <span data-ttu-id="4d838-171">Vous allez ajouter deux utilisateurs nommés `employee` et `manager` qui appartiennent à deux rôles portant le même nom.</span><span class="sxs-lookup"><span data-stu-id="4d838-171">You will add two users named `employee` and `manager` belonging to two roles with the same names.</span></span> <span data-ttu-id="4d838-172">Les mots de passe de ces utilisateurs sont `employee!` et `manager!` , respectivement.</span><span class="sxs-lookup"><span data-stu-id="4d838-172">The user passwords are `employee!` and `manager!` respectively.</span></span>  
  
#### <a name="to-configure-membership-and-roles"></a><span data-ttu-id="4d838-173">Pour configurer l'appartenance et les rôles</span><span class="sxs-lookup"><span data-stu-id="4d838-173">To configure membership and roles</span></span>  
  
1.  <span data-ttu-id="4d838-174">Dans l' **Explorateur de solutions**, sélectionnez le projet AppServices, puis dans le menu **Projet** , sélectionnez **Configuration ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="4d838-174">In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **ASP.NET Configuration**.</span></span>  
  
     <span data-ttu-id="4d838-175">L' **outil Administration de site Web ASP.NET** s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-175">The **ASP.NET Web Site Administration Tool** appears.</span></span>  
  
2.  <span data-ttu-id="4d838-176">Sous l'onglet **Sécurité** , cliquez sur **Utilisez l'Assistant Installation de sécurité pour configurer la sécurité étape par étape**.</span><span class="sxs-lookup"><span data-stu-id="4d838-176">On the **Security** tab, click **Use the security Setup Wizard to configure security step by step**.</span></span>  
  
     <span data-ttu-id="4d838-177">L' **Assistant Installation de sécurité** apparaît et affiche l'étape **Bienvenue** .</span><span class="sxs-lookup"><span data-stu-id="4d838-177">The **Security Setup Wizard** appears and displays the **Welcome** step.</span></span>  
  
3.  <span data-ttu-id="4d838-178">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="4d838-178">Click **Next**.</span></span>  
  
     <span data-ttu-id="4d838-179">L'étape **Sélectionnez une méthode accès** s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-179">The **Select Access Method** step appears.</span></span>  
  
4.  <span data-ttu-id="4d838-180">Sélectionnez **À partir d'Internet**.</span><span class="sxs-lookup"><span data-stu-id="4d838-180">Select **From the internet**.</span></span> <span data-ttu-id="4d838-181">Cela configure le service pour utiliser l'authentification par formulaire au lieu de l'authentification Windows.</span><span class="sxs-lookup"><span data-stu-id="4d838-181">This configures the service to use Forms authentication instead of Windows authentication.</span></span>  
  
5.  <span data-ttu-id="4d838-182">Cliquez sur **Suivant** à deux reprises.</span><span class="sxs-lookup"><span data-stu-id="4d838-182">Click **Next** twice.</span></span>  
  
     <span data-ttu-id="4d838-183">L'étape **Définissez les rôles** s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-183">The **Define Roles** step appears.</span></span>  
  
6.  <span data-ttu-id="4d838-184">Sélectionnez **Active les rôles pour ce site Web**.</span><span class="sxs-lookup"><span data-stu-id="4d838-184">Select **Enable roles for this Web site**.</span></span>  
  
7.  <span data-ttu-id="4d838-185">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="4d838-185">Click **Next**.</span></span> <span data-ttu-id="4d838-186">Le formulaire **Créer un nouveau rôle** s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-186">The **Create New Role** form appears.</span></span>  
  
8.  <span data-ttu-id="4d838-187">Dans la zone de texte **Nouveau nom de rôle** , tapez `manager` , puis cliquez sur **Ajouter le rôle**.</span><span class="sxs-lookup"><span data-stu-id="4d838-187">In the **New Role Name** text box, type `manager` and then click **Add Role**.</span></span>  
  
     <span data-ttu-id="4d838-188">La table **Rôles existants** apparaît avec la valeur spécifiée.</span><span class="sxs-lookup"><span data-stu-id="4d838-188">The **Existing Roles** table appears with the specified value.</span></span>  
  
9. <span data-ttu-id="4d838-189">Dans la zone de texte **Nouveau nom de rôle** , remplacez `manager` par `employee` , puis cliquez sur **Ajouter le rôle**.</span><span class="sxs-lookup"><span data-stu-id="4d838-189">In the **New Role Name** text box, replace `manager` with `employee` and then click **Add Role**.</span></span>  
  
     <span data-ttu-id="4d838-190">La nouvelle valeur apparaît dans la table **Rôles existants** .</span><span class="sxs-lookup"><span data-stu-id="4d838-190">The new value appears in the **Existing Roles** table.</span></span>  
  
10. <span data-ttu-id="4d838-191">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="4d838-191">Click **Next**.</span></span>  
  
     <span data-ttu-id="4d838-192">L'étape **Ajoutez de nouveaux utilisateurs** s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-192">The **Add New Users** step appears.</span></span>  
  
11. <span data-ttu-id="4d838-193">Dans le formulaire **Créer un utilisateur** , spécifiez les valeurs suivantes.</span><span class="sxs-lookup"><span data-stu-id="4d838-193">In the **Create User** form, specify the following values.</span></span>  
  
  	|||  
  	|-|-|  
  	|<span data-ttu-id="4d838-194">**Nom d'utilisateur**</span><span class="sxs-lookup"><span data-stu-id="4d838-194">**User Name**</span></span>|`manager`|  
  	|<span data-ttu-id="4d838-195">**Mot de passe**</span><span class="sxs-lookup"><span data-stu-id="4d838-195">**Password**</span></span>|`manager!`|  
  	|<span data-ttu-id="4d838-196">**Confirmer le mot de passe**</span><span class="sxs-lookup"><span data-stu-id="4d838-196">**Confirm Password**</span></span>|`manager!`|  
  	|<span data-ttu-id="4d838-197">**Message électronique**</span><span class="sxs-lookup"><span data-stu-id="4d838-197">**E-mail**</span></span>|`manager@contoso.com`|  
  	|<span data-ttu-id="4d838-198">**Question de sécurité**</span><span class="sxs-lookup"><span data-stu-id="4d838-198">**Security Question**</span></span>|`manager`|  
  	|<span data-ttu-id="4d838-199">**Réponse de sécurité**</span><span class="sxs-lookup"><span data-stu-id="4d838-199">**Security Answer**</span></span>|`manager`|  
  
12. <span data-ttu-id="4d838-200">Cliquez sur **Créer un utilisateur**.</span><span class="sxs-lookup"><span data-stu-id="4d838-200">Click **Create User**.</span></span>  
  
     <span data-ttu-id="4d838-201">Un message indiquant la réussite de l'opération s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-201">A success message appears.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4d838-202">Les valeurs **Adresse de messagerie**, **Question de sécurité**et **Réponse de sécurité** sont requises par le formulaire, mais ne sont pas utilisées dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="4d838-202">The **E-mail**, **Security Question**, and **Security Answer** values are required by the form, but are not used in this example.</span></span>  
  
13. <span data-ttu-id="4d838-203">Cliquez sur **Continuer**.</span><span class="sxs-lookup"><span data-stu-id="4d838-203">Click **Continue**.</span></span>  
  
     <span data-ttu-id="4d838-204">Le formulaire **Créer un utilisateur** s'affiche de nouveau.</span><span class="sxs-lookup"><span data-stu-id="4d838-204">The **Create User** form reappears.</span></span>  
  
14. <span data-ttu-id="4d838-205">Dans le formulaire **Créer un utilisateur** , spécifiez les valeurs suivantes.</span><span class="sxs-lookup"><span data-stu-id="4d838-205">In the **Create User** form, specify the following values.</span></span>  
  
  	|||  
  	|-|-|  
  	|<span data-ttu-id="4d838-206">**Nom d'utilisateur**</span><span class="sxs-lookup"><span data-stu-id="4d838-206">**User Name**</span></span>|`employee`|  
  	|<span data-ttu-id="4d838-207">**Mot de passe**</span><span class="sxs-lookup"><span data-stu-id="4d838-207">**Password**</span></span>|`employee!`|  
  	|<span data-ttu-id="4d838-208">**Confirmer le mot de passe**</span><span class="sxs-lookup"><span data-stu-id="4d838-208">**Confirm Password**</span></span>|`employee!`|  
  	|<span data-ttu-id="4d838-209">**Message électronique**</span><span class="sxs-lookup"><span data-stu-id="4d838-209">**E-mail**</span></span>|`employee@contoso.com`|  
  	|<span data-ttu-id="4d838-210">**Question de sécurité**</span><span class="sxs-lookup"><span data-stu-id="4d838-210">**Security Question**</span></span>|`Employee`|  
  	|<span data-ttu-id="4d838-211">**Réponse de sécurité**</span><span class="sxs-lookup"><span data-stu-id="4d838-211">**Security Answer**</span></span>|`employee`|  
  
15. <span data-ttu-id="4d838-212">Cliquez sur **Créer un utilisateur**.</span><span class="sxs-lookup"><span data-stu-id="4d838-212">Click **Create User**.</span></span>  
  
     <span data-ttu-id="4d838-213">Un message indiquant la réussite de l'opération s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-213">A success message appears.</span></span>  
  
16. <span data-ttu-id="4d838-214">Cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="4d838-214">Click **Finish**.</span></span>  
  
     <span data-ttu-id="4d838-215">L' **outil Administration de site Web** s'affiche de nouveau.</span><span class="sxs-lookup"><span data-stu-id="4d838-215">The **Web Site Administration Tool** reappears.</span></span>  
  
17. <span data-ttu-id="4d838-216">Cliquez sur **Utilisateurs manager**.</span><span class="sxs-lookup"><span data-stu-id="4d838-216">Click **Manager users**.</span></span>  
  
     <span data-ttu-id="4d838-217">La liste des utilisateurs s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-217">The list of users appears.</span></span>  
  
18. <span data-ttu-id="4d838-218">Cliquez sur **Modifier les rôles** pour l'utilisateur **employee** , puis sélectionnez le rôle **employee** .</span><span class="sxs-lookup"><span data-stu-id="4d838-218">Click **Edit roles** for the **employee** user, and then select the **employee** role.</span></span>  
  
19. <span data-ttu-id="4d838-219">Cliquez sur **Modifier les rôles** pour l'utilisateur **manager** , puis sélectionnez le rôle **manager** .</span><span class="sxs-lookup"><span data-stu-id="4d838-219">Click **Edit roles** for the **manager** user, and then select the **manager** role.</span></span>  
  
20. <span data-ttu-id="4d838-220">Fermez la fenêtre de navigateur qui héberge l' **outil Administration de site Web**.</span><span class="sxs-lookup"><span data-stu-id="4d838-220">Close the browser window that hosts the **Web Site Administration Tool**.</span></span>  
  
21. <span data-ttu-id="4d838-221">Si un message vous demandant si vous souhaitez recharger le fichier Web.config modifié s'affiche, cliquez sur **Oui**.</span><span class="sxs-lookup"><span data-stu-id="4d838-221">If a message box appears asking if you want to reload the modified Web.config file, click **Yes**.</span></span>  
  
 <span data-ttu-id="4d838-222">Cela termine la configuration du service web.</span><span class="sxs-lookup"><span data-stu-id="4d838-222">This completes the Web service setup.</span></span> <span data-ttu-id="4d838-223">À ce stade, vous pouvez appuyer sur F5 pour exécuter l'application cliente. Le **Serveur de développement ASP.NET** démarre alors automatiquement en même temps que votre application cliente.</span><span class="sxs-lookup"><span data-stu-id="4d838-223">At this point, you can press F5 to run the client application, and the **ASP.NET Development Server** will start automatically along with your client application.</span></span> <span data-ttu-id="4d838-224">Le serveur continue de s'exécuter lorsque vous quittez l'application, mais redémarre en même temps que vous redémarrez l'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-224">The server will continue to run after you exit the application, but will restart when you restart the application.</span></span> <span data-ttu-id="4d838-225">Cela lui permet de détecter les modifications apportées à Web.config.</span><span class="sxs-lookup"><span data-stu-id="4d838-225">This allows it to detect any changes you have made to Web.config.</span></span>  
  
 <span data-ttu-id="4d838-226">Pour arrêter le serveur manuellement, cliquez avec le bouton droit sur l'icône Serveur de développement ASP.NET dans la zone de notification de la barre des tâches, puis cliquez sur **Arrêter**.</span><span class="sxs-lookup"><span data-stu-id="4d838-226">To stop the server manually, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**.</span></span> <span data-ttu-id="4d838-227">Il est parfois utile de vérifier qu'un redémarrage normal se produit.</span><span class="sxs-lookup"><span data-stu-id="4d838-227">This is useful occasionally to make sure that a clean restart occurs.</span></span>  
  
## <a name="adding-forms-authentication"></a><span data-ttu-id="4d838-228">Ajout de l'authentification par formulaire</span><span class="sxs-lookup"><span data-stu-id="4d838-228">Adding Forms Authentication</span></span>  
 <span data-ttu-id="4d838-229">Dans la procédure suivante, vous ajoutez du code au formulaire principal qui essaie de valider l'utilisateur, puis qui refuse l'accès lorsque l'utilisateur fournit des informations d'identification non valides.</span><span class="sxs-lookup"><span data-stu-id="4d838-229">In the following procedure, you add code to the main form that attempts to validate the user, and denies access when the user supplies invalid credentials.</span></span> <span data-ttu-id="4d838-230">Vous utilisez un nom d'utilisateur et un mot de passe codés en dur pour tester le service.</span><span class="sxs-lookup"><span data-stu-id="4d838-230">You use a hard-coded user name and password to test the service.</span></span>  
  
#### <a name="to-validate-the-user-in-your-application-code"></a><span data-ttu-id="4d838-231">Pour valider l'utilisateur dans votre code d'application</span><span class="sxs-lookup"><span data-stu-id="4d838-231">To validate the user in your application code</span></span>  
  
1.  <span data-ttu-id="4d838-232">Dans l’**Explorateur de solutions**, ajoutez au projet ClientAppServicesDemo une référence à l’assembly System.Web.</span><span class="sxs-lookup"><span data-stu-id="4d838-232">In **Solution Explorer**, in the ClientAppServicesDemo project, add a reference to the System.Web assembly.</span></span>  
  
2.  <span data-ttu-id="4d838-233">Sélectionnez le fichier Form1, puis sélectionnez **Afficher | Code** dans le menu principal de [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d838-233">Select the Form1 file and then select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
3.  <span data-ttu-id="4d838-234">Dans l'éditeur de code, ajoutez les instructions suivantes en haut du fichier Form1.</span><span class="sxs-lookup"><span data-stu-id="4d838-234">In the code editor, add the following statements to the top of the Form1 file.</span></span>  
  
     <span data-ttu-id="4d838-235">[!code-csharp[ClientApplicationServices#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)]  [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]</span><span class="sxs-lookup"><span data-stu-id="4d838-235">[!code-csharp[ClientApplicationServices#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)]  [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]</span></span>  
  
4.  <span data-ttu-id="4d838-236">Dans l' **Explorateur de solutions**, double-cliquez sur Form1 pour afficher le concepteur.</span><span class="sxs-lookup"><span data-stu-id="4d838-236">In **Solution Explorer**, double-click Form1 to display the designer.</span></span>  
  
5.  <span data-ttu-id="4d838-237">Dans le concepteur, double-cliquez sur la surface de formulaire pour générer un gestionnaire d'événements <xref:System.Windows.Forms.Form.Load?displayProperty=fullName> nommé `Form1_Load`.</span><span class="sxs-lookup"><span data-stu-id="4d838-237">In the designer, double-click the form surface to generate a <xref:System.Windows.Forms.Form.Load?displayProperty=fullName> event handler named `Form1_Load`.</span></span>  
  
     <span data-ttu-id="4d838-238">L'éditeur de code apparaît avec le curseur dans la méthode `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="4d838-238">The code editor appears with the cursor in the `Form1_Load` method.</span></span>  
  
6.  <span data-ttu-id="4d838-239">Ajoutez le code suivant à la méthode `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="4d838-239">Add the following code to the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="4d838-240">Ce code refuse l'accès aux utilisateurs non authentifiés en fermant l'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-240">This code denies access to unauthenticated users by exiting the application.</span></span> <span data-ttu-id="4d838-241">Vous pouvez également autoriser les utilisateurs non authentifiés à accéder au formulaire, mais leur refuser l'accès à des fonctionnalités spécifiques.</span><span class="sxs-lookup"><span data-stu-id="4d838-241">Alternatively, you could allow unauthenticated users access to the form, but deny access to specific functionality.</span></span> <span data-ttu-id="4d838-242">Normalement, vous ne codez pas en dur le nom d'utilisateur et le mot de passe, mais cela est utile à des fins de test.</span><span class="sxs-lookup"><span data-stu-id="4d838-242">Normally, you will not hard-code the user name and password like this, but it is useful for testing purposes.</span></span> <span data-ttu-id="4d838-243">Dans la section suivante, vous remplacerez ce code par du code plus fiable qui affiche une boîte de dialogue de connexion et inclut la gestion des exceptions.</span><span class="sxs-lookup"><span data-stu-id="4d838-243">In the next section, you will replace this code with more robust code that displays a login dialog box and includes exception handling.</span></span>  
  
     <span data-ttu-id="4d838-244">Notez que la méthode `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> se trouve dans [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d838-244">Note that the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method is in the [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)].</span></span> <span data-ttu-id="4d838-245">Cette méthode délègue son travail au fournisseur d'authentification configuré et retourne la valeur `true` si l'authentification aboutit.</span><span class="sxs-lookup"><span data-stu-id="4d838-245">This method delegates its work to the configured authentication provider, and returns `true` if authentication is successful.</span></span> <span data-ttu-id="4d838-246">Votre application ne requiert pas de référence directe au fournisseur d'authentification du client.</span><span class="sxs-lookup"><span data-stu-id="4d838-246">Your application does not require a direct reference to the client authentication provider.</span></span>  
  
     <span data-ttu-id="4d838-247">[!code-csharp[ClientApplicationServices#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)]  [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]</span><span class="sxs-lookup"><span data-stu-id="4d838-247">[!code-csharp[ClientApplicationServices#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)]  [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]</span></span>  
  
 <span data-ttu-id="4d838-248">Vous pouvez maintenant appuyer sur F5 pour exécuter l'application : étant donné que vous fournissez un nom d'utilisateur et un mot de passe corrects, le formulaire s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-248">You can now press F5 to run the application, and because you provide a correct user name and password, you will see the form.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4d838-249">Si vous ne pouvez pas exécuter l'application, essayez d'arrêter le serveur de développement ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="4d838-249">If you are unable to run the application, try stopping the ASP.NET Development Server.</span></span> <span data-ttu-id="4d838-250">Lorsque le serveur redémarre, vérifiez que la valeur 55555 est définie pour le port.</span><span class="sxs-lookup"><span data-stu-id="4d838-250">When the server restarts, verify that the port is set to 55555.</span></span>  
  
 <span data-ttu-id="4d838-251">Pour afficher à la place le message d'erreur, modifiez les paramètres <xref:System.Web.Security.Membership.ValidateUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="4d838-251">To see the error message instead, change the <xref:System.Web.Security.Membership.ValidateUser%2A> parameters.</span></span> <span data-ttu-id="4d838-252">Par exemple, remplacez le deuxième paramètre `"manager!"` par un mot de passe incorrect tel que `"MANAGER"`.</span><span class="sxs-lookup"><span data-stu-id="4d838-252">For example, replace the second `"manager!"` parameter with an incorrect password like `"MANAGER"`.</span></span>  
  
## <a name="adding-a-login-form-as-a-credentials-provider"></a><span data-ttu-id="4d838-253">Ajout d'un formulaire de connexion en tant que fournisseur d'informations d'identification</span><span class="sxs-lookup"><span data-stu-id="4d838-253">Adding a Login Form as a Credentials Provider</span></span>  
 <span data-ttu-id="4d838-254">Vous pouvez obtenir les informations d'identification de l'utilisateur dans votre code d'application et les passer à la méthode <xref:System.Web.Security.Membership.ValidateUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="4d838-254">You can acquire the user credentials in your application code and pass them to the <xref:System.Web.Security.Membership.ValidateUser%2A> method.</span></span> <span data-ttu-id="4d838-255">Toutefois, il est souvent utile de séparer le code d'acquisition des informations d'identification de votre code d'application, si vous souhaitez le modifier ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="4d838-255">However, it is often useful to keep your credentials-acquiring code separate from your application code, in case you want to change it later.</span></span>  
  
 <span data-ttu-id="4d838-256">Dans la procédure suivante, vous configurez votre application de sorte qu'elle utilise un fournisseur d'informations d'identification, puis vous modifiez votre appel de méthode <xref:System.Web.Security.Membership.ValidateUser%2A> pour passer <xref:System.String.Empty> pour les deux paramètres.</span><span class="sxs-lookup"><span data-stu-id="4d838-256">In the following procedure, you configure your application to use a credentials provider, and then change your <xref:System.Web.Security.Membership.ValidateUser%2A> method call to pass <xref:System.String.Empty> for both parameters.</span></span> <span data-ttu-id="4d838-257">Les chaînes vides envoient un signal à la méthode <xref:System.Web.Security.Membership.ValidateUser%2A> pour appeler la méthode <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> du fournisseur d'informations d'identification configuré.</span><span class="sxs-lookup"><span data-stu-id="4d838-257">The empty strings signal the <xref:System.Web.Security.Membership.ValidateUser%2A> method to call the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> method of the configured credentials provider.</span></span>  
  
#### <a name="to-configure-your-application-to-use-a-credentials-provider"></a><span data-ttu-id="4d838-258">Pour configurer votre application de sorte qu'elle utilise un fournisseur d'informations d'identification</span><span class="sxs-lookup"><span data-stu-id="4d838-258">To configure your application to use a credentials provider</span></span>  
  
1.  <span data-ttu-id="4d838-259">Dans l' **Explorateur de solutions**, sélectionnez le projet ClientAppServicesDemo, puis dans le menu **Projet** , sélectionnez **Propriétés ClientAppServicesDemo**.</span><span class="sxs-lookup"><span data-stu-id="4d838-259">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="4d838-260">Le concepteur de projet s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-260">The project designer appears.</span></span>  
  
2.  <span data-ttu-id="4d838-261">Sous l'onglet **Services** , affectez à **Facultatif : Fournisseur d'informations d'identification** la valeur suivante.</span><span class="sxs-lookup"><span data-stu-id="4d838-261">On the **Services** tab, set **Optional: Credential provider** to the following value.</span></span> <span data-ttu-id="4d838-262">Cette valeur indique le nom de type qualifié d'assembly.</span><span class="sxs-lookup"><span data-stu-id="4d838-262">This value indicates the assembly-qualified type name.</span></span>  
  
    ```  
    ClientAppServicesDemo.Login, ClientAppServicesDemo  
    ```  
  
3.  <span data-ttu-id="4d838-263">Dans le fichier de code Form1, remplacez le code dans la méthode `Form1_Load` par le code suivant.</span><span class="sxs-lookup"><span data-stu-id="4d838-263">In the Form1 code file, replace the code in the `Form1_Load` method with the following code.</span></span>  
  
     <span data-ttu-id="4d838-264">Ce code affiche un message d'accueil, puis appelle la méthode `ValidateUsingCredentialsProvider` que vous ajouterez dans l'étape suivante.</span><span class="sxs-lookup"><span data-stu-id="4d838-264">This code displays a welcome message and then calls the `ValidateUsingCredentialsProvider` method that you will add in the next step.</span></span> <span data-ttu-id="4d838-265">Si l'utilisateur n'est pas authentifié, la méthode `ValidateUsingCredentialsProvider` retourne `false` et la méthode `Form1_Load` est retournée.</span><span class="sxs-lookup"><span data-stu-id="4d838-265">If the user is not authenticated, the `ValidateUsingCredentialsProvider` method returns `false` and the `Form1_Load` method returns.</span></span> <span data-ttu-id="4d838-266">Cela empêche tout code supplémentaire de s'exécuter avant la fermeture de l'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-266">This prevents any additional code from running before the application exits.</span></span> <span data-ttu-id="4d838-267">Le message d'accueil est utile pour préciser ce point lorsque l'application redémarre.</span><span class="sxs-lookup"><span data-stu-id="4d838-267">The welcome message is useful to make it clear when the application restarts.</span></span> <span data-ttu-id="4d838-268">Vous ajouterez du code pour redémarrer l'application lorsque vous implémenterez la déconnexion à une étape ultérieure de cette procédure pas à pas.</span><span class="sxs-lookup"><span data-stu-id="4d838-268">You will add code to restart the application when you implement logout later in this walkthrough.</span></span>  
  
     <span data-ttu-id="4d838-269">[!code-csharp[ClientApplicationServices#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)]  [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]</span><span class="sxs-lookup"><span data-stu-id="4d838-269">[!code-csharp[ClientApplicationServices#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)]  [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]</span></span>  
  
4.  <span data-ttu-id="4d838-270">Ajoutez la méthode suivante après la méthode `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="4d838-270">Add the following method after the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="4d838-271">Cette méthode passe des chaînes vides à la méthode `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> , ce qui provoque l'affichage de la boîte de dialogue Connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-271">This method passes empty strings to the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method, which causes the Login dialog box to appear.</span></span> <span data-ttu-id="4d838-272">Si le service d'authentification n'est pas disponible, la méthode <xref:System.Web.Security.Membership.ValidateUser%2A> lève une <xref:System.Net.WebException>.</span><span class="sxs-lookup"><span data-stu-id="4d838-272">If the authentication service is unavailable, the <xref:System.Web.Security.Membership.ValidateUser%2A> method will throw a <xref:System.Net.WebException>.</span></span> <span data-ttu-id="4d838-273">Dans ce cas, la méthode `ValidateUsingCredentialsProvider` affiche un message d'avertissement et demande si l'utilisateur souhaite refaire une tentative en mode hors connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-273">In this case, the `ValidateUsingCredentialsProvider` method displays a warning message and asks if the user wants to try again in offline mode.</span></span> <span data-ttu-id="4d838-274">Cette fonctionnalité requiert la fonction **Enregistrer le hachage de mot de passe localement pour activer la connexion hors connexion** décrite dans [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="4d838-274">This functionality requires the **Save password hash locally to enable offline login** feature described in [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span> <span data-ttu-id="4d838-275">Cette fonctionnalité est activée par défaut pour les nouveaux projets.</span><span class="sxs-lookup"><span data-stu-id="4d838-275">This feature is enabled by default for new projects.</span></span>  
  
     <span data-ttu-id="4d838-276">Si l'utilisateur n'est pas validé, la méthode `ValidateUsingCredentialsProvider` affiche un message d'erreur et ferme l'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-276">If the user is not validated, the `ValidateUsingCredentialsProvider` method displays an error message and exits the application.</span></span> <span data-ttu-id="4d838-277">Enfin, cette méthode retourne le résultat de la tentative d'authentification.</span><span class="sxs-lookup"><span data-stu-id="4d838-277">Finally, this method returns the result of the authentication attempt.</span></span>  
  
     <span data-ttu-id="4d838-278">[!code-csharp[ClientApplicationServices#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)]  [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]</span><span class="sxs-lookup"><span data-stu-id="4d838-278">[!code-csharp[ClientApplicationServices#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)]  [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]</span></span>  
  
### <a name="creating-a-login-form"></a><span data-ttu-id="4d838-279">Création d'un formulaire de connexion</span><span class="sxs-lookup"><span data-stu-id="4d838-279">Creating a Login Form</span></span>  
 <span data-ttu-id="4d838-280">Un fournisseur d'informations d'identification est une classe qui implémente l'interface <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> .</span><span class="sxs-lookup"><span data-stu-id="4d838-280">A credentials provider is a class that implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.</span></span> <span data-ttu-id="4d838-281">Cette interface a une méthode unique nommée <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> qui retourne un objet <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> .</span><span class="sxs-lookup"><span data-stu-id="4d838-281">This interface has a single method named <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> that returns a <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> object.</span></span> <span data-ttu-id="4d838-282">Les procédures suivantes décrivent comment créer une boîte de dialogue de connexion qui implémente <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> pour s'afficher et retourner les informations d'identification spécifiées par l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4d838-282">The following procedures describe how to create a login dialog box that implements <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> to display itself and return the user-specified credentials.</span></span>  
  
 <span data-ttu-id="4d838-283">Des procédures distinctes sont fournies pour [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] et C#, car [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] fournit un modèle **Formulaire de connexion** .</span><span class="sxs-lookup"><span data-stu-id="4d838-283">Separate procedures are provided for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] and C# because [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] provides a **Login Form** template.</span></span> <span data-ttu-id="4d838-284">Cela permet d'économiser du temps et des efforts de codage.</span><span class="sxs-lookup"><span data-stu-id="4d838-284">This saves some time and coding effort.</span></span>  
  
##### <a name="to-create-a-login-dialog-box-as-a-credentials-provider-in-visual-basic"></a><span data-ttu-id="4d838-285">Pour créer une boîte de dialogue de connexion comme fournisseur d'informations d'identification dans Visual Basic</span><span class="sxs-lookup"><span data-stu-id="4d838-285">To create a login dialog box as a credentials provider in Visual Basic</span></span>  
  
1.  <span data-ttu-id="4d838-286">Dans l' **Explorateur de solutions**, sélectionnez le projet ClientAppServicesDemo, puis dans le menu **Projet** , sélectionnez **Ajouter un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="4d838-286">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add New Item**.</span></span>  
  
2.  <span data-ttu-id="4d838-287">Dans la boîte de dialogue **Ajouter un nouvel élément** , sélectionnez le modèle **Formulaire de connexion** , remplacez la valeur **Nom** par `Login.vb`, puis cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="4d838-287">In the **Add New Item** dialog box, select the **Login Form** template, change the item **Name** to `Login.vb`, and then click **Add**.</span></span>  
  
     <span data-ttu-id="4d838-288">La boîte de dialogue de connexion apparaît dans le Concepteur Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4d838-288">The login dialog box appears in the Windows Forms Designer.</span></span>  
  
3.  <span data-ttu-id="4d838-289">Dans le concepteur, cliquez sur **OK** , puis dans la fenêtre **Propriétés** , affectez à `DialogResult` la valeur `OK`.</span><span class="sxs-lookup"><span data-stu-id="4d838-289">In the designer, select the **OK** button and then, in the **Properties** window, set `DialogResult` to `OK`.</span></span>  
  
4.  <span data-ttu-id="4d838-290">Dans le concepteur, ajoutez un contrôle `CheckBox` au formulaire sous la zone de texte **Mot de passe** .</span><span class="sxs-lookup"><span data-stu-id="4d838-290">In the designer, add a `CheckBox` control to the form under the **Password** text box.</span></span>  
  
5.  <span data-ttu-id="4d838-291">Dans la fenêtre **Propriétés**, spécifiez la valeur **(Nom)** `rememberMeCheckBox` et la valeur **Texte** `&Remember me`.</span><span class="sxs-lookup"><span data-stu-id="4d838-291">In the **Properties** window, specify a **(Name)** value of `rememberMeCheckBox` and a **Text** value of `&Remember me`.</span></span>  
  
6.  <span data-ttu-id="4d838-292">Sélectionnez **Afficher | Code** dans le menu principal de [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d838-292">Select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
7.  <span data-ttu-id="4d838-293">Dans l'éditeur de code, ajoutez le code suivant en haut du fichier.</span><span class="sxs-lookup"><span data-stu-id="4d838-293">In the code editor, add the following code to the top of the file.</span></span>  
  
     <span data-ttu-id="4d838-294">[!code-vb[ClientApplicationServices #101](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#101)]</span><span class="sxs-lookup"><span data-stu-id="4d838-294">[!code-vb[ClientApplicationServices#101](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#101)]</span></span>  
  
8.  <span data-ttu-id="4d838-295">Modifiez la signature de classe pour que la classe implémente l'interface <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider>.</span><span class="sxs-lookup"><span data-stu-id="4d838-295">Modify the class signature so that the class implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.</span></span>  
  
     <span data-ttu-id="4d838-296">[!code-vb[ClientApplicationServices#110](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#110)]</span><span class="sxs-lookup"><span data-stu-id="4d838-296">[!code-vb[ClientApplicationServices#110](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#110)]</span></span>  
  
9. <span data-ttu-id="4d838-297">Assurez-vous que le curseur se trouve après `IClientformsAuthenticationCredentialsProvider`, puis appuyez sur Entrée pour générer la méthode `GetCredentials` .</span><span class="sxs-lookup"><span data-stu-id="4d838-297">Make sure that the cursor is after `IClientformsAuthenticationCredentialsProvider`, and then press ENTER to generate the `GetCredentials` method.</span></span>  
  
10. <span data-ttu-id="4d838-298">Localisez l'implémentation <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A>, puis remplacez-la par le code suivant.</span><span class="sxs-lookup"><span data-stu-id="4d838-298">Locate the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation and then replace it with the following code.</span></span>  
  
     <span data-ttu-id="4d838-299">[!code-vb[ClientApplicationServices#120](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#120)]</span><span class="sxs-lookup"><span data-stu-id="4d838-299">[!code-vb[ClientApplicationServices#120](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#120)]</span></span>  
  
 <span data-ttu-id="4d838-300">La procédure C# suivante fournit la liste de code complète pour une boîte de dialogue de connexion simple.</span><span class="sxs-lookup"><span data-stu-id="4d838-300">The following C# procedure provides the entire code listing for a simple login dialog box.</span></span> <span data-ttu-id="4d838-301">La disposition de cette boîte de dialogue est un peu brute, mais la partie importante est l'implémentation <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> .</span><span class="sxs-lookup"><span data-stu-id="4d838-301">The layout for this dialog box is a bit crude, but the important part is the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation.</span></span>  
  
##### <a name="to-create-a-login-dialog-box-as-a-credentials-provider-in-c"></a><span data-ttu-id="4d838-302">Pour créer une boîte de dialogue de connexion comme fournisseur d'informations d'identification en C#</span><span class="sxs-lookup"><span data-stu-id="4d838-302">To create a login dialog box as a credentials provider in C#</span></span>  
  
1.  <span data-ttu-id="4d838-303">Dans l' **Explorateur de solutions**, sélectionnez le projet ClientAppServicesDemo, puis dans le menu **Projet** , sélectionnez **Ajouter une classe**.</span><span class="sxs-lookup"><span data-stu-id="4d838-303">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add Class**.</span></span>  
  
2.  <span data-ttu-id="4d838-304">Dans la boîte de dialogue **Ajouter un nouvel élément** , remplacez la valeur **Nom** par `Login.cs`, puis cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="4d838-304">In the **Add New Item** dialog box, change the **Name** to `Login.cs`, and then click **Add**.</span></span>  
  
     <span data-ttu-id="4d838-305">Le fichier Login.cs s'ouvre dans l'éditeur de code.</span><span class="sxs-lookup"><span data-stu-id="4d838-305">The Login.cs file opens in the code editor.</span></span>  
  
3.  <span data-ttu-id="4d838-306">Remplacez le code par défaut par le code suivant.</span><span class="sxs-lookup"><span data-stu-id="4d838-306">Replace the default code with the following code.</span></span>  
  
     <span data-ttu-id="4d838-307">[!code-csharp[ClientApplicationServices#200](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Login.cs#200)]</span><span class="sxs-lookup"><span data-stu-id="4d838-307">[!code-csharp[ClientApplicationServices#200](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Login.cs#200)]</span></span>  
  
 <span data-ttu-id="4d838-308">Vous pouvez maintenant exécuter l'application et voir la boîte de dialogue de connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-308">You can now run the application and see the login dialog box appear.</span></span> <span data-ttu-id="4d838-309">Pour tester ce code, essayez différentes informations d'identification, à la fois valides et non valides, et vérifiez que le formulaire n'est accessible qu'avec des informations d'identification valides.</span><span class="sxs-lookup"><span data-stu-id="4d838-309">To test this code, try different credentials, both valid and invalid, and confirm that you can access the form only with valid credentials.</span></span> <span data-ttu-id="4d838-310">Les noms d’utilisateur valides sont `employee` et `manager` avec les mots de passe `employee!` et `manager!` , respectivement.</span><span class="sxs-lookup"><span data-stu-id="4d838-310">Valid user names are `employee` and `manager` with passwords `employee!` and `manager!` respectively.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4d838-311">À ce stade, ne sélectionnez pas **Mémoriser mes informations** , car sinon vous ne pourrez pas vous connecter sous une autre identité tant que vous n'aurez pas implémenté la déconnexion à une étape ultérieure de cette procédure pas à pas.</span><span class="sxs-lookup"><span data-stu-id="4d838-311">Do not select **Remember me** at this point or you will not be able to login as another user until you implement logout later in this walkthrough.</span></span>  
  
## <a name="adding-role-based-functionality"></a><span data-ttu-id="4d838-312">Ajout de fonctionnalités basées sur les rôles</span><span class="sxs-lookup"><span data-stu-id="4d838-312">Adding Role-Based Functionality</span></span>  
 <span data-ttu-id="4d838-313">Dans la procédure suivante, vous ajoutez un bouton au formulaire et l'affichez uniquement pour les utilisateurs ayant le rôle manager.</span><span class="sxs-lookup"><span data-stu-id="4d838-313">In the following procedure, you add a button to the form and display it only for users in the manager role.</span></span>  
  
#### <a name="to-change-the-user-interface-based-on-user-role"></a><span data-ttu-id="4d838-314">Pour modifier l'interface utilisateur selon le rôle de l'utilisateur</span><span class="sxs-lookup"><span data-stu-id="4d838-314">To change the user interface based on user role</span></span>  
  
1.  <span data-ttu-id="4d838-315">Dans l’**Explorateur de solutions**, sélectionnez Form1 dans le projet ClientAppServicesDemo, puis sélectionnez **Afficher | Concepteur** dans le menu principal de [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d838-315">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
2.  <span data-ttu-id="4d838-316">Dans le concepteur, ajoutez un contrôle <xref:System.Windows.Forms.Button> au formulaire à partir de la **Boîte à outils**.</span><span class="sxs-lookup"><span data-stu-id="4d838-316">In the designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.</span></span>  
  
3.  <span data-ttu-id="4d838-317">Dans la fenêtre **Propriétés** , définissez les propriétés suivantes pour le bouton.</span><span class="sxs-lookup"><span data-stu-id="4d838-317">In the **Properties** window, set the following properties for the button.</span></span>  
  
  	|<span data-ttu-id="4d838-318">Propriété</span><span class="sxs-lookup"><span data-stu-id="4d838-318">Property</span></span>|<span data-ttu-id="4d838-319">Valeur</span><span class="sxs-lookup"><span data-stu-id="4d838-319">Value</span></span>|  
  	|--------------|-----------|  
  	|<span data-ttu-id="4d838-320">**(Name)**</span><span class="sxs-lookup"><span data-stu-id="4d838-320">**(Name)**</span></span>|<span data-ttu-id="4d838-321">managerOnlyButton</span><span class="sxs-lookup"><span data-stu-id="4d838-321">managerOnlyButton</span></span>|  
  	|<span data-ttu-id="4d838-322">**Text**</span><span class="sxs-lookup"><span data-stu-id="4d838-322">**Text**</span></span>|<span data-ttu-id="4d838-323">&Manager task</span><span class="sxs-lookup"><span data-stu-id="4d838-323">&Manager task</span></span>|  
  	|<span data-ttu-id="4d838-324">**Visible**</span><span class="sxs-lookup"><span data-stu-id="4d838-324">**Visible**</span></span>|`False`|  
  
4.  <span data-ttu-id="4d838-325">Dans l'éditeur de code pour Form1, ajoutez le code suivant à la fin de la méthode `Form1_Load`</span><span class="sxs-lookup"><span data-stu-id="4d838-325">In the code editor for Form1, add the following code to the end of the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="4d838-326">Ce code appelle la méthode `DisplayButtonForManagerRole` que vous ajouterez à l'étape suivante.</span><span class="sxs-lookup"><span data-stu-id="4d838-326">This code calls the `DisplayButtonForManagerRole` method that you will add in the next step.</span></span>  
  
     <span data-ttu-id="4d838-327">[!code-csharp[ClientApplicationServices#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)]  [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]</span><span class="sxs-lookup"><span data-stu-id="4d838-327">[!code-csharp[ClientApplicationServices#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)]  [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]</span></span>  
  
5.  <span data-ttu-id="4d838-328">Ajoutez la méthode suivante à la fin de la classe Form1.</span><span class="sxs-lookup"><span data-stu-id="4d838-328">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="4d838-329">Cette méthode appelle la méthode <xref:System.Security.Principal.IPrincipal.IsInRole%2A> du <xref:System.Security.Principal.IPrincipal> retourné par la propriété `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="4d838-329">This method calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method of the <xref:System.Security.Principal.IPrincipal> returned by the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property.</span></span> <span data-ttu-id="4d838-330">Pour les applications configurées pour utiliser les services d'application cliente, cette propriété retourne un <xref:System.Web.ClientServices.ClientRolePrincipal>.</span><span class="sxs-lookup"><span data-stu-id="4d838-330">For applications configured to use client application services, this property returns a <xref:System.Web.ClientServices.ClientRolePrincipal>.</span></span> <span data-ttu-id="4d838-331">Étant donné que cette classe implémente l'interface <xref:System.Security.Principal.IPrincipal> , vous n'avez pas besoin de la référencer explicitement.</span><span class="sxs-lookup"><span data-stu-id="4d838-331">Because this class implements the <xref:System.Security.Principal.IPrincipal> interface, you do not need to reference it explicitly.</span></span>  
  
     <span data-ttu-id="4d838-332">Si l'utilisateur est dans le rôle « manager », la méthode `DisplayButtonForManagerRole` affecte à la propriété <xref:System.Windows.Forms.Control.Visible%2A> du `managerOnlyButton` la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="4d838-332">If the user is in the "manager" role, the `DisplayButtonForManagerRole` method sets the <xref:System.Windows.Forms.Control.Visible%2A> property of the `managerOnlyButton` to `true`.</span></span> <span data-ttu-id="4d838-333">Si une <xref:System.Net.WebException> est levée, cette méthode affiche également un message d'erreur indiquant que le service de rôles n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="4d838-333">This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the roles service is unavailable.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4d838-334">La méthode <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> retourne toujours la valeur `false` si la connexion de l'utilisateur a expiré.</span><span class="sxs-lookup"><span data-stu-id="4d838-334">The <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> method will always return `false` if the user login has expired.</span></span> <span data-ttu-id="4d838-335">Cela ne se produit pas si votre application appelle une fois la méthode <xref:System.Security.Principal.IPrincipal.IsInRole%2A> peu après l'authentification, comme indiqué dans l'exemple de code de cette procédure pas à pas.</span><span class="sxs-lookup"><span data-stu-id="4d838-335">This will not occur if your application calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method one time shortly after authentication, as shown in the example code for this walkthrough.</span></span> <span data-ttu-id="4d838-336">Si votre application doit récupérer des rôles d'utilisateur à d'autres moments, vous souhaitez peut-être ajouter du code pour revalider les utilisateurs dont la connexion a expiré.</span><span class="sxs-lookup"><span data-stu-id="4d838-336">If your application must retrieve user roles at other times, you might want to add code to revalidate users whose login has expired.</span></span> <span data-ttu-id="4d838-337">Si des rôles sont attribués à tous les utilisateurs valides, vous pouvez déterminer si la connexion a expiré en appelant la méthode <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="4d838-337">If all valid users are assigned to roles, you can determine whether the login has expired by calling the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> method.</span></span> <span data-ttu-id="4d838-338">Si aucun rôle n'est retourné, la connexion a expiré.</span><span class="sxs-lookup"><span data-stu-id="4d838-338">If no roles are returned, the login has expired.</span></span> <span data-ttu-id="4d838-339">Pour obtenir un exemple de cette fonctionnalité, consultez la méthode <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="4d838-339">For an example of this functionality, see the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> method.</span></span> <span data-ttu-id="4d838-340">Cette fonctionnalité n'est requise que si vous avez sélectionné l'option **Imposer aux utilisateurs de se reconnecter chaque fois que le cookie du serveur expire** dans la configuration de votre application.</span><span class="sxs-lookup"><span data-stu-id="4d838-340">This functionality is only necessary if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration.</span></span> <span data-ttu-id="4d838-341">Pour plus d'informations, consultez [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="4d838-341">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span>  
  
     <span data-ttu-id="4d838-342">[!code-csharp[ClientApplicationServices#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)]  [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]</span><span class="sxs-lookup"><span data-stu-id="4d838-342">[!code-csharp[ClientApplicationServices#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)]  [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]</span></span>  
  
 <span data-ttu-id="4d838-343">Si l'authentification aboutit, le fournisseur d'authentification du client affecte à la propriété <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> une instance de la classe <xref:System.Web.ClientServices.ClientRolePrincipal>.</span><span class="sxs-lookup"><span data-stu-id="4d838-343">If authentication is successful, the client authentication provider sets the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property to an instance of the <xref:System.Web.ClientServices.ClientRolePrincipal> class.</span></span> <span data-ttu-id="4d838-344">Cette classe implémente la méthode <xref:System.Security.Principal.IPrincipal.IsInRole%2A> afin que le travail soit délégué au fournisseur de rôles configuré.</span><span class="sxs-lookup"><span data-stu-id="4d838-344">This class implements the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method so that the work is delegated to the configured role provider.</span></span> <span data-ttu-id="4d838-345">Comme avant, votre code d'application ne requiert pas de référence directe au fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="4d838-345">As before, your application code does not require a direct reference to the service provider.</span></span>  
  
 <span data-ttu-id="4d838-346">Vous pouvez maintenant exécuter l'application et ouvrir une session en tant qu'employé pour constater que le bouton n'apparaît pas, puis ouvrir une session en tant que responsable (« manager ») pour voir le bouton.</span><span class="sxs-lookup"><span data-stu-id="4d838-346">You can now run the application and log in as employee to see that the button does not appear, and then log in as manager to see the button.</span></span>  
  
## <a name="accessing-web-settings"></a><span data-ttu-id="4d838-347">Accès aux paramètres web</span><span class="sxs-lookup"><span data-stu-id="4d838-347">Accessing Web Settings</span></span>  
 <span data-ttu-id="4d838-348">Dans la procédure suivante, vous ajoutez une zone de texte au formulaire et vous la liez à un paramètre web.</span><span class="sxs-lookup"><span data-stu-id="4d838-348">In the following procedure, you add a text box to the form and bind it to a Web setting.</span></span> <span data-ttu-id="4d838-349">Comme le code précédent qui utilise l'authentification et les rôles, votre code de paramètres n'accède pas directement au fournisseur de paramètres.</span><span class="sxs-lookup"><span data-stu-id="4d838-349">Like the previous code that uses authentication and roles, your settings code does not access the settings provider directly.</span></span> <span data-ttu-id="4d838-350">À la place, il utilise la classe `Settings` fortement typée (accessible en tant que `Properties.Settings.Default` en C# et en tant que `My.Settings` en [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) générée pour votre projet par [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d838-350">Instead, it uses the strongly-typed `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) generated for your project by [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span></span>  
  
#### <a name="to-use-web-settings-in-your-user-interface"></a><span data-ttu-id="4d838-351">Pour utiliser des paramètres web dans votre interface utilisateur</span><span class="sxs-lookup"><span data-stu-id="4d838-351">To use Web settings in your user interface</span></span>  
  
1.  <span data-ttu-id="4d838-352">Assurez-vous que le **serveur de développement web ASP.NET** s'exécute encore en vérifiant la zone de notification de la barre des tâches.</span><span class="sxs-lookup"><span data-stu-id="4d838-352">Make sure that the **ASP.NET Web Development Server** is still running by checking the notification area of the taskbar.</span></span> <span data-ttu-id="4d838-353">Si vous avez arrêté le serveur, redémarrez l'application (ce qui démarre automatiquement le serveur), puis fermez la boîte de dialogue de connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-353">If you have stopped the server, restart the application (which starts the server automatically) then close the login dialog box.</span></span>  
  
2.  <span data-ttu-id="4d838-354">Dans l' **Explorateur de solutions**, sélectionnez le projet ClientAppServicesDemo, puis dans le menu **Projet** , sélectionnez **Propriétés ClientAppServicesDemo**.</span><span class="sxs-lookup"><span data-stu-id="4d838-354">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="4d838-355">Le concepteur de projet s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-355">The project designer appears.</span></span>  
  
3.  <span data-ttu-id="4d838-356">Sous l'onglet **Paramètres** , cliquez sur **Charger les paramètres web**.</span><span class="sxs-lookup"><span data-stu-id="4d838-356">On the **Settings** tab, click **Load Web Settings**.</span></span>  
  
     <span data-ttu-id="4d838-357">La boîte de dialogue **Connexion** s'affiche.</span><span class="sxs-lookup"><span data-stu-id="4d838-357">A **Login** dialog box appears.</span></span>  
  
4.  <span data-ttu-id="4d838-358">Entrez les informations d'identification de l'employé ou du gestionnaire, puis cliquez sur **Se connecter**.</span><span class="sxs-lookup"><span data-stu-id="4d838-358">Enter credentials for employee or manager and click **Log In**.</span></span> <span data-ttu-id="4d838-359">Dans la mesure où le paramètre web que vous utiliserez est configuré pour être accessible par les utilisateurs authentifiés uniquement, le fait de cliquer sur **Ignorer la connexion** ne charge aucun paramètre.</span><span class="sxs-lookup"><span data-stu-id="4d838-359">The Web setting you will use is configured for access by authenticated users only, so clicking **Skip Login** will not load any settings.</span></span>  
  
     <span data-ttu-id="4d838-360">Le paramètre `WebSettingsTestText` apparaît dans le concepteur avec la valeur par défaut `DefaultText`.</span><span class="sxs-lookup"><span data-stu-id="4d838-360">The `WebSettingsTestText` setting appears in the designer with the default value of `DefaultText`.</span></span> <span data-ttu-id="4d838-361">En outre, une classe `Settings` contenant une propriété `WebSettingsTestText` est générée pour votre projet.</span><span class="sxs-lookup"><span data-stu-id="4d838-361">Additionally, a `Settings` class that contains a `WebSettingsTestText` property is generated for your project.</span></span>  
  
5.  <span data-ttu-id="4d838-362">Dans l’**Explorateur de solutions**, sélectionnez Form1 dans le projet ClientAppServicesDemo, puis sélectionnez **Afficher | Concepteur** dans le menu principal de [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d838-362">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
6.  <span data-ttu-id="4d838-363">Dans le concepteur, ajoutez un contrôle <xref:System.Windows.Forms.TextBox> au formulaire.</span><span class="sxs-lookup"><span data-stu-id="4d838-363">In the designer, add a <xref:System.Windows.Forms.TextBox> control to the form.</span></span>  
  
7.  <span data-ttu-id="4d838-364">Dans la fenêtre **Propriétés** , définissez la valeur **(Name)** sur `webSettingsTestTextBox`.</span><span class="sxs-lookup"><span data-stu-id="4d838-364">In the **Properties** window, specify a **(Name)** value of `webSettingsTestTextBox`.</span></span>  
  
8.  <span data-ttu-id="4d838-365">Dans l'éditeur de code, ajoutez le code suivant à la fin de la méthode `Form1_Load`</span><span class="sxs-lookup"><span data-stu-id="4d838-365">In the code editor, add the following code to the end of the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="4d838-366">Ce code appelle la méthode `BindWebSettingsTestTextBox` que vous ajouterez à l'étape suivante.</span><span class="sxs-lookup"><span data-stu-id="4d838-366">This code calls the `BindWebSettingsTestTextBox` method that you will add in the next step.</span></span>  
  
     <span data-ttu-id="4d838-367">[!code-csharp[ClientApplicationServices#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)]  [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]</span><span class="sxs-lookup"><span data-stu-id="4d838-367">[!code-csharp[ClientApplicationServices#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)]  [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]</span></span>  
  
9. <span data-ttu-id="4d838-368">Ajoutez la méthode suivante à la fin de la classe Form1.</span><span class="sxs-lookup"><span data-stu-id="4d838-368">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="4d838-369">Cette méthode lie la propriété <xref:System.Windows.Forms.TextBox.Text%2A> de l'élément `webSettingsTestTextBox` à la propriété `WebSettingsTestText` de la classe `Settings` générée précédemment dans cette procédure.</span><span class="sxs-lookup"><span data-stu-id="4d838-369">This method binds the <xref:System.Windows.Forms.TextBox.Text%2A> property of the `webSettingsTestTextBox` to the `WebSettingsTestText` property of the `Settings` class generated earlier in this procedure.</span></span> <span data-ttu-id="4d838-370">Si une <xref:System.Net.WebException> est levée, cette méthode affiche également un message d'erreur indiquant que le service de paramètres web n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="4d838-370">This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the Web settings service is unavailable.</span></span>  
  
     <span data-ttu-id="4d838-371">[!code-csharp[ClientApplicationServices#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)]   [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]</span><span class="sxs-lookup"><span data-stu-id="4d838-371">[!code-csharp[ClientApplicationServices#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)]   [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4d838-372">En général, vous utilisez la liaison de données pour activer la communication bidirectionnelle automatique entre un contrôle et un paramètre web.</span><span class="sxs-lookup"><span data-stu-id="4d838-372">You will typically use data binding to enable automatic two-way communication between a control and a Web setting.</span></span> <span data-ttu-id="4d838-373">Toutefois, vous pouvez aussi accéder directement aux paramètres web comme indiqué dans l'exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="4d838-373">However, you can also access Web settings directly as shown in the following example:</span></span>  
  
     <span data-ttu-id="4d838-374">[!code-csharp[ClientApplicationServices#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)]   [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]</span><span class="sxs-lookup"><span data-stu-id="4d838-374">[!code-csharp[ClientApplicationServices#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)]   [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]</span></span>  
  
10. <span data-ttu-id="4d838-375">Dans le concepteur, sélectionnez le formulaire, puis dans la fenêtre **Propriétés** , cliquez sur le bouton **Événements** .</span><span class="sxs-lookup"><span data-stu-id="4d838-375">In the designer, select the form, and then, in the **Properties** window, click the **Events** button.</span></span>  
  
11. <span data-ttu-id="4d838-376">Sélectionnez l'événement <xref:System.Windows.Forms.Form.FormClosing> , puis appuyez sur Entrée pour générer un gestionnaire d'événements.</span><span class="sxs-lookup"><span data-stu-id="4d838-376">Select the <xref:System.Windows.Forms.Form.FormClosing> event and then press ENTER to generate an event handler.</span></span>  
  
12. <span data-ttu-id="4d838-377">Remplacez la méthode générée par le code suivant.</span><span class="sxs-lookup"><span data-stu-id="4d838-377">Replace the generated method with the following code.</span></span>  
  
     <span data-ttu-id="4d838-378">Le gestionnaire d'événements <xref:System.Windows.Forms.Form.FormClosing> appelle la méthode `SaveSettings` , qui est également utilisée par les fonctionnalités de déconnexion que vous ajouterez dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="4d838-378">The <xref:System.Windows.Forms.Form.FormClosing> event handler calls the `SaveSettings` method, which is also used by the logout functionality that you will add in the next section.</span></span> <span data-ttu-id="4d838-379">La méthode `SaveSettings` vérifie tout d'abord que l'utilisateur ne s'est pas déconnecté.</span><span class="sxs-lookup"><span data-stu-id="4d838-379">The `SaveSettings` method first confirms that the user has not logged out.</span></span> <span data-ttu-id="4d838-380">Pour ce faire, elle contrôle la propriété <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> du <xref:System.Security.Principal.IIdentity> retourné par l'entité de sécurité actuelle.</span><span class="sxs-lookup"><span data-stu-id="4d838-380">It does this by checking the <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> property of the <xref:System.Security.Principal.IIdentity> returned by the current principal.</span></span> <span data-ttu-id="4d838-381">L'entité de sécurité actuelle est extraite via la propriété `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> .</span><span class="sxs-lookup"><span data-stu-id="4d838-381">The current principal is retrieved through the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> property.</span></span> <span data-ttu-id="4d838-382">Si l'utilisateur a été authentifié pour les services d'application cliente, le type d'authentification sera « ClientForms ».</span><span class="sxs-lookup"><span data-stu-id="4d838-382">If the user has been authenticated for client application services, the authentication type will be "ClientForms".</span></span> <span data-ttu-id="4d838-383">La méthode `SaveSettings` ne peut pas uniquement vérifier la propriété <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName> , car l'utilisateur peut avoir une identité Windows valide après la déconnexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-383">The `SaveSettings` method cannot just check the <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName> property because the user might have a valid Windows identity after logout.</span></span>  
  
     <span data-ttu-id="4d838-384">Si l'utilisateur ne s'est pas déconnecté, la méthode `SaveSettings` appelle la méthode <xref:System.Configuration.ApplicationSettingsBase.Save%2A> de la classe `Settings` générée précédemment dans cette procédure.</span><span class="sxs-lookup"><span data-stu-id="4d838-384">If the user has not logged out, the `SaveSettings` method calls the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method of the `Settings` class generated earlier in this procedure.</span></span> <span data-ttu-id="4d838-385">Cette méthode peut lever une <xref:System.Net.WebException> si le cookie d'authentification a expiré.</span><span class="sxs-lookup"><span data-stu-id="4d838-385">This method can throw a <xref:System.Net.WebException> if the authentication cookie has expired.</span></span> <span data-ttu-id="4d838-386">Cela se produit uniquement si vous avez sélectionné l'option **Imposer aux utilisateurs de se reconnecter chaque fois que le cookie du serveur expire** dans la configuration de votre application.</span><span class="sxs-lookup"><span data-stu-id="4d838-386">This occurs only if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration.</span></span> <span data-ttu-id="4d838-387">Pour plus d'informations, consultez [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="4d838-387">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span> <span data-ttu-id="4d838-388">La méthode `SaveSettings` gère l'expiration des cookies en appelant <xref:System.Web.Security.Membership.ValidateUser%2A> pour afficher la boîte de dialogue de connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-388">The `SaveSettings` method handles cookie expiration by calling <xref:System.Web.Security.Membership.ValidateUser%2A> to display the login dialog box.</span></span> <span data-ttu-id="4d838-389">Si l'utilisateur parvient à se connecter, la méthode `SaveSettings` tente d'enregistrer de nouveau les paramètres en s'appelant elle-même.</span><span class="sxs-lookup"><span data-stu-id="4d838-389">If the user logs in successfully, the `SaveSettings` method tries to save the settings again by calling itself.</span></span>  
  
     <span data-ttu-id="4d838-390">Comme dans le code précédent, la méthode `SaveSettings` affiche un message d'erreur si le service distant n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="4d838-390">Like in previous code, the `SaveSettings` method displays an error message if the remote service is unavailable.</span></span> <span data-ttu-id="4d838-391">Si le fournisseur de paramètres ne peut pas accéder au service distant, les paramètres sont encore enregistrés dans le cache local et rechargés lorsque l'application redémarre.</span><span class="sxs-lookup"><span data-stu-id="4d838-391">If the settings provider cannot access the remote service, the settings are still saved to the local cache and reloaded when the application restarts.</span></span>  
  
     <span data-ttu-id="4d838-392">[!code-csharp[ClientApplicationServices#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)]  [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]</span><span class="sxs-lookup"><span data-stu-id="4d838-392">[!code-csharp[ClientApplicationServices#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)]  [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]</span></span>  
  
13. <span data-ttu-id="4d838-393">Ajoutez la méthode suivante à la fin de la classe Form1.</span><span class="sxs-lookup"><span data-stu-id="4d838-393">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="4d838-394">Ce code gère l'événement <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName> et affiche un avertissement si l'un des paramètres n'a pas pu être enregistré.</span><span class="sxs-lookup"><span data-stu-id="4d838-394">This code handles the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName> event and displays a warning if any of the settings could not be saved.</span></span> <span data-ttu-id="4d838-395">L'événement <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> ne se produit pas si le service de paramètres n'est pas disponible ou si le cookie d'authentification a expiré.</span><span class="sxs-lookup"><span data-stu-id="4d838-395">The <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event does not occur if the settings service is unavailable or if the authentication cookie has expired.</span></span> <span data-ttu-id="4d838-396">L'événement <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> se produit par exemple si l'utilisateur s'est déjà déconnecté.</span><span class="sxs-lookup"><span data-stu-id="4d838-396">One example of when the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event will occur is if the user has already logged out.</span></span> <span data-ttu-id="4d838-397">Vous pouvez tester ce gestionnaire d'événements en ajoutant directement du code de déconnexion à la méthode `SaveSettings` avant l'appel de la méthode <xref:System.Configuration.ApplicationSettingsBase.Save%2A> .</span><span class="sxs-lookup"><span data-stu-id="4d838-397">You can test this event handler by adding logout code to the `SaveSettings` method directly before the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method call.</span></span> <span data-ttu-id="4d838-398">Le code de déconnexion que vous pouvez utiliser est décrit dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="4d838-398">Logout code that you can use is described in the next section.</span></span>  
  
     <span data-ttu-id="4d838-399">[!code-csharp[ClientApplicationServices#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)]  [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]</span><span class="sxs-lookup"><span data-stu-id="4d838-399">[!code-csharp[ClientApplicationServices#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)]  [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]</span></span>  
  
14. <span data-ttu-id="4d838-400">Pour C#, ajoutez le code suivant à la fin de la méthode `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="4d838-400">For C#, add the following code to the end of the `Form1_Load` method.</span></span> <span data-ttu-id="4d838-401">Ce code associe la méthode que vous avez ajoutée dans la dernière étape à l'événement <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved>.</span><span class="sxs-lookup"><span data-stu-id="4d838-401">This code associates the method you added in the last step with the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event.</span></span>  
  
     <span data-ttu-id="4d838-402">[!code-csharp[ClientApplicationServices#015](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#015)]</span><span class="sxs-lookup"><span data-stu-id="4d838-402">[!code-csharp[ClientApplicationServices#015](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#015)]</span></span>  
  
 <span data-ttu-id="4d838-403">Pour tester l'application à ce stade, exécutez-la plusieurs fois en tant qu'employé et en tant que gestionnaire (« manager »), et tapez des valeurs différentes dans la zone de texte.</span><span class="sxs-lookup"><span data-stu-id="4d838-403">To test the application at this point, run it multiple times as both employee and manager, and type different values into the text box.</span></span> <span data-ttu-id="4d838-404">Les valeurs sont conservées d'une session à l'autre pour chaque utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4d838-404">The values will persist across sessions on a per-user basis.</span></span>  
  
## <a name="implementing-logout"></a><span data-ttu-id="4d838-405">Implémentation de la déconnexion</span><span class="sxs-lookup"><span data-stu-id="4d838-405">Implementing Logout</span></span>  
 <span data-ttu-id="4d838-406">Lorsque l'utilisateur coche la case **Mémoriser mes informations** au moment de la connexion, l'application authentifie automatiquement l'utilisateur lors des exécutions suivantes.</span><span class="sxs-lookup"><span data-stu-id="4d838-406">When the user selects the **Remember me** check box when logging in, the application will automatically authenticate the user on subsequent runs.</span></span> <span data-ttu-id="4d838-407">L'authentification automatique continue ensuite pendant que l'application est en mode hors connexion ou jusqu'à ce que le cookie d'authentification expire.</span><span class="sxs-lookup"><span data-stu-id="4d838-407">Automatic authentication will then continue while the application is in offline mode or until the authentication cookie expires.</span></span> <span data-ttu-id="4d838-408">Toutefois, il peut arriver que plusieurs utilisateurs aient besoin d'accéder à l'application ou qu'un seul utilisateur se connecte avec des informations d'identification différentes.</span><span class="sxs-lookup"><span data-stu-id="4d838-408">Sometimes, however, multiple users will need access to the application or a single user might occasionally log in with different credentials.</span></span> <span data-ttu-id="4d838-409">Pour permettre ce scénario, vous devez implémenter la fonctionnalité de déconnexion, comme décrit dans la procédure suivante.</span><span class="sxs-lookup"><span data-stu-id="4d838-409">To enable this scenario, you must implement logout functionality, as described in the following procedure.</span></span>  
  
#### <a name="to-implement-logout-functionality"></a><span data-ttu-id="4d838-410">Pour implémenter la fonctionnalité de déconnexion</span><span class="sxs-lookup"><span data-stu-id="4d838-410">To implement logout functionality</span></span>  
  
1.  <span data-ttu-id="4d838-411">Dans le concepteur Form1, ajoutez un contrôle <xref:System.Windows.Forms.Button> au formulaire à partir de la **Boîte à outils**.</span><span class="sxs-lookup"><span data-stu-id="4d838-411">In the Form1 designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.</span></span>  
  
2.  <span data-ttu-id="4d838-412">Dans la fenêtre **Propriétés**, définissez la valeur **(Nom)** sur `logoutButton` et la valeur **Texte** sur **&Se déconnecter**.</span><span class="sxs-lookup"><span data-stu-id="4d838-412">In the **Properties** window, specify a **(Name)** value of `logoutButton` and a **Text** value of **&Log Out**.</span></span>  
  
3.  <span data-ttu-id="4d838-413">Double-cliquez sur `logoutButton` pour générer un gestionnaire d’événements <xref:System.Windows.Forms.Control.Click>.</span><span class="sxs-lookup"><span data-stu-id="4d838-413">Double-click the `logoutButton` to generate a <xref:System.Windows.Forms.Control.Click> event handler.</span></span>  
  
     <span data-ttu-id="4d838-414">L'éditeur de code apparaît avec le curseur dans la méthode `logoutButton_Click` .</span><span class="sxs-lookup"><span data-stu-id="4d838-414">The code editor appears with the cursor in the `logoutButton_Click` method.</span></span>  
  
4.  <span data-ttu-id="4d838-415">Remplacez la méthode `logoutButton_Click` générée par le code suivant.</span><span class="sxs-lookup"><span data-stu-id="4d838-415">Replace the generated `logoutButton_Click` method with the following code.</span></span>  
  
     <span data-ttu-id="4d838-416">Ce gestionnaire d'événements appelle d'abord la méthode `SaveSettings` que vous avez ajoutée dans la section précédente.</span><span class="sxs-lookup"><span data-stu-id="4d838-416">This event handler first calls the `SaveSettings` method that you added in the previous section.</span></span> <span data-ttu-id="4d838-417">Il appelle ensuite la méthode <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="4d838-417">Then, the event handler calls the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName> method.</span></span> <span data-ttu-id="4d838-418">Si le service d'authentification n'est pas disponible, la méthode <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> lève une <xref:System.Net.WebException>.</span><span class="sxs-lookup"><span data-stu-id="4d838-418">If the authentication service is unavailable, the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> method will throw a <xref:System.Net.WebException>.</span></span> <span data-ttu-id="4d838-419">Dans ce cas, la méthode `logoutButton_Click` affiche un message d'avertissement et passe temporairement en mode hors connexion pour déconnecter l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4d838-419">In this case, the `logoutButton_Click` method displays a warning message and switches temporarily to offline mode to log the user out.</span></span> <span data-ttu-id="4d838-420">Le mode hors connexion est décrit dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="4d838-420">Offline mode is described in the next section.</span></span>  
  
     <span data-ttu-id="4d838-421">La déconnexion supprime le cookie d'authentification local afin que la connexion soit requise lorsque l'application est redémarrée.</span><span class="sxs-lookup"><span data-stu-id="4d838-421">Logout deletes the local authentication cookie so that login will be required when the application is restarted.</span></span> <span data-ttu-id="4d838-422">Après la déconnexion, le gestionnaire d'événements redémarre l'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-422">After logout, the event handler restarts the application.</span></span> <span data-ttu-id="4d838-423">Lorsque celle-ci redémarre, elle affiche le message d'accueil, puis la boîte de dialogue de connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-423">When the application restarts, it displays the welcome message followed by the login dialog box.</span></span> <span data-ttu-id="4d838-424">Le message d'accueil indique que l'application a redémarré.</span><span class="sxs-lookup"><span data-stu-id="4d838-424">The welcome message makes it clear that the application has restarted.</span></span> <span data-ttu-id="4d838-425">Cela empêche toute confusion potentielle si l'utilisateur doit se connecter pour enregistrer des paramètres, puis se connecter de nouveau car l'application a redémarré.</span><span class="sxs-lookup"><span data-stu-id="4d838-425">This prevents potential confusion if the user must log in to save settings, and then must log in again because the application has restarted.</span></span>  
  
     <span data-ttu-id="4d838-426">[!code-csharp[ClientApplicationServices#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)]  [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]</span><span class="sxs-lookup"><span data-stu-id="4d838-426">[!code-csharp[ClientApplicationServices#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)]  [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]</span></span>  
  
 <span data-ttu-id="4d838-427">Pour tester la fonctionnalité de déconnexion, exécutez l'application et sélectionnez **Mémoriser mes informations** dans la boîte de dialogue Connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-427">To test the logout functionality, run the application and select **Remember me** on the Login dialog box.</span></span> <span data-ttu-id="4d838-428">Ensuite, fermez et redémarrez l'application pour vérifier que vous n'avez plus à vous connecter.</span><span class="sxs-lookup"><span data-stu-id="4d838-428">Next, close and restart the application to confirm that you no longer have to log in.</span></span> <span data-ttu-id="4d838-429">Enfin, redémarrez l'application en cliquant sur Se déconnecter.</span><span class="sxs-lookup"><span data-stu-id="4d838-429">Finally, restart the application by clicking Log out.</span></span>  
  
## <a name="enabling-offline-mode"></a><span data-ttu-id="4d838-430">Activation du mode hors connexion</span><span class="sxs-lookup"><span data-stu-id="4d838-430">Enabling Offline Mode</span></span>  
 <span data-ttu-id="4d838-431">Dans la procédure suivante, vous ajoutez une case à cocher au formulaire pour permettre à l'utilisateur de passer en mode hors connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-431">In the following procedure, you add a check box to the form to enable the user to enter offline mode.</span></span> <span data-ttu-id="4d838-432">Votre application indique le mode hors connexion en affectant à la propriété `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName> la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="4d838-432">Your application indicates offline mode by setting the `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName> property to `true`.</span></span> <span data-ttu-id="4d838-433">L'état hors connexion est stocké sur le disque dur local à l'emplacement indiqué par la propriété <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="4d838-433">The offline status is stored on the local hard disk at the location indicated by the <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName> property.</span></span> <span data-ttu-id="4d838-434">Cela signifie que l'état hors connexion est stocké par utilisateur, pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="4d838-434">This means that the offline status is stored on a per-user, per-application basis.</span></span>  
  
 <span data-ttu-id="4d838-435">En mode hors connexion, toutes les requêtes de service d'application cliente récupèrent des données du cache local au lieu de tenter d'accéder aux services.</span><span class="sxs-lookup"><span data-stu-id="4d838-435">In offline mode, all client application service requests retrieve data from the local cache instead of trying to access the services.</span></span> <span data-ttu-id="4d838-436">Dans la configuration par défaut, les données locales incluent une forme chiffrée du mot de passe de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4d838-436">In the default configuration, the local data includes an encrypted form of the user's password.</span></span> <span data-ttu-id="4d838-437">Cela permet à l'utilisateur de se connecter pendant que l'application est en mode hors connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-437">This enables the user to log in while the application is in offline mode.</span></span> <span data-ttu-id="4d838-438">Pour plus d'informations, consultez [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="4d838-438">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span>  
  
#### <a name="to-enable-offline-mode-in-your-application"></a><span data-ttu-id="4d838-439">Pour activer le mode hors connexion dans votre application</span><span class="sxs-lookup"><span data-stu-id="4d838-439">To enable offline mode in your application</span></span>  
  
1.  <span data-ttu-id="4d838-440">Dans l’**Explorateur de solutions**, sélectionnez Form1 dans le projet ClientAppServicesDemo, puis sélectionnez **Afficher | Concepteur** dans le menu principal de [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d838-440">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
2.  <span data-ttu-id="4d838-441">Dans le concepteur, ajoutez un contrôle <xref:System.Windows.Forms.CheckBox> au formulaire.</span><span class="sxs-lookup"><span data-stu-id="4d838-441">In the designer, add a <xref:System.Windows.Forms.CheckBox> control to the form.</span></span>  
  
3.  <span data-ttu-id="4d838-442">Dans la fenêtre **Propriétés**, définissez la valeur **(Nom)** sur `workOfflineCheckBox` et la valeur **Texte** sur **&Travailler hors connexion**.</span><span class="sxs-lookup"><span data-stu-id="4d838-442">In the **Properties** window, specify a **(Name)** value of `workOfflineCheckBox` and a **Text** value of **&Work offline**.</span></span>  
  
4.  <span data-ttu-id="4d838-443">Dans la fenêtre **Propriétés** , cliquez sur le bouton **Événements** .</span><span class="sxs-lookup"><span data-stu-id="4d838-443">In the **Properties** window, click the **Events** button.</span></span>  
  
5.  <span data-ttu-id="4d838-444">Sélectionnez l'événement <xref:System.Windows.Forms.CheckBox.CheckedChanged> , puis appuyez sur Entrée pour générer un gestionnaire d'événements.</span><span class="sxs-lookup"><span data-stu-id="4d838-444">Select the <xref:System.Windows.Forms.CheckBox.CheckedChanged> event and then press ENTER to generate an event handler.</span></span>  
  
6.  <span data-ttu-id="4d838-445">Remplacez la méthode générée par le code suivant.</span><span class="sxs-lookup"><span data-stu-id="4d838-445">Replace the generated method with the following code.</span></span>  
  
     <span data-ttu-id="4d838-446">Ce code met à jour la valeur <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> et revalide silencieusement l'utilisateur lors du passage en mode en ligne.</span><span class="sxs-lookup"><span data-stu-id="4d838-446">This code updates the <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> value and silently revalidates the user when they return to online mode.</span></span> <span data-ttu-id="4d838-447">La méthode <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName> utilise les informations d'identification mises en cache pour que l'utilisateur n'ait pas explicitement à se connecter.</span><span class="sxs-lookup"><span data-stu-id="4d838-447">The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName> method uses the cached credentials so that the user does not have to explicitly log in.</span></span> <span data-ttu-id="4d838-448">Si le service d'authentification n'est pas disponible, un message d'avertissement s'affiche et l'application reste hors connexion.</span><span class="sxs-lookup"><span data-stu-id="4d838-448">If the authentication service is unavailable, a warning message appears and the application stays offline.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4d838-449">La méthode <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> est fournie pour des raisons pratiques uniquement.</span><span class="sxs-lookup"><span data-stu-id="4d838-449">The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> method is for convenience only.</span></span> <span data-ttu-id="4d838-450">Étant donné qu'elle n'a pas de valeur de retour, elle ne peut pas indiquer si la revalidation a échoué.</span><span class="sxs-lookup"><span data-stu-id="4d838-450">Because it does not have a return value, it cannot indicate whether revalidation has failed.</span></span> <span data-ttu-id="4d838-451">La revalidation peut, par exemple, échouer si les informations d'identification de l'utilisateur ont été modifiées sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="4d838-451">Revalidation can fail, for example, if the user credentials have changed on the server.</span></span> <span data-ttu-id="4d838-452">Dans ce cas, vous souhaitez peut-être inclure du code qui valide explicitement les utilisateurs après l'échec d'un appel de service.</span><span class="sxs-lookup"><span data-stu-id="4d838-452">In this case, you might want to include code that explicitly validates users after a service call fails.</span></span> <span data-ttu-id="4d838-453">Pour plus d'informations, consultez la section Accès aux paramètres web, précédemment dans cette procédure pas à pas.</span><span class="sxs-lookup"><span data-stu-id="4d838-453">For more information, see the Accessing Web Settings section earlier in this walkthrough.</span></span>  
  
     <span data-ttu-id="4d838-454">Après la revalidation, ce code enregistre toutes les modifications apportées aux paramètres web locaux en appelant la méthode `SaveSettings` que vous avez ajoutée précédemment.</span><span class="sxs-lookup"><span data-stu-id="4d838-454">After revalidation, this code saves any changes to the local Web settings by calling the `SaveSettings` method that you added previously.</span></span> <span data-ttu-id="4d838-455">Il extrait ensuite toutes les nouvelles valeurs sur le serveur en appelant la méthode <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> de la classe `Settings` du projet (accessible en tant que `Properties.Settings.Default` en C# et en tant que `My.Settings` en [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).</span><span class="sxs-lookup"><span data-stu-id="4d838-455">It then retrieves any new values on the server by calling the <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> method of the project's `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).</span></span>  
  
     <span data-ttu-id="4d838-456">[!code-csharp[ClientApplicationServices#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)]  [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]</span><span class="sxs-lookup"><span data-stu-id="4d838-456">[!code-csharp[ClientApplicationServices#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)]  [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]</span></span>  
  
7.  <span data-ttu-id="4d838-457">Ajoutez le code suivant à la fin de la méthode `Form1_Load` pour garantir que la case à cocher affiche l'état de connexion en cours.</span><span class="sxs-lookup"><span data-stu-id="4d838-457">Add the following code to the end of the `Form1_Load` method to make sure that the check box displays the current connection state.</span></span>  
  
     <span data-ttu-id="4d838-458">[!code-csharp[ClientApplicationServices#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)]  [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]</span><span class="sxs-lookup"><span data-stu-id="4d838-458">[!code-csharp[ClientApplicationServices#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)]  [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]</span></span>  
  
 <span data-ttu-id="4d838-459">Cela termine l'exemple d'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-459">This completes the example application.</span></span> <span data-ttu-id="4d838-460">Pour tester la fonction hors connexion, exécutez l'application, connectez-vous en tant qu'employé (« employee ») ou en tant que gestionnaire (« manager »), puis sélectionnez **Travailler hors connexion**.</span><span class="sxs-lookup"><span data-stu-id="4d838-460">To test the offline capability, run the application, log in as either employee or manager, and then select **Work offline**.</span></span> <span data-ttu-id="4d838-461">Modifiez la valeur de la zone de texte, puis fermez l'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-461">Modify the value in the text box, and then close the application.</span></span> <span data-ttu-id="4d838-462">Redémarrez-la.</span><span class="sxs-lookup"><span data-stu-id="4d838-462">Restart the application.</span></span> <span data-ttu-id="4d838-463">Avant de vous connecter, cliquez avec le bouton droit sur l'icône Serveur de développement ASP.NET dans la zone de notification de la barre des tâches, puis cliquez sur **Arrêt**.</span><span class="sxs-lookup"><span data-stu-id="4d838-463">Before you log in, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**.</span></span> <span data-ttu-id="4d838-464">Ensuite, connectez-vous normalement.</span><span class="sxs-lookup"><span data-stu-id="4d838-464">Then, log in like normal.</span></span> <span data-ttu-id="4d838-465">Même si le serveur n'est pas en cours d'exécution, vous pouvez toujours vous connecter.</span><span class="sxs-lookup"><span data-stu-id="4d838-465">Even when the server is not running, you can still log in.</span></span> <span data-ttu-id="4d838-466">Modifiez la valeur de la zone de texte, quittez l'application, puis redémarrez-la pour vérifier le changement de valeur.</span><span class="sxs-lookup"><span data-stu-id="4d838-466">Modify the text box value, exit, and restart to see the modified value.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="4d838-467">Résumé</span><span class="sxs-lookup"><span data-stu-id="4d838-467">Summary</span></span>  
 <span data-ttu-id="4d838-468">Dans cette procédure pas à pas, vous avez appris à activer et à utiliser les services d'application cliente dans une application Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4d838-468">In this walkthrough, you learned how to enable and use client application services in a Windows Forms application.</span></span> <span data-ttu-id="4d838-469">Après avoir configuré un serveur de test, vous avez ajouté du code à votre application pour authentifier les utilisateurs et récupérer du serveur des rôles d'utilisateur et des paramètres d'application.</span><span class="sxs-lookup"><span data-stu-id="4d838-469">After setting up a test server, you added code to your application to authenticate users and retrieve user roles and application settings from the server.</span></span> <span data-ttu-id="4d838-470">Vous avez également appris à activer le mode hors connexion pour que votre application utilise un cache de données local au lieu des services distants lorsque la connectivité n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="4d838-470">You also learned how to enable offline mode so that your application uses a local data cache instead of the remote services when connectivity is not available.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="4d838-471">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="4d838-471">Next Steps</span></span>  
 <span data-ttu-id="4d838-472">Dans une application réelle, vous accédez aux données de nombreux utilisateurs à partir d'un serveur distant qui n'est pas toujours disponible ou peut tomber en panne sans prévenir.</span><span class="sxs-lookup"><span data-stu-id="4d838-472">In a real-world application, you will access data for many users from a remote server that may not always be available, or may go down without notice.</span></span> <span data-ttu-id="4d838-473">Pour garantir la fiabilité de votre application, vous devez gérer de manière appropriée les situations dans lesquelles le service n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="4d838-473">To make your application robust, you must respond appropriately to situations where the service is not available.</span></span> <span data-ttu-id="4d838-474">Cette procédure pas à pas inclut des blocs try/catch pour intercepter une <xref:System.Net.WebException> et afficher un message d'erreur lorsque le service n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="4d838-474">This walkthrough includes try/catch blocks to catch a <xref:System.Net.WebException> and display an error message when the service is not available.</span></span> <span data-ttu-id="4d838-475">Dans le code de production, vous voudrez peut-être gérer ce cas en basculant en mode hors connexion, en quittant l'application ou en refusant l'accès à des fonctionnalités spécifiques.</span><span class="sxs-lookup"><span data-stu-id="4d838-475">In production code, you might want to handle this case by switching to offline mode, exiting the application, or denying access to specific functionality.</span></span>  
  
 <span data-ttu-id="4d838-476">Pour augmenter la sécurité de votre application, veillez à tester entièrement l'application et le serveur avant tout déploiement.</span><span class="sxs-lookup"><span data-stu-id="4d838-476">To increase the security of your application, make sure to thoroughly test the application and server before deployment.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4d838-477">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4d838-477">See Also</span></span>  
 <span data-ttu-id="4d838-478">[Services d’application cliente](../../../docs/framework/common-client-technologies/client-application-services.md) </span><span class="sxs-lookup"><span data-stu-id="4d838-478">[Client Application Services](../../../docs/framework/common-client-technologies/client-application-services.md) </span></span>  
 <span data-ttu-id="4d838-479">[Vue d’ensemble des services d’application cliente](../../../docs/framework/common-client-technologies/client-application-services-overview.md) </span><span class="sxs-lookup"><span data-stu-id="4d838-479">[Client Application Services Overview](../../../docs/framework/common-client-technologies/client-application-services-overview.md) </span></span>  
 <span data-ttu-id="4d838-480">[Comment : configurer les services d’application cliente](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md) </span><span class="sxs-lookup"><span data-stu-id="4d838-480">[How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md) </span></span>  
 <span data-ttu-id="4d838-481">[Outil Administration de site web ASP.NET](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec) </span><span class="sxs-lookup"><span data-stu-id="4d838-481">[ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec) </span></span>  
 <span data-ttu-id="4d838-482">[Création et configuration de la base de données des services d’application pour SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2) </span><span class="sxs-lookup"><span data-stu-id="4d838-482">[Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2) </span></span>  
 [<span data-ttu-id="4d838-483">Procédure pas à pas : utilisation des services d’application ASP.NET</span><span class="sxs-lookup"><span data-stu-id="4d838-483">Walkthrough: Using ASP.NET Application Services</span></span>](http://msdn.microsoft.com/library/f3f394f0-20d6-4361-aa8f-4b21bf4933eb)

