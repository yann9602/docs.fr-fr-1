---
title: "Encodeurs personnalisés"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: fa0e1d7f-af36-4bf4-aac9-cd4eab95bc4f
caps.latest.revision: "15"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: f1c8223ea7900ba0a89ee2c5c48895a1782d18a0
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/22/2017
---
# <a name="custom-encoders"></a><span data-ttu-id="3eed9-102">Encodeurs personnalisés</span><span class="sxs-lookup"><span data-stu-id="3eed9-102">Custom Encoders</span></span>
<span data-ttu-id="3eed9-103">Cette rubrique décrit comment créer des encodeurs personnalisés.</span><span class="sxs-lookup"><span data-stu-id="3eed9-103">This topic discusses how to create custom encoders.</span></span>  
  
 <span data-ttu-id="3eed9-104">Dans [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], vous utilisez un *liaison* pour spécifier comment transférer des données sur un réseau entre les points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="3eed9-104">In [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], you use a *binding* to specify how to transfer data across a network between endpoints.</span></span> <span data-ttu-id="3eed9-105">Une liaison est composée d’une séquence de *éléments de liaison*.</span><span class="sxs-lookup"><span data-stu-id="3eed9-105">A binding is made up of a sequence of *binding elements*.</span></span> <span data-ttu-id="3eed9-106">Une liaison inclut des éléments de liaison de protocole facultatifs tels que de la sécurité, un *encodeur de Message* élément de liaison et un élément de liaison de transport requis.</span><span class="sxs-lookup"><span data-stu-id="3eed9-106">A binding includes optional protocol binding elements such as security, a required *Message Encoder* binding element, and a required transport binding element.</span></span> <span data-ttu-id="3eed9-107">Un encodeur de message est représenté par un élément de liaison d’encodage de message.</span><span class="sxs-lookup"><span data-stu-id="3eed9-107">A message encoder is represented by a message encoding binding element.</span></span> <span data-ttu-id="3eed9-108">Trois encodeurs de message sont inclus dans [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] : Binary, MTOM (Message Transmission Optimization Mechanism) et Text.</span><span class="sxs-lookup"><span data-stu-id="3eed9-108">Three message encoders are included in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]: Binary, Message Transmission Optimization Mechanism (MTOM), and Text.</span></span>  
  
 <span data-ttu-id="3eed9-109">Un élément de liaison d'encodage de message sérialise un <xref:System.ServiceModel.Channels.Message> sortant et le passe au transport ou reçoit la forme sérialisée d'un message du transport et le transmet à la couche de protocole (si celle-ci est présente), ou à l'application (dans le cas contraire).</span><span class="sxs-lookup"><span data-stu-id="3eed9-109">A message encoding binding element serializes an outgoing <xref:System.ServiceModel.Channels.Message> and passes it to the transport, or receives the serialized form of a message from the transport and passes it to the protocol layer if present, or to the application, if not present.</span></span>  
  
 <span data-ttu-id="3eed9-110">Les encodeurs de message transforment des instances <xref:System.ServiceModel.Channels.Message> vers une représentation sur le câble ou à partir de celle-ci.</span><span class="sxs-lookup"><span data-stu-id="3eed9-110">Message encoders transform <xref:System.ServiceModel.Channels.Message> instances to and from a wire representation.</span></span> <span data-ttu-id="3eed9-111">Même si les encodeurs sont décrits comme étant situés au-dessus de la couche de transport dans la pile des canaux, ils résident en fait à l'intérieur de cette couche.</span><span class="sxs-lookup"><span data-stu-id="3eed9-111">Although encoders are described as sitting above the transport layer in the channel stack, they reside inside the transport layer.</span></span> <span data-ttu-id="3eed9-112">Les transports (par exemple HTTP) mettent en forme le message selon les spécifications de la norme de transport.</span><span class="sxs-lookup"><span data-stu-id="3eed9-112">Transports (for example HTTP) format the message according to the requirements of the transport standard.</span></span> <span data-ttu-id="3eed9-113">Les encodeurs (par exemple Text Xml) se contentent d'encoder le message.</span><span class="sxs-lookup"><span data-stu-id="3eed9-113">Encoders (for example Text Xml) just encode the message.</span></span>  
  
 <span data-ttu-id="3eed9-114">Lorsque vous vous connectez à un client ou à un serveur préexistant, vous n'aurez peut-être pas le choix de l'utilisation d'un encodage de message particulier.</span><span class="sxs-lookup"><span data-stu-id="3eed9-114">When connecting to a preexisting client or server, you may not have a choice about using a particular message encoding.</span></span> <span data-ttu-id="3eed9-115">Toutefois, les services [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] peuvent être accessibles par l'intermédiaire de plusieurs points de terminaison, chacun ayant un encodeur de message différent.</span><span class="sxs-lookup"><span data-stu-id="3eed9-115">However, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services can be made accessible through multiple endpoints, each with a different message encoder.</span></span> <span data-ttu-id="3eed9-116">Lorsqu'un encodeur unique ne couvre pas toute l'audience de votre service, vous pouvez exposer votre service sur plusieurs points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="3eed9-116">When a single encoder does not cover the entire audience for your service, consider exposing your service over multiple endpoints.</span></span> <span data-ttu-id="3eed9-117">Les applications clientes peuvent utiliser ensuite le point de terminaison le mieux adapté.</span><span class="sxs-lookup"><span data-stu-id="3eed9-117">Client applications can then choose the endpoint that is best for them.</span></span> <span data-ttu-id="3eed9-118">L'utilisation de plusieurs points de terminaison vous permet de combiner les avantages des encodeurs de message différents avec d'autres éléments de liaison.</span><span class="sxs-lookup"><span data-stu-id="3eed9-118">Using multiple endpoints allows you to combine the advantages of different message encoders with other binding elements.</span></span>  
  
## <a name="system-provided-encoders"></a><span data-ttu-id="3eed9-119">Encodeurs fournis par le système</span><span class="sxs-lookup"><span data-stu-id="3eed9-119">System-Provided Encoders</span></span>  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="3eed9-120"> fournit plusieurs liaisons fournies par le système et conçues pour couvrir les scénarios d'application les plus courants.</span><span class="sxs-lookup"><span data-stu-id="3eed9-120"> provides several system-provided bindings that are designed to cover the most common application scenarios.</span></span> <span data-ttu-id="3eed9-121">Chacune de ces liaisons associe un transport, un encodeur de message et d'autres options (la sécurité, par exemple).</span><span class="sxs-lookup"><span data-stu-id="3eed9-121">Each of these bindings combine a transport, message encoder, and other options (security, for example).</span></span> <span data-ttu-id="3eed9-122">Cette rubrique décrit comment étendre les encodeurs de message `Text`, `Binary` et `MTOM` inclus dans [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], ou comment créer votre propre encodeur personnalisé.</span><span class="sxs-lookup"><span data-stu-id="3eed9-122">This topic describes how to extend the `Text`, `Binary`, and `MTOM` message encoders that are included in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], or create your own custom encoder.</span></span> <span data-ttu-id="3eed9-123">L'encodeur de message texte prend en charge un encodage XML ordinaire ainsi que des encodages SOAP.</span><span class="sxs-lookup"><span data-stu-id="3eed9-123">The text message encoder supports both a plain XML encoding as well as SOAP encodings.</span></span> <span data-ttu-id="3eed9-124">Le mode d'encodage XML brut de l'encodeur de message texte est appelé POX (Plain Old XML) afin de le distinguer de l'encodage SOAP basé sur le texte.</span><span class="sxs-lookup"><span data-stu-id="3eed9-124">The plain XML encoding mode of the text message encoder is called the POX ("Plain Old XML") encoder to distinguish it from the text-based SOAP encoding.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="3eed9-125">les combinaisons d’éléments de liaison fournies par les liaisons fournies par le système, consultez la section correspondante de [choisir un Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="3eed9-125"> the combinations of binding elements provided by the system-provided bindings, see the corresponding section in [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span></span>  
  
## <a name="how-to-work-with-system-provided-encoders"></a><span data-ttu-id="3eed9-126">Comment utiliser des encodeurs fournis par le système</span><span class="sxs-lookup"><span data-stu-id="3eed9-126">How to Work with System-Provided Encoders</span></span>  
 <span data-ttu-id="3eed9-127">Un encodage est ajouté à une liaison à l'aide d'une classe dérivée de <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="3eed9-127">An encoding is added to a binding using a class derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="3eed9-128"> fournit les types suivants d'éléments de liaison dérivés de la classe <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> qui peut fournir l'encodage Text, Binary et MTOM :</span><span class="sxs-lookup"><span data-stu-id="3eed9-128"> provides the following types of binding elements derived from the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> class that can provide for text, binary and Message Transmission Optimization Mechanism (MTOM) encoding:</span></span>  
  
-   <span data-ttu-id="3eed9-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> est l'encodeur le plus interopérable, mais le moins efficace pour les messages XML.</span><span class="sxs-lookup"><span data-stu-id="3eed9-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: The most interoperable, but the least efficient encoder for XML messages.</span></span> <span data-ttu-id="3eed9-130">Un service Web ou un client de service Web comprend généralement le langage XML textuel.</span><span class="sxs-lookup"><span data-stu-id="3eed9-130">A Web service or Web service client can generally understand textual XML.</span></span> <span data-ttu-id="3eed9-131">Toutefois, transmettre de larges blocs de données binaires sous la forme de texte n'est pas efficace.</span><span class="sxs-lookup"><span data-stu-id="3eed9-131">However, transmitting large blocks of binary data as text is not efficient.</span></span>  
  
-   <span data-ttu-id="3eed9-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement> représente l'élément de liaison qui spécifie l'encodage de caractères et le versioning de messages utilisés pour les messages XML binaires.</span><span class="sxs-lookup"><span data-stu-id="3eed9-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>: Represents the binding element that specifies the character encoding and message versioning used for binary-based XML messages.</span></span> <span data-ttu-id="3eed9-133">Il s'agit de la plus efficace des options d'encodage, mais la moins interopérable, parce qu'elle est prise en charge uniquement par les points de terminaison [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3eed9-133">This is most efficient of the encoding options, but the least interoperable, because it is only supported by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoints.</span></span>  
  
-   <span data-ttu-id="3eed9-134"><<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement -->`System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`> : représente l’élément de liaison qui spécifie l’encodage de caractères et le versioning de messages utilisés pour un message à l’aide d’un encodage de (Message Transmission Optimization Mechanism).</span><span class="sxs-lookup"><span data-stu-id="3eed9-134"><<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`>: Represents the binding element that specifies the character encoding and message versioning used for a message using a Message Transmission Optimization Mechanism (MTOM) encoding.</span></span> <span data-ttu-id="3eed9-135">MTOM est une technologie efficace pour la transmission de données binaires dans les messages [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3eed9-135">MTOM is an efficient technology for transmitting binary data in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] messages.</span></span> <span data-ttu-id="3eed9-136">L'encodeur MTOM tente de parvenir à un équilibre entre rendement et interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="3eed9-136">The MTOM encoder attempts to balance between efficiency and interoperability.</span></span> <span data-ttu-id="3eed9-137">L'encodage MTOM transmet la plupart du XML sous forme textuelle, mais optimise les grands blocs de données binaires en les transmettant tels quels, sans conversion en texte.</span><span class="sxs-lookup"><span data-stu-id="3eed9-137">The MTOM encoding transmits most XML in textual form, but optimizes large blocks of binary data by transmitting them as-is, without conversion to text.</span></span>  
  
 <span data-ttu-id="3eed9-138">L'élément de liaison crée un <xref:System.ServiceModel.Channels.MessageEncoderFactory> Binary, MTOM ou Text.</span><span class="sxs-lookup"><span data-stu-id="3eed9-138">The binding element creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory>.</span></span> <span data-ttu-id="3eed9-139">La fabrique crée une instance <xref:System.ServiceModel.Channels.MessageEncoderFactory> Binary, MTOM ou Text.</span><span class="sxs-lookup"><span data-stu-id="3eed9-139">The factory creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory> instance.</span></span> <span data-ttu-id="3eed9-140">En général, il n'y a qu'une instance unique.</span><span class="sxs-lookup"><span data-stu-id="3eed9-140">Typically, there is only a single instance.</span></span> <span data-ttu-id="3eed9-141">Toutefois si des sessions sont utilisées, un encodeur différent peut être fourni à chaque session.</span><span class="sxs-lookup"><span data-stu-id="3eed9-141">However if sessions are used, a different encoder may be provided to each session.</span></span> <span data-ttu-id="3eed9-142">L'encodeur Binary utilise celle-ci pour coordonner des dictionnaires dynamiques (consultez Infrastructure XML).</span><span class="sxs-lookup"><span data-stu-id="3eed9-142">The Binary encoder makes use of this to coordinate dynamic dictionaries (see XML Infrastructure).</span></span>  
  
 <span data-ttu-id="3eed9-143">Les méthodes <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> et <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> sont les éléments principaux des encodeurs.</span><span class="sxs-lookup"><span data-stu-id="3eed9-143">The <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> and <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> methods are the core of the encoders.</span></span> <span data-ttu-id="3eed9-144">Les méthodes permettent de lire un message d'un flux de données ou d'un tableau <xref:System.Byte>.</span><span class="sxs-lookup"><span data-stu-id="3eed9-144">The methods provide for reading a message from a stream or from a <xref:System.Byte> array.</span></span> <span data-ttu-id="3eed9-145">Les tableaux d'octets sont utilisés lorsque le transport fonctionne en mode mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="3eed9-145">Byte arrays are used when the transport is operating in buffered mode.</span></span> <span data-ttu-id="3eed9-146">Les messages sont toujours écrits dans des flux de données.</span><span class="sxs-lookup"><span data-stu-id="3eed9-146">Messages are always written to streams.</span></span> <span data-ttu-id="3eed9-147">Si le transport doit mettre le message en mémoire tampon, il fournit un flux de données qui effectue la mise en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="3eed9-147">If the transport must buffer the message, it provides a stream that does the buffering.</span></span>  
  
 <span data-ttu-id="3eed9-148">Le reste des membres utilisent le contenu de support, les types de média et <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span><span class="sxs-lookup"><span data-stu-id="3eed9-148">The rest of the members work with support content, media types, and <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span></span> <span data-ttu-id="3eed9-149">Le transport appelle ces méthodes d'encodeur pour tester s'il peut décoder le message entrant ou pour déterminer si le message sortant est valide pour cet encodeur.</span><span class="sxs-lookup"><span data-stu-id="3eed9-149">The transport calls these encoder methods to test whether the incoming message can be decoded by it, or to determine if the outgoing message is valid for this encoder.</span></span>  
  
 <span data-ttu-id="3eed9-150">Chacune des trois implémentations d'encodeur ajoute des propriétés qui sont pertinentes aux encodages spécifiques et sont entièrement configurables.</span><span class="sxs-lookup"><span data-stu-id="3eed9-150">Each of the three encoder implementations adds properties that are relevant to the specific encodings and is fully configurable.</span></span> <span data-ttu-id="3eed9-151">Les encodeurs exposent aussi des quotas de lecteur qui ont des valeurs sécurisées par défaut.</span><span class="sxs-lookup"><span data-stu-id="3eed9-151">The encoders also expose reader quotas that have secure defaults.</span></span> <span data-ttu-id="3eed9-152">Consultez Infrastructure XML pour une description des quotas.</span><span class="sxs-lookup"><span data-stu-id="3eed9-152">See XML Infrastructure for a discussion of the quotas.</span></span>  
  
## <a name="features-of-system-provided-encoders"></a><span data-ttu-id="3eed9-153">Fonctionnalités des encodeurs fournis par le système</span><span class="sxs-lookup"><span data-stu-id="3eed9-153">Features of System-Provided Encoders</span></span>  
 <span data-ttu-id="3eed9-154">Les encodeurs fournis par le système offrent plusieurs fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="3eed9-154">There are a number of features provided by the system-provided encoders.</span></span>  
  
### <a name="pooling"></a><span data-ttu-id="3eed9-155">Pooling</span><span class="sxs-lookup"><span data-stu-id="3eed9-155">Pooling</span></span>  
 <span data-ttu-id="3eed9-156">Chacune des implémentations d'encodeur essaient de regrouper autant que possible.</span><span class="sxs-lookup"><span data-stu-id="3eed9-156">Each of the encoder implementations tries to pool as much as possible.</span></span> <span data-ttu-id="3eed9-157">La réduction d'allocations est un moyen clé pour améliorer les performances du code managé.</span><span class="sxs-lookup"><span data-stu-id="3eed9-157">Reducing allocations is a key way to improve the performance of managed code.</span></span> <span data-ttu-id="3eed9-158">Pour accomplir ce regroupement, les implémentations utilisent la classe `SynchronizedPool`.</span><span class="sxs-lookup"><span data-stu-id="3eed9-158">To accomplish this pooling, the implementations use the `SynchronizedPool` class.</span></span> <span data-ttu-id="3eed9-159">Le fichier C# contient une description des optimisations supplémentaires utilisées par cette classe.</span><span class="sxs-lookup"><span data-stu-id="3eed9-159">The C# file contains a description of the additional optimizations used by this class.</span></span>  
  
 <span data-ttu-id="3eed9-160">Les instances `XmlDictionaryReader` et `XmlDictionaryWriter` sont regroupées et réinitialisées pour empêcher d'en allouer des nouvelles pour chaque message.</span><span class="sxs-lookup"><span data-stu-id="3eed9-160">`XmlDictionaryReader` and `XmlDictionaryWriter` instances are pooled and reinitialized to prevent allocating new ones for each message.</span></span> <span data-ttu-id="3eed9-161">Pour les lecteurs, un rappel `OnClose` récupère le lecteur lorsque `Close()` est appelé.</span><span class="sxs-lookup"><span data-stu-id="3eed9-161">For the readers, an `OnClose` callback reclaims the reader when `Close()` is called.</span></span> <span data-ttu-id="3eed9-162">L'encodeur recycle aussi certains objets de l'état du message utilisés pour construire des messages.</span><span class="sxs-lookup"><span data-stu-id="3eed9-162">The encoder also recycles some message state objects used when constructing messages.</span></span> <span data-ttu-id="3eed9-163">Les tailles de ces regroupements sont configurables par les propriétés `MaxReadPoolSize` et `MaxWritePoolSize` sur chacune des trois classes dérivées de <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="3eed9-163">The sizes of these pools are configurable by the `MaxReadPoolSize` and `MaxWritePoolSize` properties on each of the three classes derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
### <a name="binary-encoding"></a><span data-ttu-id="3eed9-164">Encodage Binaire</span><span class="sxs-lookup"><span data-stu-id="3eed9-164">Binary Encoding</span></span>  
 <span data-ttu-id="3eed9-165">Lorsque l'encodage binaire utilise des sessions, la chaîne de dictionnaire dynamique doit être communiquée au récepteur du message.</span><span class="sxs-lookup"><span data-stu-id="3eed9-165">When binary encoding uses sessions, the dynamic dictionary string must be communicated to the receiver of the message.</span></span> <span data-ttu-id="3eed9-166">Cette opération s'effectue en préfixant le message avec les chaînes de dictionnaire dynamiques.</span><span class="sxs-lookup"><span data-stu-id="3eed9-166">This is done by prefixing the message with the dynamic dictionary strings.</span></span> <span data-ttu-id="3eed9-167">Le récepteur supprime des chaînes, les ajoute à la session et traite le message.</span><span class="sxs-lookup"><span data-stu-id="3eed9-167">The receiver strips off the strings, adds them to the session, and processes the message.</span></span> <span data-ttu-id="3eed9-168">La transmission correcte des chaînes de dictionnaire nécessite la mise en mémoire tampon du transport.</span><span class="sxs-lookup"><span data-stu-id="3eed9-168">Correctly passing dictionary strings requires that the transport be buffered.</span></span>  
  
 <span data-ttu-id="3eed9-169">Les chaînes sont ajoutées au message par une méthode `AddSessionInformationToMessage` interne.</span><span class="sxs-lookup"><span data-stu-id="3eed9-169">The strings are appended to the message by an internal `AddSessionInformationToMessage` method.</span></span> <span data-ttu-id="3eed9-170">Elle ajoute les chaînes au format UTF-8 au début du message précédées de leur longueur.</span><span class="sxs-lookup"><span data-stu-id="3eed9-170">It adds the strings as UTF-8 to the front of the message prefixed with their length.</span></span> <span data-ttu-id="3eed9-171">Puis l'en-tête entier de dictionnaire est préfixé avec la longueur de ses données.</span><span class="sxs-lookup"><span data-stu-id="3eed9-171">The entire dictionary header is then prefixed with the length of its data.</span></span> <span data-ttu-id="3eed9-172">L'opération inverse est effectuée par une méthode interne `ExtractSessionInformationFromMessage`.</span><span class="sxs-lookup"><span data-stu-id="3eed9-172">The reverse operation is performed by an internal `ExtractSessionInformationFromMessage` method.</span></span>  
  
 <span data-ttu-id="3eed9-173">En plus de traiter des clés de dictionnaire dynamiques, les messages de session en mémoire tampon sont reçus d'une manière unique.</span><span class="sxs-lookup"><span data-stu-id="3eed9-173">In addition to processing dynamic dictionary keys, buffered sessionful messages are received in a unique way.</span></span> <span data-ttu-id="3eed9-174">Au lieu de créer un lecteur sur le document et de le traiter, l'encodeur binaire utilise la classe interne `MessagePatterns` pour déconstruire le flux binaire.</span><span class="sxs-lookup"><span data-stu-id="3eed9-174">Instead of creating a reader over the document and processing it, the binary encoder uses the internal `MessagePatterns` class to deconstruct the binary stream.</span></span> <span data-ttu-id="3eed9-175">L'idée est que la plupart des messages possède un certain jeu d'en-têtes qui apparaissent dans un certain ordre lorsqu'ils sont générés par [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3eed9-175">The idea is that most messages have a certain set of headers that show up in a certain order when generated by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span></span> <span data-ttu-id="3eed9-176">Le système de modèle décompose le message en fonction de ce qu'il en attend.</span><span class="sxs-lookup"><span data-stu-id="3eed9-176">The pattern system breaks the message apart based on what it expects.</span></span> <span data-ttu-id="3eed9-177">Si l'opération aboutie, il initialise un objet <xref:System.ServiceModel.Channels.MessageHeaders> sans analyser le XML.</span><span class="sxs-lookup"><span data-stu-id="3eed9-177">If it is successful, it initializes a <xref:System.ServiceModel.Channels.MessageHeaders> object without parsing the XML.</span></span> <span data-ttu-id="3eed9-178">Dans le cas contraire, il revient à la méthode standard.</span><span class="sxs-lookup"><span data-stu-id="3eed9-178">If not, it falls back to the standard method.</span></span>  
  
### <a name="mtom-encoding"></a><span data-ttu-id="3eed9-179">MTOM Encoding</span><span class="sxs-lookup"><span data-stu-id="3eed9-179">MTOM Encoding</span></span>  
 <span data-ttu-id="3eed9-180">Le <<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`> classe a une propriété de configuration supplémentaire appelée <<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`. MaxBufferSize % 2 >.</span><span class="sxs-lookup"><span data-stu-id="3eed9-180">The <<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`> class has an additional configuration property called <<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`.MaxBufferSize%2A>.</span></span> <span data-ttu-id="3eed9-181">Celle-ci place une limite supérieure sur la quantité de données qu'il est possible de mettre en mémoire tampon pendant la lecture d'un message.</span><span class="sxs-lookup"><span data-stu-id="3eed9-181">This places an upper bound on how much data it is allowed to buffer during the process of reading a message.</span></span> <span data-ttu-id="3eed9-182">Le jeu d'informations XML (Infoset), ou d'autres parties MIME, peuvent nécessiter leur mise en mémoire tampon pour réassembler toutes les parties MIME dans un message unique.</span><span class="sxs-lookup"><span data-stu-id="3eed9-182">The XML Information Set (Infoset), or other MIME parts, may need to be buffered to reassemble all the MIME parts into a single message.</span></span>  
  
 <span data-ttu-id="3eed9-183">Pour fonctionner correctement avec HTTP, la classe d'encodeur de message MTOM interne fournit des API internes pour `GetContentType` (qui est aussi interne) et `WriteMessage` qui est public et peut être substitué.</span><span class="sxs-lookup"><span data-stu-id="3eed9-183">To work correctly with HTTP, the internal MTOM message encoder class provides some internal APIs for `GetContentType` (which is also internal) and `WriteMessage`, which is public and can be overridden.</span></span> <span data-ttu-id="3eed9-184">Il doit s'effectuer plus de communication pour que les valeurs dans les en-têtes HTTP soient conformes aux valeurs dans les en-têtes MIME.</span><span class="sxs-lookup"><span data-stu-id="3eed9-184">More communication must occur to ensure values in the HTTP headers agree with values in the MIME headers.</span></span>  
  
 <span data-ttu-id="3eed9-185">En interne, l'encodeur de message MTOM utilise les lecteurs de texte de [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], il est semblable à l'encodeur Text.</span><span class="sxs-lookup"><span data-stu-id="3eed9-185">Internally, the MTOM message encoder uses [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]'s text readers, and is similar to the Text encoder.</span></span> <span data-ttu-id="3eed9-186">La différence principale est qu'il optimise des segments importants de binaire, ou BLOB (Binary Large Objects) en ne les convertissant pas en encodage de base 64 avant d'être incorporé dans les octets de message.</span><span class="sxs-lookup"><span data-stu-id="3eed9-186">The main difference is that it optimizes large chunks of binary, or "Binary Large Objects" (BLOBs), by not converting them to Base-64 encoding prior to being embedded into the message bytes.</span></span> <span data-ttu-id="3eed9-187">À la place, ces BLOB restent extraits et référencés comme des pièces jointes MIME.</span><span class="sxs-lookup"><span data-stu-id="3eed9-187">Instead, these BLOBs are kept extracted, and referenced as the MIME attachments.</span></span>  
  
## <a name="writing-your-own-encoder"></a><span data-ttu-id="3eed9-188">Écriture de votre propre encodeur</span><span class="sxs-lookup"><span data-stu-id="3eed9-188">Writing your own Encoder</span></span>  
 <span data-ttu-id="3eed9-189">Pour implémenter votre propre encodeur de message personnalisé, vous devez fournir des implémentations personnalisées des classes de base abstraites suivantes :</span><span class="sxs-lookup"><span data-stu-id="3eed9-189">To implement your own custom message encoder, you must provide custom implementations of the following abstract base classes:</span></span>  
  
-   <xref:System.ServiceModel.Channels.MessageEncoder>  
  
-   <xref:System.ServiceModel.Channels.MessageEncoderFactory>  
  
-   <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>  
  
 <span data-ttu-id="3eed9-190">La conversion de la représentation en mémoire d'un message en une représentation qui peut être écrite dans un flux de données est encapsulée dans la classe <xref:System.ServiceModel.Channels.MessageEncoder> qui agit en tant que fabrique pour les lecteurs XML et writers XML qui prennent en charge des types spécifiques d'encodages XML.</span><span class="sxs-lookup"><span data-stu-id="3eed9-190">Converting from the in-memory representation of a message to a representation that can be written to a stream is encapsulated within the <xref:System.ServiceModel.Channels.MessageEncoder> class, which serves as a factory for XML readers and XML writers that support specific types of XML encodings.</span></span>  
  
-   <span data-ttu-id="3eed9-191">Les méthodes clés de cette classe que vous devez substituer sont :</span><span class="sxs-lookup"><span data-stu-id="3eed9-191">The key methods of this class that you must override are:</span></span>  
  
-   <span data-ttu-id="3eed9-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> qui accepte un objet <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> et l'écrit dans un objet <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="3eed9-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> which takes a <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> object and writes it into a <xref:System.IO.Stream> object.</span></span>  
  
-   <span data-ttu-id="3eed9-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> qui accepte un objet <xref:System.IO.Stream> et une taille d'en-tête maximale et retourne un objet <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="3eed9-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> which takes a <xref:System.IO.Stream> object and a maximum header size and returns a <xref:System.ServiceModel.Channels.Message> object.</span></span>  
  
 <span data-ttu-id="3eed9-194">C'est le code que vous écrivez dans ces méthodes qui gèrent la conversion entre le protocole de transport standard et votre encodage personnalisé.</span><span class="sxs-lookup"><span data-stu-id="3eed9-194">It is the code you write in these methods that handles conversion between the standard transport protocol, and your customized encoding.</span></span>  
  
 <span data-ttu-id="3eed9-195">Ensuite, vous devez coder une classe de fabrique qui crée votre encodeur personnalisé.</span><span class="sxs-lookup"><span data-stu-id="3eed9-195">Next you need to code a factory class that creates your custom encoder.</span></span> <span data-ttu-id="3eed9-196">Substituez <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> pour retourner une instance de votre <xref:System.ServiceModel.Channels.MessageEncoder> personnalisé.</span><span class="sxs-lookup"><span data-stu-id="3eed9-196">Override the <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> to return an instance of your custom <xref:System.ServiceModel.Channels.MessageEncoder>.</span></span>  
  
 <span data-ttu-id="3eed9-197">Puis connectez votre <xref:System.ServiceModel.Channels.MessageEncoderFactory> personnalisé à la pile d'élément de liaison utilisée pour configurer le service ou le client en substituant la méthode <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> pour retourner une instance de cette fabrique.</span><span class="sxs-lookup"><span data-stu-id="3eed9-197">Then connect your custom <xref:System.ServiceModel.Channels.MessageEncoderFactory> to the binding element stack used to configure the service or client by overriding the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> method to return an instance of this factory.</span></span>  
  
 <span data-ttu-id="3eed9-198">Il existe deux exemples fournis avec [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] qui illustrent ce processus avec le code d’exemple : [encodeur de Message personnalisé : encodeur de texte personnalisé](../../../../docs/framework/wcf/samples/custom-message-encoder-custom-text-encoder.md) et [encodeur de Message personnalisé : encodeur de Compression](../../../../docs/framework/wcf/samples/custom-message-encoder-compression-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="3eed9-198">There are two samples provided with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] that illustrate this process with sample code: [Custom Message Encoder: Custom Text Encoder](../../../../docs/framework/wcf/samples/custom-message-encoder-custom-text-encoder.md) and [Custom Message Encoder: Compression Encoder](../../../../docs/framework/wcf/samples/custom-message-encoder-compression-encoder.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3eed9-199">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="3eed9-199">See Also</span></span>  
 <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>  
 <xref:System.ServiceModel.Channels.MessageEncoderFactory>  
 <xref:System.ServiceModel.Channels.MessageEncoder>  
 [<span data-ttu-id="3eed9-200">Vue d’ensemble de l’architecture de transfert de données</span><span class="sxs-lookup"><span data-stu-id="3eed9-200">Data Transfer Architectural Overview</span></span>](../../../../docs/framework/wcf/feature-details/data-transfer-architectural-overview.md)  
 [<span data-ttu-id="3eed9-201">Sélection d’un encodeur de message</span><span class="sxs-lookup"><span data-stu-id="3eed9-201">Choosing a Message Encoder</span></span>](../../../../docs/framework/wcf/feature-details/choosing-a-message-encoder.md)  
 [<span data-ttu-id="3eed9-202">Choix d’un transport</span><span class="sxs-lookup"><span data-stu-id="3eed9-202">Choosing a Transport</span></span>](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)
