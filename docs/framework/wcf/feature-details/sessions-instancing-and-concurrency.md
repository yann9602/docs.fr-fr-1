---
title: "Sessions, instanciation et accès concurrentiel"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 50797a3b-7678-44ed-8138-49ac1602f35b
caps.latest.revision: "16"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 44aebb701eb7222773c030994fbaa9c0109dce70
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/02/2017
---
# <a name="sessions-instancing-and-concurrency"></a><span data-ttu-id="e38eb-102">Sessions, instanciation et accès concurrentiel</span><span class="sxs-lookup"><span data-stu-id="e38eb-102">Sessions, Instancing, and Concurrency</span></span>
<span data-ttu-id="e38eb-103">Une *session* est une corrélation de tous les messages envoyés entre deux points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="e38eb-103">A *session* is a correlation of all messages sent between two endpoints.</span></span> <span data-ttu-id="e38eb-104">L'*instanciation* fait référence au contrôle de la durée de vie des objets de service définis par l'utilisateur et de leurs objets <xref:System.ServiceModel.InstanceContext> connexes.</span><span class="sxs-lookup"><span data-stu-id="e38eb-104">*Instancing* refers to controlling the lifetime of user-defined service objects and their related <xref:System.ServiceModel.InstanceContext> objects.</span></span> <span data-ttu-id="e38eb-105">La*concurrence* est le terme donné au contrôle du nombre des threads qui s'exécutent simultanément dans un <xref:System.ServiceModel.InstanceContext> .</span><span class="sxs-lookup"><span data-stu-id="e38eb-105">*Concurrency* is the term given to the control of the number of threads executing in an <xref:System.ServiceModel.InstanceContext> at the same time.</span></span>  
  
 <span data-ttu-id="e38eb-106">Cette rubrique décrit ces paramètres, comment les utiliser et les diverses interactions entre eux.</span><span class="sxs-lookup"><span data-stu-id="e38eb-106">This topic describes these settings, how to use them, and the various interactions between them.</span></span>  
  
## <a name="sessions"></a><span data-ttu-id="e38eb-107">Sessions</span><span class="sxs-lookup"><span data-stu-id="e38eb-107">Sessions</span></span>  
 <span data-ttu-id="e38eb-108">Lorsqu'un contrat de service affecte <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> à la propriété <xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType>, ce contrat indique que tous les appels (c'est-à-dire, les échanges de messages sous-jacents qui prennent en charge les appels) doivent faire partie de la même conversation.</span><span class="sxs-lookup"><span data-stu-id="e38eb-108">When a service contract sets the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType>, that contract is saying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="e38eb-109">Si un contrat spécifie qu'il autorise les sessions mais n'en requiert pas, les clients peuvent se connecter et établir ou non une session.</span><span class="sxs-lookup"><span data-stu-id="e38eb-109">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not.</span></span> <span data-ttu-id="e38eb-110">Si la session se termine et qu'un message est envoyé sur le même canal basé sur session, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="e38eb-110">If the session ends and a message is sent over the same session-based channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="e38eb-111">Les sessions[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] sont associées aux principales fonctionnalités conceptuelles suivantes :</span><span class="sxs-lookup"><span data-stu-id="e38eb-111">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] sessions have the following main conceptual features:</span></span>  
  
-   <span data-ttu-id="e38eb-112">Elles sont explicitement initialisées et terminées par l'application appelante.</span><span class="sxs-lookup"><span data-stu-id="e38eb-112">They are explicitly initiated and terminated by the calling application.</span></span>  
  
-   <span data-ttu-id="e38eb-113">Les messages remis pendant une session sont traités dans l'ordre dans lequel ils sont reçus.</span><span class="sxs-lookup"><span data-stu-id="e38eb-113">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
-   <span data-ttu-id="e38eb-114">Les sessions corrèlent un groupe de messages dans une conversation.</span><span class="sxs-lookup"><span data-stu-id="e38eb-114">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="e38eb-115">La signification de cette corrélation est une abstraction.</span><span class="sxs-lookup"><span data-stu-id="e38eb-115">The meaning of that correlation is an abstraction.</span></span> <span data-ttu-id="e38eb-116">Par exemple, un canal basé sur session peut corréler des messages sur la base d'une connexion réseau partagée, pendant qu'un autre canal basé sur session corrèle des messages sur la base d'une balise partagée dans le corps du message.</span><span class="sxs-lookup"><span data-stu-id="e38eb-116">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="e38eb-117">Les fonctionnalités qui peuvent être dérivées de la session varient en fonction de la nature de la corrélation.</span><span class="sxs-lookup"><span data-stu-id="e38eb-117">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
-   <span data-ttu-id="e38eb-118">Il n'existe pas de magasin de données général associé à une session [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e38eb-118">There is no general data store associated with a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] session.</span></span>  
  
 <span data-ttu-id="e38eb-119">Si vous êtes familiarisé avec la classe <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> des applications [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] et avec les fonctionnalités qu'elle fournit, vous remarquerez les différences suivantes entre ce type de session et les sessions [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="e38eb-119">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] sessions:</span></span>  
  
-   <span data-ttu-id="e38eb-120">Les sessions[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sont systématiquement initialisées par le serveur.</span><span class="sxs-lookup"><span data-stu-id="e38eb-120">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions are always server-initiated.</span></span>  
  
-   <span data-ttu-id="e38eb-121">Les sessions[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sont implicitement non ordonnées.</span><span class="sxs-lookup"><span data-stu-id="e38eb-121">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions are implicitly unordered.</span></span>  
  
-   <span data-ttu-id="e38eb-122">Les sessions[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] fournissent un mécanisme de stockage général des données sur l'ensemble des demandes.</span><span class="sxs-lookup"><span data-stu-id="e38eb-122">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="e38eb-123">Les applications clientes et de service interagissent avec les sessions de manière différente.</span><span class="sxs-lookup"><span data-stu-id="e38eb-123">Client applications and service applications interact with sessions in different ways.</span></span> <span data-ttu-id="e38eb-124">Les applications clientes initialisent des sessions, puis reçoivent et traitent les messages envoyés dans la session.</span><span class="sxs-lookup"><span data-stu-id="e38eb-124">Client applications initiate sessions and then receive and process the messages sent within the session.</span></span> <span data-ttu-id="e38eb-125">Les applications de service peuvent utiliser des sessions comme point d'extensibilité pour ajouter un comportement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="e38eb-125">Service applications can use sessions as an extensibility point to add additional behavior.</span></span> <span data-ttu-id="e38eb-126">Pour ce faire, utilisez directement <xref:System.ServiceModel.InstanceContext> ou implémentez un fournisseur de contexte d'instance personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e38eb-126">This is done by working directly with the <xref:System.ServiceModel.InstanceContext> or implementing a custom instance context provider.</span></span>  
  
## <a name="instancing"></a><span data-ttu-id="e38eb-127">instanciation</span><span class="sxs-lookup"><span data-stu-id="e38eb-127">Instancing</span></span>  
 <span data-ttu-id="e38eb-128">Le comportement d'instanciation (défini à l'aide de propriété <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType>) contrôle la façon dont le <xref:System.ServiceModel.InstanceContext> est créé en réponse à des messages entrants.</span><span class="sxs-lookup"><span data-stu-id="e38eb-128">The instancing behavior (set by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property) controls how the <xref:System.ServiceModel.InstanceContext> is created in response to incoming messages.</span></span> <span data-ttu-id="e38eb-129">Par défaut, chaque <xref:System.ServiceModel.InstanceContext> est associé à un objet de service défini par l'utilisateur ; par conséquent (dans le cas par défaut), la définition de la propriété <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> contrôle également l'instanciation des objets de service définis par l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e38eb-129">By default, each <xref:System.ServiceModel.InstanceContext> is associated with one user-defined service object, so (in the default case) setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> property also controls the instancing of user-defined service objects.</span></span> <span data-ttu-id="e38eb-130">L'énumération <xref:System.ServiceModel.InstanceContextMode> définit les modes d'instanciation.</span><span class="sxs-lookup"><span data-stu-id="e38eb-130">The <xref:System.ServiceModel.InstanceContextMode> enumeration defines the instancing modes.</span></span>  
  
 <span data-ttu-id="e38eb-131">Les modes d'instanciation disponibles sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="e38eb-131">The following instancing modes are available:</span></span>  
  
-   <span data-ttu-id="e38eb-132"><xref:System.ServiceModel.InstanceContextMode.PerCall>: un nouveau <xref:System.ServiceModel.InstanceContext> (et par conséquent un objet de service) est créé pour chaque demande du client.</span><span class="sxs-lookup"><span data-stu-id="e38eb-132"><xref:System.ServiceModel.InstanceContextMode.PerCall>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each client request.</span></span>  
  
-   <span data-ttu-id="e38eb-133"><xref:System.ServiceModel.InstanceContextMode.PerSession>: un nouveau <xref:System.ServiceModel.InstanceContext> (et par conséquent un objet de service) est créé pour chaque nouvelle session cliente et est conservé pendant toute la durée de vie de celle-ci (cela requiert une liaison capable de prendre les sessions en charge).</span><span class="sxs-lookup"><span data-stu-id="e38eb-133"><xref:System.ServiceModel.InstanceContextMode.PerSession>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each new client session and maintained for the lifetime of that session (this requires a binding that supports sessions).</span></span>  
  
-   <span data-ttu-id="e38eb-134"><xref:System.ServiceModel.InstanceContextMode.Single>: un <xref:System.ServiceModel.InstanceContext> unique (et par conséquent un objet de service) gère toutes les demandes du client pendant toute la durée de vie de l'application.</span><span class="sxs-lookup"><span data-stu-id="e38eb-134"><xref:System.ServiceModel.InstanceContextMode.Single>: A single <xref:System.ServiceModel.InstanceContext> (and therefore service object) handles all client requests for the lifetime of the application.</span></span>  
  
 <span data-ttu-id="e38eb-135">L'exemple de code suivant présente la valeur <xref:System.ServiceModel.InstanceContextMode> par défaut, <xref:System.ServiceModel.InstanceContextMode.PerSession> étant explicitement défini sur une classe de service.</span><span class="sxs-lookup"><span data-stu-id="e38eb-135">The following code example shows the default <xref:System.ServiceModel.InstanceContextMode> value, <xref:System.ServiceModel.InstanceContextMode.PerSession> being explicitly set on a service class.</span></span>  
  
```  
[ServiceBehavior(InstanceContextMode=InstanceContextMode.PerSession)]   
public class CalculatorService : ICalculatorInstance   
{   
    ...  
}  
```  
  
 <span data-ttu-id="e38eb-136">Et pendant que la propriété <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> contrôle la fréquence à laquelle <xref:System.ServiceModel.InstanceContext> est diffusé, les propriétés <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> et <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType> contrôlent le moment auquel l'objet de service est diffusé.</span><span class="sxs-lookup"><span data-stu-id="e38eb-136">And while the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property controls how often the <xref:System.ServiceModel.InstanceContext> is released, the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> and <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType> properties control when the service object is released.</span></span>  
  
### <a name="well-known-singleton-services"></a><span data-ttu-id="e38eb-137">Services singleton connus</span><span class="sxs-lookup"><span data-stu-id="e38eb-137">Well-Known Singleton Services</span></span>  
 <span data-ttu-id="e38eb-138">L'une des variantes des objets de service d'instance unique s'avère parfois utile : vous pouvez créer un objet de service vous-même, puis créer l'hôte de service à l'aide de cet objet.</span><span class="sxs-lookup"><span data-stu-id="e38eb-138">One variation on single instance service objects is sometimes useful: you can create a service object yourself and create the service host using that object.</span></span> <span data-ttu-id="e38eb-139">Pour ce faire, vous devez également affecter <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> à la propriété <xref:System.ServiceModel.InstanceContextMode.Single>, sans quoi une exception est levée lorsque l'hôte de service est ouvert.</span><span class="sxs-lookup"><span data-stu-id="e38eb-139">To do so, you must also set the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.InstanceContextMode.Single> or an exception is thrown when the service host is opened.</span></span>  
  
 <span data-ttu-id="e38eb-140">Utilisez le constructeur <xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType> pour créer un service de ce type.</span><span class="sxs-lookup"><span data-stu-id="e38eb-140">Use the <xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType> constructor to create such a service.</span></span> <span data-ttu-id="e38eb-141">Il fournit une alternative à l'implémentation d'un <xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType> personnalisé lorsque vous souhaitez fournir une instance d'objet spécifique qui sera utilisée par un service singleton.</span><span class="sxs-lookup"><span data-stu-id="e38eb-141">It provides an alternative to implementing a custom <xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType> when you wish to provide a specific object instance for use by a singleton service.</span></span> <span data-ttu-id="e38eb-142">Vous pouvez utiliser cette surcharge lorsque votre type d'implémentation de service est difficile à construire (par exemple, s'il n'implémente pas de constructeur public sans paramètre par défaut).</span><span class="sxs-lookup"><span data-stu-id="e38eb-142">You can use this overload when your service implementation type is difficult to construct (for example, if it does not implement a default parameterless public constructor).</span></span>  
  
 <span data-ttu-id="e38eb-143">Notez que lorsqu'un objet est fourni à ce constructeur, certaines des fonctionnalités associées au comportement d'instanciation [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] fonctionnent différemment.</span><span class="sxs-lookup"><span data-stu-id="e38eb-143">Note that when an object is provided to this constructor, some features related to the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] instancing behavior work differently.</span></span> <span data-ttu-id="e38eb-144">Par exemple, l'appel de <xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType> n'a aucun effet lorsqu'une instance d'objet singleton est fournie.</span><span class="sxs-lookup"><span data-stu-id="e38eb-144">For example, calling <xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType> has no effect when a singleton object instance is provided.</span></span> <span data-ttu-id="e38eb-145">De même, tout autre mécanisme de libération d'instance est ignoré.</span><span class="sxs-lookup"><span data-stu-id="e38eb-145">Similarly, any other instance-release mechanism is ignored.</span></span> <span data-ttu-id="e38eb-146"><xref:System.ServiceModel.ServiceHost> se comporte systématiquement comme si la propriété <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> avait la valeur <xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType> pour toutes les opérations.</span><span class="sxs-lookup"><span data-stu-id="e38eb-146">The <xref:System.ServiceModel.ServiceHost> always behaves as if the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> property is set to <xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType> for all operations.</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="e38eb-147">Partage d'objets InstanceContext</span><span class="sxs-lookup"><span data-stu-id="e38eb-147">Sharing InstanceContext Objects</span></span>  
 <span data-ttu-id="e38eb-148">Vous pouvez également contrôler l'appel ou le canal de session associé à tel ou tel objet <xref:System.ServiceModel.InstanceContext> en effectuant vous-même l'association.</span><span class="sxs-lookup"><span data-stu-id="e38eb-148">You can also control which sessionful channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span>  
  
## <a name="concurrency"></a><span data-ttu-id="e38eb-149">concurrence</span><span class="sxs-lookup"><span data-stu-id="e38eb-149">Concurrency</span></span>  
 <span data-ttu-id="e38eb-150">La concurrence est le contrôle du nombre de threads actifs simultanément dans un <xref:System.ServiceModel.InstanceContext> .</span><span class="sxs-lookup"><span data-stu-id="e38eb-150">Concurrency is the control of the number of threads active in an <xref:System.ServiceModel.InstanceContext> at any one time.</span></span> <span data-ttu-id="e38eb-151">Cela est contrôlé en utilisant <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType> avec l'énumération <xref:System.ServiceModel.ConcurrencyMode>.</span><span class="sxs-lookup"><span data-stu-id="e38eb-151">This is controlled by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType> with the <xref:System.ServiceModel.ConcurrencyMode> enumeration.</span></span>  
  
 <span data-ttu-id="e38eb-152">Les trois modes de concurrence disponibles sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="e38eb-152">The following three concurrency modes are available:</span></span>  
  
-   <span data-ttu-id="e38eb-153"><xref:System.ServiceModel.ConcurrencyMode.Single>: chaque contexte d'instance est autorisé à avoir au maximum un seul thread à la fois qui traite des messages dans le contexte d'instance.</span><span class="sxs-lookup"><span data-stu-id="e38eb-153"><xref:System.ServiceModel.ConcurrencyMode.Single>: Each instance context is allowed to have a maximum of one thread processing messages in the instance context at a time.</span></span> <span data-ttu-id="e38eb-154">Les autres threads qui souhaitent utiliser le même contexte d'instance doivent se bloquer jusqu'à ce que le thread d'origine quitte le contexte d'instance.</span><span class="sxs-lookup"><span data-stu-id="e38eb-154">Other threads wishing to use the same instance context must block until the original thread exits the instance context.</span></span>  
  
-   <span data-ttu-id="e38eb-155"><xref:System.ServiceModel.ConcurrencyMode.Multiple>: chaque instance de service peut avoir plusieurs threads qui traitent des messages simultanément.</span><span class="sxs-lookup"><span data-stu-id="e38eb-155"><xref:System.ServiceModel.ConcurrencyMode.Multiple>: Each service instance can have multiple threads processing messages concurrently.</span></span> <span data-ttu-id="e38eb-156">Pour utiliser ce mode, l'implémentation de service doit être « thread-safe ».</span><span class="sxs-lookup"><span data-stu-id="e38eb-156">The service implementation must be thread-safe to use this concurrency mode.</span></span>  
  
-   <span data-ttu-id="e38eb-157"><xref:System.ServiceModel.ConcurrencyMode.Reentrant>: chaque instance de service traite un seul message à la fois, mais accepte les appels réentrants.</span><span class="sxs-lookup"><span data-stu-id="e38eb-157"><xref:System.ServiceModel.ConcurrencyMode.Reentrant>: Each service instance processes one message at a time, but accepts re-entrant operation calls.</span></span> <span data-ttu-id="e38eb-158">Le service accepte uniquement ces appels lorsqu'il appelle via un objet client [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e38eb-158">The service only accepts these calls when it is calling out through a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client object.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e38eb-159">Le fonctionnement et le développement de code utilisant plusieurs threads en toute sécurité peuvent s'avérer difficile à écrire.</span><span class="sxs-lookup"><span data-stu-id="e38eb-159">Understanding and developing code that safely uses more than one thread can be difficult to write successfully.</span></span> <span data-ttu-id="e38eb-160">Avant d'utiliser les valeurs <xref:System.ServiceModel.ConcurrencyMode.Multiple> ou <xref:System.ServiceModel.ConcurrencyMode.Reentrant>, assurez-vous que votre service est correctement conçu pour ces modes.</span><span class="sxs-lookup"><span data-stu-id="e38eb-160">Before using <xref:System.ServiceModel.ConcurrencyMode.Multiple> or <xref:System.ServiceModel.ConcurrencyMode.Reentrant> values, ensure that your service is properly designed for these modes.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="e38eb-161"> <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.</span><span class="sxs-lookup"><span data-stu-id="e38eb-161"> <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.</span></span>  
  
 <span data-ttu-id="e38eb-162">L'utilisation de l'accès concurrentiel est associée au mode d'instanciation.</span><span class="sxs-lookup"><span data-stu-id="e38eb-162">The use of concurrency is related to the instancing mode.</span></span> <span data-ttu-id="e38eb-163">Dans <xref:System.ServiceModel.InstanceContextMode.PerCall> d’instanciation, concurrence n’est pas pertinente, car chaque message est traité par un nouveau <xref:System.ServiceModel.InstanceContext> et, par conséquent, jamais plus d’un thread est actif dans le <xref:System.ServiceModel.InstanceContext>.</span><span class="sxs-lookup"><span data-stu-id="e38eb-163">In <xref:System.ServiceModel.InstanceContextMode.PerCall> instancing, concurrency is not relevant, because each message is processed by a new <xref:System.ServiceModel.InstanceContext> and, therefore, never more than one thread is active in the <xref:System.ServiceModel.InstanceContext>.</span></span>  
  
 <span data-ttu-id="e38eb-164">L'exemple de code suivant présente l'affectation de <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> à la propriété <xref:System.ServiceModel.ConcurrencyMode.Multiple>.</span><span class="sxs-lookup"><span data-stu-id="e38eb-164">The following code example demonstrates setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> property to <xref:System.ServiceModel.ConcurrencyMode.Multiple>.</span></span>  
  
```  
[ServiceBehavior(ConcurrencyMode=ConcurrencyMode.Multiple, InstanceContextMode = InstanceContextMode.Single)]   
public class CalculatorService : ICalculatorConcurrency   
{   
    ...  
}  
```  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="e38eb-165">Sessions interagissant avec les paramètres InstanceContext</span><span class="sxs-lookup"><span data-stu-id="e38eb-165">Sessions Interact with InstanceContext Settings</span></span>  
 <span data-ttu-id="e38eb-166">Les sessions et <xref:System.ServiceModel.InstanceContext> interagissent en fonction de la combinaison de la valeur de l'énumération <xref:System.ServiceModel.SessionMode> dans un contrat et la propriété <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> sur l'implémentation de service, qui contrôle l'association entre les canaux et des objets de service spécifiques.</span><span class="sxs-lookup"><span data-stu-id="e38eb-166">Sessions and <xref:System.ServiceModel.InstanceContext> interact depending upon the combination of the value of the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property on the service implementation, which controls the association between channels and specific service objects.</span></span>  
  
 <span data-ttu-id="e38eb-167">Le tableau suivant présente le résultat d'un canal entrant prenant ou non en charge les sessions en fonction de la combinaison des valeurs de la propriété <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> et de la propriété <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> d'un service.</span><span class="sxs-lookup"><span data-stu-id="e38eb-167">The following table shows the result of an incoming channel either supporting sessions or not supporting sessions given a service's combination of the values of the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property.</span></span>  
  
|<span data-ttu-id="e38eb-168">Valeur InstanceContextMode</span><span class="sxs-lookup"><span data-stu-id="e38eb-168">InstanceContextMode value</span></span>|<xref:System.ServiceModel.SessionMode.Required>|<xref:System.ServiceModel.SessionMode.Allowed>|<xref:System.ServiceModel.SessionMode.NotAllowed>|  
|-------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|  
|<span data-ttu-id="e38eb-169">PerCall</span><span class="sxs-lookup"><span data-stu-id="e38eb-169">PerCall</span></span>|<span data-ttu-id="e38eb-170">-Comportement avec canal de session : une session et <xref:System.ServiceModel.InstanceContext> pour chaque appel.</span><span class="sxs-lookup"><span data-stu-id="e38eb-170">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call.</span></span><br /><span data-ttu-id="e38eb-171">-Comportement avec canal sans session : une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="e38eb-171">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="e38eb-172">-Comportement avec canal de session : une session et <xref:System.ServiceModel.InstanceContext> pour chaque appel.</span><span class="sxs-lookup"><span data-stu-id="e38eb-172">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call.</span></span><br /><span data-ttu-id="e38eb-173">-Comportement avec canal sans session : une <xref:System.ServiceModel.InstanceContext> pour chaque appel.</span><span class="sxs-lookup"><span data-stu-id="e38eb-173">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|<span data-ttu-id="e38eb-174">-Comportement avec canal de session : une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="e38eb-174">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="e38eb-175">-Comportement avec canal sans session : une <xref:System.ServiceModel.InstanceContext> pour chaque appel.</span><span class="sxs-lookup"><span data-stu-id="e38eb-175">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|  
|<span data-ttu-id="e38eb-176">PerSession</span><span class="sxs-lookup"><span data-stu-id="e38eb-176">PerSession</span></span>|<span data-ttu-id="e38eb-177">-Comportement avec canal de session : une session et <xref:System.ServiceModel.InstanceContext> pour chaque canal.</span><span class="sxs-lookup"><span data-stu-id="e38eb-177">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel.</span></span><br /><span data-ttu-id="e38eb-178">-Comportement avec canal sans session : une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="e38eb-178">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="e38eb-179">-Comportement avec canal de session : une session et <xref:System.ServiceModel.InstanceContext> pour chaque canal.</span><span class="sxs-lookup"><span data-stu-id="e38eb-179">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel.</span></span><br /><span data-ttu-id="e38eb-180">-Comportement avec canal sans session : une <xref:System.ServiceModel.InstanceContext> pour chaque appel.</span><span class="sxs-lookup"><span data-stu-id="e38eb-180">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|<span data-ttu-id="e38eb-181">-Comportement avec canal de session : une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="e38eb-181">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="e38eb-182">-Comportement avec canal sans session : une <xref:System.ServiceModel.InstanceContext> pour chaque appel.</span><span class="sxs-lookup"><span data-stu-id="e38eb-182">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|  
|<span data-ttu-id="e38eb-183">Single</span><span class="sxs-lookup"><span data-stu-id="e38eb-183">Single</span></span>|<span data-ttu-id="e38eb-184">-Comportement avec canal de session : une session et un seul <xref:System.ServiceModel.InstanceContext> pour tous les appels.</span><span class="sxs-lookup"><span data-stu-id="e38eb-184">-   Behavior with sessionful channel: A session and one <xref:System.ServiceModel.InstanceContext> for all calls.</span></span><br /><span data-ttu-id="e38eb-185">-Comportement avec canal sans session : une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="e38eb-185">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="e38eb-186">-Comportement avec canal de session : une session et <xref:System.ServiceModel.InstanceContext> pour le singleton créé ou spécifié par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e38eb-186">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton.</span></span><br /><span data-ttu-id="e38eb-187">-Comportement avec canal sans session : une <xref:System.ServiceModel.InstanceContext> pour le singleton créé ou spécifié par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e38eb-187">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton.</span></span>|<span data-ttu-id="e38eb-188">-Comportement avec canal de session : une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="e38eb-188">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="e38eb-189">-Comportement avec canal sans session : une <xref:System.ServiceModel.InstanceContext> pour chaque singleton créé ou pour le singleton spécifié par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e38eb-189">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each created singleton or for the user-specified singleton.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="e38eb-190">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="e38eb-190">See Also</span></span>  
 [<span data-ttu-id="e38eb-191">Utilisation de sessions</span><span class="sxs-lookup"><span data-stu-id="e38eb-191">Using Sessions</span></span>](../../../../docs/framework/wcf/using-sessions.md)  
 [<span data-ttu-id="e38eb-192">Comment : créer un Service qui requiert des Sessions</span><span class="sxs-lookup"><span data-stu-id="e38eb-192">How to: Create a Service That Requires Sessions</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md)  
 [<span data-ttu-id="e38eb-193">Comment : Service de contrôle d’instanciation</span><span class="sxs-lookup"><span data-stu-id="e38eb-193">How to: Control Service Instancing</span></span>](../../../../docs/framework/wcf/feature-details/how-to-control-service-instancing.md)  
 [<span data-ttu-id="e38eb-194">Concurrence</span><span class="sxs-lookup"><span data-stu-id="e38eb-194">Concurrency</span></span>](../../../../docs/framework/wcf/samples/concurrency.md)  
 [<span data-ttu-id="e38eb-195">Instanciation</span><span class="sxs-lookup"><span data-stu-id="e38eb-195">Instancing</span></span>](../../../../docs/framework/wcf/samples/instancing.md)  
 [<span data-ttu-id="e38eb-196">Session</span><span class="sxs-lookup"><span data-stu-id="e38eb-196">Session</span></span>](../../../../docs/framework/wcf/samples/session.md)
