---
title: "Utilisation du canal client de découverte"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1494242a-1d64-4035-8ecd-eb4f06c8d2ba
caps.latest.revision: "6"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 11d693e35017d7290e1cf1209dc3d6423afc38b0
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/22/2017
---
# <a name="using-the-discovery-client-channel"></a><span data-ttu-id="dfbaa-102">Utilisation du canal client de découverte</span><span class="sxs-lookup"><span data-stu-id="dfbaa-102">Using the Discovery Client Channel</span></span>
<span data-ttu-id="dfbaa-103">Lors de l'écriture d'une application cliente WCF vous devez connaître l'adresse du point de terminaison du service que vous appelez.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-103">When writing a WCF client application you need to know the endpoint address of the service you are calling.</span></span> <span data-ttu-id="dfbaa-104">Dans de nombreux cas, l'adresse du point de terminaison d'un service n'est pas connue à l'avance ou bien l'adresse du service change avec le temps.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-104">In many situations the endpoint address of a service is not known in advance or the address of the service changes over time.</span></span> <span data-ttu-id="dfbaa-105">Le canal client de découverte vous permet d'écrire une application cliente WCF, de décrire le service que vous souhaitez appeler, et le canal client envoie automatiquement une demande de sonde.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-105">The Discovery Client Channel allows you to write a WCF client application, describe the service you want to call, and the client channel automatically sends a probe request.</span></span> <span data-ttu-id="dfbaa-106">Lorsqu'un service répond, le canal client de découverte extrait de la réponse de sonde l'adresse du point de terminaison du service et l'utilise pour appeler le service.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-106">When a service responds, the discovery client channel retrieves the endpoint address for the service from the probe response and uses it to call the service.</span></span>  
  
## <a name="using-the-discovery-client-channel"></a><span data-ttu-id="dfbaa-107">Utilisation du canal client de découverte</span><span class="sxs-lookup"><span data-stu-id="dfbaa-107">Using the Discovery Client Channel</span></span>  
 <span data-ttu-id="dfbaa-108">Pour utiliser le canal client de découverte, ajoutez une instance de <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> à la pile des canaux de votre client.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-108">To use the Discovery Client Channel, add an instance of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your client channel stack.</span></span> <span data-ttu-id="dfbaa-109">Vous pouvez également utiliser l'objet <xref:System.ServiceModel.Discovery.DynamicEndpoint> et un élément <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> est automatiquement ajouté à votre liaison, s'il n'est pas déjà présent.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-109">Alternatively you can use the <xref:System.ServiceModel.Discovery.DynamicEndpoint> and a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is automatically added to your binding if not already present.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="dfbaa-110">Il est recommandé de placer <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> au niveau supérieur sur votre pile des canaux clients.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-110">It is recommended that the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is the top-most element on your client channel stack.</span></span> <span data-ttu-id="dfbaa-111">Tout élément de liaison ajouté par-dessus <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> doit s'assurer que l'objet <xref:System.ServiceModel.ChannelFactory>, ou le canal qu'il crée, n'utilise pas l'adresse du point de terminaison ni l'adresse `Via` (transmise à la méthode `CreateChannel`). Elles risquent en effet de ne pas contenir d'adresse correcte.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-111">Any binding element that is added on top of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the <xref:System.ServiceModel.ChannelFactory> or channel it creates does not use the endpoint address or `Via` address (passed to the `CreateChannel` method) because they may not contain the correct address.</span></span>  
  
 <span data-ttu-id="dfbaa-112">La classe <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> contient deux propriétés publiques :</span><span class="sxs-lookup"><span data-stu-id="dfbaa-112">The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> class contains two public properties:</span></span>  
  
1.  <span data-ttu-id="dfbaa-113"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A>, utilisée pour décrire le service que vous souhaitez appeler.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-113"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A>, which is used to describe the service you want to call.</span></span>  
  
2.  <span data-ttu-id="dfbaa-114"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpointProvider%2A>qui spécifie le point de terminaison de découverte à envoyer des messages de découverte.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-114"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpointProvider%2A> which specifies the discovery endpoint to send discovery messages to.</span></span>  
  
 <span data-ttu-id="dfbaa-115">La propriété <xref:System.ServiceModel.Discovery.FindCriteria.%23ctor%2A> vous permet de spécifier le contrat de service que vous recherchez, un URI d'étendue requis et la durée maximale de tentative d'ouverture du canal.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-115">The <xref:System.ServiceModel.Discovery.FindCriteria.%23ctor%2A> property allows you to specify the service contract you are searching for, any required scope URIs, and the maximum number of time to attempt to open the channel.</span></span> <span data-ttu-id="dfbaa-116">Le type de contrat est spécifié en appelant le constructeur <xref:System.ServiceModel.Discovery.FindCriteria>.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-116">The contract type is specified by calling the constructor  <xref:System.ServiceModel.Discovery.FindCriteria>.</span></span> <span data-ttu-id="dfbaa-117">Des URI d'étendue peuvent être ajoutés à la propriété <xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A>.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-117">Scope URIs can be added to the <xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A> property.</span></span> <span data-ttu-id="dfbaa-118">La propriété <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> vous permet de spécifier le nombre maximal de résultats auxquels le client essaie de se connecter.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-118">The <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> property allows you to specify the maximum number of results to which the client tries to connect to.</span></span> <span data-ttu-id="dfbaa-119">Lorsqu'une réponse de sonde est reçue, le client tente d'ouvrir le canal à l'aide de l'adresse du point de terminaison de la réponse de sonde.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-119">When a probe response is received the client attempts to open the channel using the endpoint address from the probe response.</span></span> <span data-ttu-id="dfbaa-120">Si une exception se produit, le client passe à la réponse de sonde suivante, en attendant que davantage de réponses soit reçues, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-120">If an exception occurs the client moves on to the next probe response, waiting for more responses to be received if necessary.</span></span> <span data-ttu-id="dfbaa-121">Il continue à procéder ainsi jusqu'à ce que le canal s'ouvre avec succès ou que le nombre maximal de résultats soit atteint.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-121">It continues to do this until the channel is successfully opened or the maximum number of results is reached.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="dfbaa-122">Ces paramètres, consultez <xref:System.ServiceModel.Discovery.FindCriteria>.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-122"> these settings, see <xref:System.ServiceModel.Discovery.FindCriteria>.</span></span>  
  
 <span data-ttu-id="dfbaa-123">La propriété <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpointProvider%2A> vous permet de spécifier le point de terminaison de découverte à utiliser.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-123">The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpointProvider%2A> property allows you to specify the discovery endpoint to use.</span></span> <span data-ttu-id="dfbaa-124">Normalement, c'est un <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, mais il peut s'agir de tout point de terminaison valide.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-124">Normally this is a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, but it can be any valid endpoint.</span></span>  
  
 <span data-ttu-id="dfbaa-125">Lorsque vous créez la liaison à utiliser pour communiquer avec le service, vous devez veiller à utiliser exactement la même liaison que le service.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-125">When you are creating the binding to use to communicate with the service, you must be careful to use the exact same binding as the service.</span></span> <span data-ttu-id="dfbaa-126">La seule différence est que la liaison cliente a un <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> sur le haut de la pile.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-126">The only difference is the client binding has a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> on the top of the stack.</span></span> <span data-ttu-id="dfbaa-127">Si le service utilise l'une des liaisons fournies par le système, créez un <xref:System.ServiceModel.Channels.CustomBinding> et passez la liaison fournie par le système au constructeur <xref:System.ServiceModel.Channels.CustomBinding.%23ctor%2A>.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-127">If service is using one of the system-provided bindings, create a new <xref:System.ServiceModel.Channels.CustomBinding> and pass in the system-provided binding to the <xref:System.ServiceModel.Channels.CustomBinding.%23ctor%2A> constructor.</span></span> <span data-ttu-id="dfbaa-128">Vous pouvez ensuite ajouter le <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> en appelant `Insert` sur la propriété <xref:System.ServiceModel.Channels.CustomBinding.Elements%2A>.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-128">Then you can add the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> by calling `Insert` on the <xref:System.ServiceModel.Channels.CustomBinding.Elements%2A> property.</span></span>  
  
 <span data-ttu-id="dfbaa-129">Une fois que vous avez ajouté le <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> à votre liaison et que vous l'avez configuré, vous pouvez créer une instance de la classe de client WCF, l'ouvrir et appeler ses méthodes.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-129">Once you have added the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your binding and configured it, you can create an instance of the WCF client class, open it, and call its methods.</span></span> <span data-ttu-id="dfbaa-130">L'exemple suivant utilise le canal client de découverte pour découvrir un service WCF qui implémente la classe `ICalculator` (utilisée dans le didacticiel de mise en route de WCF) et appelle sa méthode `Add`.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-130">The following example uses the Discovery Client Channel to discover a WCF service that implements the `ICalculator` class (used in the Getting Started WCF tutorial) and calls its `Add` method.</span></span>  
  
```  
// Create the DiscoveryClientBindingElement  
DiscoveryClientBindingElement bindingElement = new DiscoveryClientBindingElement();  
// Search for a service that implements the ICalculator interface, attempting to open  
// the channel a maximum of 2 times  
bindingElement.FindCriteria = new FindCriteria(typeof(ICalculator)) { MaxResults = 2 };  
// Use the UdpDiscoveryEndpoint  
bindingElement.DiscoveryEndpoint = new UdpDiscoveryEndpoint();  
  
// The service uses the BasicHttpBinding, so use that and insert the DiscoveryClientBindingElement at the   
// top of the stack  
CustomBinding binding = new CustomBinding(new BasicHttpBinding());  
binding.Elements.Insert(0,bindingElement);  
  
try  
{  
    // Create the WCF client and call a method  
    CalculatorClient client = new CalculatorClient(binding, new EndpointAddress("http://schemas.microsoft.com/dynamic"));  
    client.Open();  
    client.Add(1, 1);  
}  
catch (EndpointNotFoundException ex)  
{  
    Console.WriteLine("An exception occurred: " + ex.Message);  
}  
```  
  
## <a name="security-and-the-discovery-client-channel"></a><span data-ttu-id="dfbaa-131">La sécurité et le canal client de découverte</span><span class="sxs-lookup"><span data-stu-id="dfbaa-131">Security and the Discovery Client Channel</span></span>  
 <span data-ttu-id="dfbaa-132">Lors de l'utilisation du canal client de découverte, deux points de terminaison sont spécifiés.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-132">When using the discovery client channel, two endpoints are being specified.</span></span> <span data-ttu-id="dfbaa-133">L'un, <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> habituellement, est utilisé pour les messages de découverte et l'autre est le point de terminaison d'application.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-133">One is used for discovery messages, usually <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, and the other is the application endpoint.</span></span> <span data-ttu-id="dfbaa-134">Lors de l'implémentation d'un service sécurisé, il faut veiller à sécuriser les deux points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="dfbaa-134">When implementing a secure service, care must be taken to secure both endpoints.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="dfbaa-135">la sécurité, consultez [sécurisation des Services et les Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md).</span><span class="sxs-lookup"><span data-stu-id="dfbaa-135"> security, see [Securing Services and Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md).</span></span>
