---
title: Utilisation de sessions
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords: sessions [WCF]
ms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035
caps.latest.revision: "32"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: c78363a1a31a1b5f0ac3cc154c1ad53962d0e7de
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2017
---
# <a name="using-sessions"></a><span data-ttu-id="853eb-102">Utilisation de sessions</span><span class="sxs-lookup"><span data-stu-id="853eb-102">Using Sessions</span></span>
<span data-ttu-id="853eb-103">Dans les applications [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] , une *session* met en corrélation un groupe de messages dans une conversation.</span><span class="sxs-lookup"><span data-stu-id="853eb-103">In [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] applications, a *session* correlates a group of messages into a conversation.</span></span> <span data-ttu-id="853eb-104">Les sessions[!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sont différentes de l'objet session disponible dans des applications [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] , prennent en charge différents comportements et sont contrôlées de différentes façons.</span><span class="sxs-lookup"><span data-stu-id="853eb-104">[!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sessions are different than the session object available in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications, support different behaviors, and are controlled in different ways.</span></span> <span data-ttu-id="853eb-105">Cette rubrique décrit les fonctionnalités activées par les sessions dans les applications [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] et comment les utiliser.</span><span class="sxs-lookup"><span data-stu-id="853eb-105">This topic describes the features that sessions enable in [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] applications and how to use them.</span></span>  
  
## <a name="sessions-in-windows-communication-foundation-applications"></a><span data-ttu-id="853eb-106">Sessions dans les applications Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="853eb-106">Sessions in Windows Communication Foundation Applications</span></span>  
 <span data-ttu-id="853eb-107">Lorsqu'un contrat de service spécifie qu'il requiert une session, ce contrat requiert que les appels généraux (autrement dit, les échanges de messages sous-jacents qui prennent en charge les appels) doivent faire partie de la même conversation.</span><span class="sxs-lookup"><span data-stu-id="853eb-107">When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="853eb-108">Si un contrat spécifie qu'il autorise des sessions mais n'en requiert pas, les clients peuvent se connecter et établir ou non une session.</span><span class="sxs-lookup"><span data-stu-id="853eb-108">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session.</span></span> <span data-ttu-id="853eb-109">Si la session se termine et qu'un message est envoyé via le même canal, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="853eb-109">If the session ends and a message is sent through the same channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="853eb-110">Les sessions[!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sont associées aux principales fonctionnalités conceptuelles suivantes :</span><span class="sxs-lookup"><span data-stu-id="853eb-110">[!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sessions have the following main conceptual features:</span></span>  
  
-   <span data-ttu-id="853eb-111">Elles sont explicitement initialisées et terminées par l'application appelante (le client WCF).</span><span class="sxs-lookup"><span data-stu-id="853eb-111">They are explicitly initiated and terminated by the calling application (the WCF client).</span></span>  
  
-   <span data-ttu-id="853eb-112">Les messages remis pendant une session sont traités dans l'ordre dans lequel ils sont reçus.</span><span class="sxs-lookup"><span data-stu-id="853eb-112">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
-   <span data-ttu-id="853eb-113">Les sessions corrèlent un groupe de messages dans une conversation.</span><span class="sxs-lookup"><span data-stu-id="853eb-113">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="853eb-114">Différents types de corrélation sont possibles :</span><span class="sxs-lookup"><span data-stu-id="853eb-114">Different types of correlation are possible.</span></span> <span data-ttu-id="853eb-115">Par exemple, un canal basé sur session peut corréler des messages sur la base d'une connexion réseau partagée, pendant qu'un autre canal basé sur session corrèle des messages sur la base d'une balise partagée dans le corps du message.</span><span class="sxs-lookup"><span data-stu-id="853eb-115">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="853eb-116">Les fonctionnalités qui peuvent être dérivées de la session varient en fonction de la nature de la corrélation.</span><span class="sxs-lookup"><span data-stu-id="853eb-116">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
-   <span data-ttu-id="853eb-117">Il n'existe pas de magasin de données général associé à une session [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="853eb-117">There is no general data store associated with a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] session.</span></span>  
  
 <span data-ttu-id="853eb-118">Si vous êtes familiarisé avec la classe <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> des applications [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] et avec les fonctionnalités qu'elle fournit, vous remarquerez les différences suivantes entre ce type de session et les sessions [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="853eb-118">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sessions:</span></span>  
  
-   <span data-ttu-id="853eb-119">Les sessions[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sont systématiquement initialisées par le serveur.</span><span class="sxs-lookup"><span data-stu-id="853eb-119">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions are always server-initiated.</span></span>  
  
-   <span data-ttu-id="853eb-120">Les sessions[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sont implicitement non ordonnées.</span><span class="sxs-lookup"><span data-stu-id="853eb-120">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions are implicitly unordered.</span></span>  
  
-   <span data-ttu-id="853eb-121">Les sessions[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] fournissent un mécanisme de stockage général des données sur l'ensemble des demandes.</span><span class="sxs-lookup"><span data-stu-id="853eb-121">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="853eb-122">Cette rubrique décrit :</span><span class="sxs-lookup"><span data-stu-id="853eb-122">This topic describes:</span></span>  
  
-   <span data-ttu-id="853eb-123">Le comportement d'exécution par défaut lors de l'utilisation de liaisons basées sur session dans la couche de modèle de service.</span><span class="sxs-lookup"><span data-stu-id="853eb-123">The default execution behavior when using session-based bindings in the service model layer.</span></span>  
  
-   <span data-ttu-id="853eb-124">Types de fonctionnalités que les liaisons [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] définies par le système et basées sur les sessions fournissent.</span><span class="sxs-lookup"><span data-stu-id="853eb-124">The types of features that the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] session-based, system-provided bindings provide.</span></span>  
  
-   <span data-ttu-id="853eb-125">Comment créer un contrat qui déclare une spécification de session.</span><span class="sxs-lookup"><span data-stu-id="853eb-125">How to create a contract that declares a session requirement.</span></span>  
  
-   <span data-ttu-id="853eb-126">Comment comprendre et contrôler la création de la session , la fin de la session et la relation entre la session et l'instance de service.</span><span class="sxs-lookup"><span data-stu-id="853eb-126">How to understand and control the creation and termination of the session and the relationship of the session to the service instance.</span></span>  
  
## <a name="default-execution-behavior-using-sessions"></a><span data-ttu-id="853eb-127">Comportement d'exécution par défaut à l'aide de sessions</span><span class="sxs-lookup"><span data-stu-id="853eb-127">Default Execution Behavior Using Sessions</span></span>  
 <span data-ttu-id="853eb-128">Une liaison qui tente d'initialiser une session est appelée une liaison *basée sur session* .</span><span class="sxs-lookup"><span data-stu-id="853eb-128">A binding that attempts to initiate a session is called a *session-based* binding.</span></span> <span data-ttu-id="853eb-129">Les contrats de service spécifient qu'ils requièrent, autorisent ou refusent des liaisons basées sur session en affectant l'une des valeurs d'énumération <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> à la propriété <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> sur l'interface de contrat de service (ou classe).</span><span class="sxs-lookup"><span data-stu-id="853eb-129">Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values.</span></span> <span data-ttu-id="853eb-130">Par défaut, la valeur de cette propriété est <xref:System.ServiceModel.SessionMode.Allowed>, signifiant que si un client utilise une liaison basée sur session avec une implémentation du service [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] , le service établit et utilise la session fournie.</span><span class="sxs-lookup"><span data-stu-id="853eb-130">By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service implementation, the service establishes and uses the session provided.</span></span>  
  
 <span data-ttu-id="853eb-131">Lorsqu'un service [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] accepte une session cliente, les fonctionnalités suivantes sont activées par défaut :</span><span class="sxs-lookup"><span data-stu-id="853eb-131">When a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service accepts a client session, the following features are enabled by default:</span></span>  
  
1.  <span data-ttu-id="853eb-132">Tous les appels entre un objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sont gérés par la même instance de service.</span><span class="sxs-lookup"><span data-stu-id="853eb-132">All calls between a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object are handled by the same service instance.</span></span>  
  
2.  <span data-ttu-id="853eb-133">Différentes liaisons basées sur les sessions fournissent des fonctionnalités supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="853eb-133">Different session-based bindings provide additional features.</span></span>  
  
## <a name="system-provided-session-types"></a><span data-ttu-id="853eb-134">Types de sessions fournis par le système</span><span class="sxs-lookup"><span data-stu-id="853eb-134">System-Provided Session Types</span></span>  
 <span data-ttu-id="853eb-135">Une liaison basée sur session prend en charge l'association par défaut d'une instance de service avec une session donnée.</span><span class="sxs-lookup"><span data-stu-id="853eb-135">A session-based binding supports the default association of a service instance with a particular session.</span></span> <span data-ttu-id="853eb-136">Toutefois, différentes liaisons basées sur session prennent en charge des fonctionnalités différentes en plus d'activer le contrôle d'instanciation basé sur session précédemment décrit.</span><span class="sxs-lookup"><span data-stu-id="853eb-136">However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.</span></span>  
  
 [!INCLUDE[indigo2](../../../includes/indigo2-md.md)]<span data-ttu-id="853eb-137"> fournit les types de comportement d'application basé sur session suivants :</span><span class="sxs-lookup"><span data-stu-id="853eb-137"> provides the following types of session-based application behavior:</span></span>  
  
-   <span data-ttu-id="853eb-138"><xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> prend en charge des sessions basées sur sécurité, dans lesquelles les deux terminaisons de communication ont convenu d'une conversation sécurisée spécifique.</span><span class="sxs-lookup"><span data-stu-id="853eb-138">The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation.</span></span> [!INCLUDE[crdefault](../../../includes/crdefault-md.md)]<span data-ttu-id="853eb-139">[Sécurisation des Services](../../../docs/framework/wcf/securing-services.md).</span><span class="sxs-lookup"><span data-stu-id="853eb-139"> [Securing Services](../../../docs/framework/wcf/securing-services.md).</span></span> <span data-ttu-id="853eb-140">Par exemple, la liaison <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> qui contient la prise en charge des sessions de sécurité et des sessions fiables, utilise par défaut uniquement une session sécurisée qui chiffre et signe numériquement les messages.</span><span class="sxs-lookup"><span data-stu-id="853eb-140">For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.</span></span>  
  
-   <span data-ttu-id="853eb-141">La liaison <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> prend en charge les sessions basées sur TCP/IP pour garantir que tous les messages sont corrélés par la connexion au niveau du socket.</span><span class="sxs-lookup"><span data-stu-id="853eb-141">The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.</span></span>  
  
-   <span data-ttu-id="853eb-142">L'élément <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> qui implémente la spécification WS-ReliableMessaging, fournit la prise en charge des sessions fiables dans lesquelles les messages peuvent être configurés afin d'être remis dans l'ordre et exactement une fois, ce qui garantit que les messages sont reçus même lorsqu'ils passent par plusieurs nœuds pendant la conversation.</span><span class="sxs-lookup"><span data-stu-id="853eb-142">The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation.</span></span> [!INCLUDE[crdefault](../../../includes/crdefault-md.md)]<span data-ttu-id="853eb-143">[Des Sessions fiables](../../../docs/framework/wcf/feature-details/reliable-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="853eb-143"> [Reliable Sessions](../../../docs/framework/wcf/feature-details/reliable-sessions.md).</span></span>  
  
-   <span data-ttu-id="853eb-144">La liaison <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> fournit des sessions de datagramme MSMQ.</span><span class="sxs-lookup"><span data-stu-id="853eb-144">The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions.</span></span> [!INCLUDE[crdefault](../../../includes/crdefault-md.md)]<span data-ttu-id="853eb-145">[Les files d’attente dans WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="853eb-145"> [Queues in WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).</span></span>  
  
 <span data-ttu-id="853eb-146">La définition de la propriété <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> ne spécifie pas le type de session que le contrat requiert mais uniquement qu'il requiert un type de session.</span><span class="sxs-lookup"><span data-stu-id="853eb-146">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one.</span></span>  
  
## <a name="creating-a-contract-that-requires-a-session"></a><span data-ttu-id="853eb-147">Création d'un contrat qui requiert une session</span><span class="sxs-lookup"><span data-stu-id="853eb-147">Creating a Contract That Requires a Session</span></span>  
 <span data-ttu-id="853eb-148">La création d'un contrat qui requiert une session déclare que le groupe d'opérations que le contrat de service déclare doit entièrement être exécuté dans la même session et que les messages doivent être remis dans l'ordre.</span><span class="sxs-lookup"><span data-stu-id="853eb-148">Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order.</span></span> <span data-ttu-id="853eb-149">Pour déterminer le niveau de support de session qu'un contrat de service requiert, attribuez la valeur de l'énumération <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> à la propriété <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> sur votre interface de contrat de service ou classe, afin de spécifier si le contrat :</span><span class="sxs-lookup"><span data-stu-id="853eb-149">To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:</span></span>  
  
-   <span data-ttu-id="853eb-150">Requiert une session.</span><span class="sxs-lookup"><span data-stu-id="853eb-150">Requires a session.</span></span>  
  
-   <span data-ttu-id="853eb-151">Permet à un client d'établir une session.</span><span class="sxs-lookup"><span data-stu-id="853eb-151">Allows a client to establish a session.</span></span>  
  
-   <span data-ttu-id="853eb-152">Interdit une session.</span><span class="sxs-lookup"><span data-stu-id="853eb-152">Prohibits a session.</span></span>  
  
 <span data-ttu-id="853eb-153">Toutefois, la définition de la propriété <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> ne spécifie pas le type de comportement basé sur session que le contrat requiert.</span><span class="sxs-lookup"><span data-stu-id="853eb-153">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires.</span></span> <span data-ttu-id="853eb-154">Il demande à [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] de confirmer au moment de l'exécution que la liaison (créant le canal de communication) configurée pour le service établit, n'établit pas ou peut établir une session lors de l'implémentation d'un service.</span><span class="sxs-lookup"><span data-stu-id="853eb-154">It instructs [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service.</span></span> <span data-ttu-id="853eb-155">Une fois encore, la liaison peut satisfaire cette spécification avec tout type de comportement basé sur session choisi : sécurité, transport, fiable ou toute combinaison.</span><span class="sxs-lookup"><span data-stu-id="853eb-155">Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination.</span></span> <span data-ttu-id="853eb-156">Le comportement exact dépend de la valeur <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="853eb-156">The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected.</span></span> <span data-ttu-id="853eb-157">Si la liaison configurée du service n'est pas conforme à la valeur <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="853eb-157">If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown.</span></span> <span data-ttu-id="853eb-158">Les liaisons et les canaux créés prenant en charge ces sessions sont dits « basés sur session ».</span><span class="sxs-lookup"><span data-stu-id="853eb-158">Bindings and the channels they create that support sessions are said to be session-based.</span></span>  
  
 <span data-ttu-id="853eb-159">Le contrat de service suivant spécifie que toutes les opérations de la `ICalculatorSession` doivent être échangées dans une session.</span><span class="sxs-lookup"><span data-stu-id="853eb-159">The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session.</span></span> <span data-ttu-id="853eb-160">Aucune des opérations ne retourne une valeur à l'appelant sauf la méthode `Equals` .</span><span class="sxs-lookup"><span data-stu-id="853eb-160">None of the operations returns a value to the caller except the `Equals` method.</span></span> <span data-ttu-id="853eb-161">Toutefois, la méthode `Equals` ne prend pas de paramètres et, par conséquent, peut retourner uniquement une valeur non nulle à l'intérieur d'une session dans laquelle les données sont déjà passées aux autres opérations.</span><span class="sxs-lookup"><span data-stu-id="853eb-161">However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations.</span></span> <span data-ttu-id="853eb-162">Ce contrat requiert qu'une session fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="853eb-162">This contract requires a session to function properly.</span></span> <span data-ttu-id="853eb-163">Sans une session associée à un client spécifique, l'instance de service n'a aucun moyen de savoir quelles données ce client a envoyées précédemment.</span><span class="sxs-lookup"><span data-stu-id="853eb-163">Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.</span></span>  
  
 [!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]
 [!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]  
  
 <span data-ttu-id="853eb-164">Si un service autorise une session, une session est établie et utilisée si le client en initialise une ; sinon, aucune session n'est établie.</span><span class="sxs-lookup"><span data-stu-id="853eb-164">If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.</span></span>  
  
## <a name="sessions-and-service-instances"></a><span data-ttu-id="853eb-165">Sessions et instances de service</span><span class="sxs-lookup"><span data-stu-id="853eb-165">Sessions and Service Instances</span></span>  
 <span data-ttu-id="853eb-166">Si vous utilisez le comportement d'instanciation par défaut de [!INCLUDE[indigo2](../../../includes/indigo2-md.md)], les appels généraux entre un objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sont gérés par la même instance de service.</span><span class="sxs-lookup"><span data-stu-id="853eb-166">If you use the default instancing behavior in [!INCLUDE[indigo2](../../../includes/indigo2-md.md)], all calls between a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object are handled by the same service instance.</span></span> <span data-ttu-id="853eb-167">Par conséquent, au niveau de l'application, vous pouvez considérer une session comme un moyen d'activer un comportement d'application similaire au comportement d'appel local.</span><span class="sxs-lookup"><span data-stu-id="853eb-167">Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior.</span></span> <span data-ttu-id="853eb-168">Par exemple, lorsque vous créez un objet local :</span><span class="sxs-lookup"><span data-stu-id="853eb-168">For example, when you create a local object:</span></span>  
  
-   <span data-ttu-id="853eb-169">Un constructeur est appelé.</span><span class="sxs-lookup"><span data-stu-id="853eb-169">A constructor is called.</span></span>  
  
-   <span data-ttu-id="853eb-170">Tous les appels effectués ultérieurement à la référence d'objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sont traités par la même instance d'objet.</span><span class="sxs-lookup"><span data-stu-id="853eb-170">All subsequent calls made to the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object reference are processed by the same object instance.</span></span>  
  
-   <span data-ttu-id="853eb-171">Un destructeur est appelé lorsque la référence d'objet est détruite.</span><span class="sxs-lookup"><span data-stu-id="853eb-171">A destructor is called when the object reference is destroyed.</span></span>  
  
 <span data-ttu-id="853eb-172">Les sessions activent un comportement semblable entre les clients et les services tant que le comportement de l'instance de service par défaut est utilisé.</span><span class="sxs-lookup"><span data-stu-id="853eb-172">Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used.</span></span> <span data-ttu-id="853eb-173">Si un contrat de service requiert ou prend en charge des sessions, une ou plusieurs opérations de contrat peuvent être marquées comme initialisant ou terminant une session, par l'attribution des propriétés <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> et <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> .</span><span class="sxs-lookup"><span data-stu-id="853eb-173">If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties.</span></span>  
  
 <span data-ttu-id="853eb-174">Les*opérations d'initialisation* sont celles qui doivent être appelées comme première opération d'une nouvelle session.</span><span class="sxs-lookup"><span data-stu-id="853eb-174">*Initiating operations* are those that must be called as the first operation of a new session.</span></span> <span data-ttu-id="853eb-175">Vous devez appeler au moins une opération d'initialisation avant de pouvoir appeler d'autres opérations.</span><span class="sxs-lookup"><span data-stu-id="853eb-175">Non-initiating operations can be called only after at least one initiating operation has been called.</span></span> <span data-ttu-id="853eb-176">Vous pouvez par conséquent créer un type de constructeur de session pour votre service en déclarant des opérations d'initialisation conçues pour prendre l'entrée des clients appropriés au début de l'instance de service.</span><span class="sxs-lookup"><span data-stu-id="853eb-176">You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance.</span></span> <span data-ttu-id="853eb-177">(Toutefois, l'état est associé à la session et pas à l'objet de service.)</span><span class="sxs-lookup"><span data-stu-id="853eb-177">(The state is associated with the session, however, and not the service object.)</span></span>  
  
 <span data-ttu-id="853eb-178">Les*opérations de fin*, inversement, doivent être appelées comme dernier message dans une session existante.</span><span class="sxs-lookup"><span data-stu-id="853eb-178">*Terminating operations*, conversely, are those that must be called as the last message in an existing session.</span></span> <span data-ttu-id="853eb-179">Par défaut, [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] recycle l'objet de service et son contexte après la fermeture de la session à laquelle le service a été associé.</span><span class="sxs-lookup"><span data-stu-id="853eb-179">In the default case, [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] recycles the service object and its context after the session with which the service was associated is closed.</span></span> <span data-ttu-id="853eb-180">Vous pouvez, par conséquent, créer un type de destructeur en déclarant les opérations de fin conçues pour exécuter une fonction appropriée à la fin de l'instance de service.</span><span class="sxs-lookup"><span data-stu-id="853eb-180">You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="853eb-181">Bien que le comportement par défaut présente une ressemblance avec les constructeurs et les destructeurs locaux, il ne s'agit que d'une ressemblance.</span><span class="sxs-lookup"><span data-stu-id="853eb-181">Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance.</span></span> <span data-ttu-id="853eb-182">Toute opération du service [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] peut être une opération d'initialisation ou de fin, ou les deux à la fois.</span><span class="sxs-lookup"><span data-stu-id="853eb-182">Any [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service operation can be an initiating or terminating operation, or both at the same time.</span></span> <span data-ttu-id="853eb-183">De plus, par défaut, les opérations d'initialisation peuvent être appelées un nombre illimité de fois, dans tout ordre, après l'appel de la première ; aucune session supplémentaire n'est créée une fois que la session est établie et associée à une instance, à moins que vous ne contrôliez explicitement la durée de vie de l'instance de service (en manipulant l'objet <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType>).</span><span class="sxs-lookup"><span data-stu-id="853eb-183">In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object).</span></span> <span data-ttu-id="853eb-184">Enfin, l'état est associé à la session et pas l'objet de service.</span><span class="sxs-lookup"><span data-stu-id="853eb-184">Finally, the state is associated with the session and not the service object.</span></span>  
  
 <span data-ttu-id="853eb-185">Par exemple, le contrat `ICalculatorSession` utilisé dans l'exemple précédent requiert que l'objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] appelle en premier l'opération `Clear` avant toute autre opération et que la session avec l'objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] se termine lorsqu'il appelle l'opération `Equals` .</span><span class="sxs-lookup"><span data-stu-id="853eb-185">For example, the `ICalculatorSession` contract used in the preceding example requires that the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object first call the `Clear` operation prior to any other operation and that the session with this [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object should terminate when it calls the `Equals` operation.</span></span> <span data-ttu-id="853eb-186">L'exemple de code suivant montre un contrat qui applique ces spécifications.</span><span class="sxs-lookup"><span data-stu-id="853eb-186">The following code example shows a contract that enforces these requirements.</span></span> <span data-ttu-id="853eb-187">`Clear` doit être appelé en premier pour initialiser une session, et cette session se termine lorsque `Equals` est appelé.</span><span class="sxs-lookup"><span data-stu-id="853eb-187">`Clear` must be called first to initiate a session, and that session ends when `Equals` is called.</span></span>  
  
 [!code-csharp[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/csharp/VS_Snippets_CFX/sca.isinitiatingisterminating/cs/service.cs#1)]
 [!code-vb[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/sca.isinitiatingisterminating/vb/service.vb#1)]  
  
 <span data-ttu-id="853eb-188">Les services ne démarrent pas de sessions avec les clients.</span><span class="sxs-lookup"><span data-stu-id="853eb-188">Services do not start sessions with clients.</span></span> <span data-ttu-id="853eb-189">Dans les applications clientes [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] , il existe une relation directe entre la durée de vie du canal basé sur session et la durée de vie de la session elle-même.</span><span class="sxs-lookup"><span data-stu-id="853eb-189">In [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself.</span></span> <span data-ttu-id="853eb-190">En tant que tels, les clients créent de nouvelles sessions en créant de nouveaux canaux basés sur des sessions et détruisent les sessions existantes en fermant correctement lesdits canaux.</span><span class="sxs-lookup"><span data-stu-id="853eb-190">As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully.</span></span> <span data-ttu-id="853eb-191">Un client démarre une session avec un point de terminaison de service en appelant l'un des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="853eb-191">A client starts a session with a service endpoint by calling one of the following:</span></span>  
  
-   <span data-ttu-id="853eb-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> sur le canal retourné par un appel à <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="853eb-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
-   <span data-ttu-id="853eb-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType>sur le [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] objet client généré par le [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="853eb-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span>  
  
-   <span data-ttu-id="853eb-194">Une opération d'initialisation sur un type d'objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] (par défaut, toutes les opérations s'initialisent).</span><span class="sxs-lookup"><span data-stu-id="853eb-194">An initiating operation on either type of [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object (by default, all operations are initiating).</span></span> <span data-ttu-id="853eb-195">Lorsque la première opération est appelée, l'objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] ouvre automatiquement le canal et initialise une session.</span><span class="sxs-lookup"><span data-stu-id="853eb-195">When the first operation is called, the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="853eb-196">Habituellement, un client termine une session avec un point de terminaison de service en appelant l'un des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="853eb-196">Typically a client ends a session with a service endpoint by calling one of the following:</span></span>  
  
-   <span data-ttu-id="853eb-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> sur le canal retourné par un appel à <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="853eb-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
-   <span data-ttu-id="853eb-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> sur l'objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] généré par Svcutil.exe.</span><span class="sxs-lookup"><span data-stu-id="853eb-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object generated by Svcutil.exe.</span></span>  
  
-   <span data-ttu-id="853eb-199">Une opération terminant sur un type d'objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] (par défaut, aucune opération ne termine ; le contrat doit spécifier explicitement une opération de fin).</span><span class="sxs-lookup"><span data-stu-id="853eb-199">A terminating operation on either type of [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation).</span></span> <span data-ttu-id="853eb-200">Lorsque la première opération est appelée, l'objet client [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] ouvre automatiquement le canal et initialise une session.</span><span class="sxs-lookup"><span data-stu-id="853eb-200">When the first operation is called, the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="853eb-201">Pour obtenir des exemples, consultez [How to: Create a Service That Requires Sessions](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) ainsi que [Default Service Behavior](../../../docs/framework/wcf/samples/default-service-behavior.md) et [Instancing](../../../docs/framework/wcf/samples/instancing.md) .</span><span class="sxs-lookup"><span data-stu-id="853eb-201">For examples, see [How to: Create a Service That Requires Sessions](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](../../../docs/framework/wcf/samples/default-service-behavior.md) and [Instancing](../../../docs/framework/wcf/samples/instancing.md) samples.</span></span>  
  
 [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="853eb-202">les clients et les sessions, consultez [les Services de l’accès à l’aide d’un Client WCF](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="853eb-202"> clients and sessions, see [Accessing Services Using a WCF Client](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).</span></span>  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="853eb-203">Sessions interagissant avec les paramètres InstanceContext</span><span class="sxs-lookup"><span data-stu-id="853eb-203">Sessions Interact with InstanceContext Settings</span></span>  
 <span data-ttu-id="853eb-204">Il y a une interaction entre l'énumération <xref:System.ServiceModel.SessionMode> dans un contrat et la propriété <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> qui contrôle l'association entre canaux et objets de service spécifiques.</span><span class="sxs-lookup"><span data-stu-id="853eb-204">There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects.</span></span> [!INCLUDE[crdefault](../../../includes/crdefault-md.md)]<span data-ttu-id="853eb-205">[Sessions, instanciation et accès concurrentiel](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).</span><span class="sxs-lookup"><span data-stu-id="853eb-205"> [Sessions, Instancing, and Concurrency](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="853eb-206">Partage d'objets InstanceContext</span><span class="sxs-lookup"><span data-stu-id="853eb-206">Sharing InstanceContext Objects</span></span>  
 <span data-ttu-id="853eb-207">Vous pouvez également contrôler quel canal ou appel basé sur session est associé à tel ou tel objet <xref:System.ServiceModel.InstanceContext> en effectuant vous-même l'association.</span><span class="sxs-lookup"><span data-stu-id="853eb-207">You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span> <span data-ttu-id="853eb-208">Pour obtenir un exemple complet, consultez [InstanceContextSharing](http://msdn.microsoft.com/en-us/4a6a46d7-b7d7-4bb5-a0dd-03ffa3cbc230).</span><span class="sxs-lookup"><span data-stu-id="853eb-208">For a complete example, see [InstanceContextSharing](http://msdn.microsoft.com/en-us/4a6a46d7-b7d7-4bb5-a0dd-03ffa3cbc230).</span></span>  
  
## <a name="sessions-and-streaming"></a><span data-ttu-id="853eb-209">Sessions et diffusion en continu</span><span class="sxs-lookup"><span data-stu-id="853eb-209">Sessions and Streaming</span></span>  
 <span data-ttu-id="853eb-210">Lorsque vous avez une grande quantité de données à transférer, le mode de transfert par diffusion en continu dans [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] est une alternative possible au comportement par défaut de mise en mémoire tampon et de traitement des messages en mémoire dans leur intégralité.</span><span class="sxs-lookup"><span data-stu-id="853eb-210">When you have a large amount of data to transfer, the streaming transfer mode in [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety.</span></span> <span data-ttu-id="853eb-211">Vous pouvez obtenir un comportement inattendu lors de la diffusion en continu des appels avec une liaison basée sur session.</span><span class="sxs-lookup"><span data-stu-id="853eb-211">You may get unexpected behavior when streaming calls with a session-based binding.</span></span> <span data-ttu-id="853eb-212">Tous les appels en streaming passent par un canal unique (le canal de datagramme) qui ne prend pas en charge les sessions même si la liaison utilisée est configurée pour utiliser des sessions.</span><span class="sxs-lookup"><span data-stu-id="853eb-212">All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions.</span></span> <span data-ttu-id="853eb-213">Si plusieurs clients effectuent des appels de diffusion en continu vers le même objet de service sur une liaison basée sur session, et si le mode d'accès concurrentiel de l'objet de service est configuré comme unique et son mode de contexte d'instance a la valeur `PerSession`, les appels généraux doivent traverser le canal de datagramme et un seul appel à la fois est traité.</span><span class="sxs-lookup"><span data-stu-id="853eb-213">If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time.</span></span> <span data-ttu-id="853eb-214">Un ou plusieurs clients peuvent ainsi être temporisés. Vous pouvez contourner ce problème en attribuant au `InstanceContextMode` de l'objet de service la valeur `PerCall` , ou au mode d'accès concurrentiel la valeur Multiple.</span><span class="sxs-lookup"><span data-stu-id="853eb-214">One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="853eb-215">MaxConcurrentSessions n'a aucun effet dans ce cas car une seule « session » est disponible.</span><span class="sxs-lookup"><span data-stu-id="853eb-215">MaxConcurrentSessions have no effect in this case because there is only one "session" available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="853eb-216">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="853eb-216">See Also</span></span>  
 <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A>  
 <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>
