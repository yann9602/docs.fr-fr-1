---
title: GET et PUT conditionnelle
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 3d22067f-57b8-4e0f-a571-a694512187ae
caps.latest.revision: "8"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 59a9f0638855206f390ee7fbace580ba37e25e23
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/02/2017
---
# <a name="conditional-get-and-put"></a><span data-ttu-id="017bd-102">GET et PUT conditionnelle</span><span class="sxs-lookup"><span data-stu-id="017bd-102">Conditional Get and Put</span></span>
<span data-ttu-id="017bd-103">Cet exemple montre comment utiliser les nouvelles API de récupération et mise à jour conditionnelles du modèle de programmation REST WCF.</span><span class="sxs-lookup"><span data-stu-id="017bd-103">This sample demonstrates how to use the new conditional retrieve and update APIs for the WCF REST programming model.</span></span> <span data-ttu-id="017bd-104">Étant donné que la récupération conditionnelle et mettre à jour les plus appropriées pour orientée ressources et services REST, cet exemple étend le [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) exemple.</span><span class="sxs-lookup"><span data-stu-id="017bd-104">Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="017bd-105">Cet exemple se concentre sur l’ajout de la prise en charge pour la récupération conditionnelle et de mise à jour la [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) exemple à l’aide des nouvelle API introduites dans [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="017bd-105">This sample focuses on adding support for conditional retrieve and update to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample using the new APIs introduced in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="017bd-106">Démonstrations</span><span class="sxs-lookup"><span data-stu-id="017bd-106">Demonstrates</span></span>  
 <span data-ttu-id="017bd-107">Récupération et mise à jour conditionnelles</span><span class="sxs-lookup"><span data-stu-id="017bd-107">Conditional Retrieve and Update</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="017bd-108">Discussion</span><span class="sxs-lookup"><span data-stu-id="017bd-108">Discussion</span></span>  
 <span data-ttu-id="017bd-109">Le service WCF de cet exemple expose une collection de clients d’une manière orientée ressources/REST.</span><span class="sxs-lookup"><span data-stu-id="017bd-109">The WCF service in this sample exposes a collection of customers in a resource-oriented and REST manner.</span></span> <span data-ttu-id="017bd-110">Pour obtenir une description détaillée de l’implémentation du service, consultez le [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) exemple.</span><span class="sxs-lookup"><span data-stu-id="017bd-110">For a detailed description of the service implementation, please see the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span>  
  
 <span data-ttu-id="017bd-111">Cet exemple ajoute récupération conditionnelle et des fonctionnalités de mise à jour pour le [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) exemple.</span><span class="sxs-lookup"><span data-stu-id="017bd-111">This sample adds conditional retrieve and update capabilities to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="017bd-112">La récupération et la mise à jour conditionnelles utilisent des étiquettes d’entité HTTP, ainsi que les en-têtes HTTP If-None-Match et If-Match pour vérifier si les clients disposent ou non de l’entité la plus récente pour une ressource donnée.</span><span class="sxs-lookup"><span data-stu-id="017bd-112">Conditional retrieve and update use HTTP entity tags and the HTTP If-None-Match and If-Match headers to validate that clients either have or do not have the most current entity for a given resource.</span></span> <span data-ttu-id="017bd-113">Toutefois, l'implémentation du code visant à analyser correctement les en-têtes HTTP If-None-Match et If-Match peut être fastidieuse et susceptible d'engendrer des erreurs.</span><span class="sxs-lookup"><span data-stu-id="017bd-113">However, implementing the code to correctly parse the HTTP If-None-Match and If-Match headers can be tedious and error-prone.</span></span> <span data-ttu-id="017bd-114">Par conséquent, les méthodes <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> et <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> ont été ajoutées au <xref:System.ServiceModel.Web.IncomingWebRequestContext>, accessible à l'aide de l'instance actuelle du <xref:System.ServiceModel.Web.WebOperationContext>.</span><span class="sxs-lookup"><span data-stu-id="017bd-114">Therefore, the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> and <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> methods have been added to the <xref:System.ServiceModel.Web.IncomingWebRequestContext>, which can be accessed using the current instance of the <xref:System.ServiceModel.Web.WebOperationContext>.</span></span> <span data-ttu-id="017bd-115">De plus, la méthode `SetETag` a été ajoutée au <xref:System.ServiceModel.Web.OutgoingWebRequestContext> afin de faciliter le retour de balises d'entité valides.</span><span class="sxs-lookup"><span data-stu-id="017bd-115">In addition, the `SetETag` method has been added to the <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, making it easier to return valid entity tags.</span></span>  
  
 <span data-ttu-id="017bd-116">La méthode <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> est conçue pour être utilisée avec des opérations [WebGet].</span><span class="sxs-lookup"><span data-stu-id="017bd-116">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method is intended to be used with [WebGet] operations.</span></span> <span data-ttu-id="017bd-117">Elle prend la balise d'entité actuelle de la ressource donnée comme paramètre `entityTag`, qui peut être de type `string`, `int`, `long` ou `Guid`.</span><span class="sxs-lookup"><span data-stu-id="017bd-117">It takes the current entity tag for the given resource as the `entityTag` parameter, which can be a `string`, `int`, `long` or `Guid`.</span></span> <span data-ttu-id="017bd-118">La méthode <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> vérifie la balise d'entité par rapport à l'en-tête HTTP If-None-Match de la requête.</span><span class="sxs-lookup"><span data-stu-id="017bd-118">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method checks the entity tag against the HTTP If-None-Match header of the request.</span></span> <span data-ttu-id="017bd-119">Si la balise d'entité est présente dans l'en-tête HTTP If-None-Match, une exception <xref:System.ServiceModel.Web.WebFaultException> est levée, accompagnée du code d'état Non modifié (304) ; sinon, la méthode est retournée.</span><span class="sxs-lookup"><span data-stu-id="017bd-119">If the entity tag is present in the HTTP If-None-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Not Modified (304) is thrown; otherwise the method returns.</span></span> <span data-ttu-id="017bd-120">Le mécanisme de récupération conditionnelle permet au client d'indiquer au serveur qu'il a cette entité et de n'envoyer l'entité actuelle que si le client ne l'a pas encore.</span><span class="sxs-lookup"><span data-stu-id="017bd-120">The conditional retrieve mechanism allows the client to tell the server that it has this entity and to only send the current entity if the client does not already have it.</span></span> <span data-ttu-id="017bd-121">Un exemple d'utilisation de la méthode <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> peut être vu dans les opérations `GetCustomer` et `GetCustomers` du service.</span><span class="sxs-lookup"><span data-stu-id="017bd-121">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method can be seen in the `GetCustomer` and `GetCustomers` operations of the service.</span></span> <span data-ttu-id="017bd-122">Il est important de noter que les appels à <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> peuvent ne pas être retournés.</span><span class="sxs-lookup"><span data-stu-id="017bd-122">It is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> may not return.</span></span> <span data-ttu-id="017bd-123">Les développeurs doivent implémenter l'opération de sorte que la réussite de la requête soit connue avant que l'appel à <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> ne soit exécuté, afin qu'en l'absence de l'appel à <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, le service envoie une réponse avec un code d'état de réussite.</span><span class="sxs-lookup"><span data-stu-id="017bd-123">Developers should implement the operation so that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> was not present, the service would send a response with a successful status code.</span></span>  
  
 <span data-ttu-id="017bd-124">La méthode <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> est similaire à la méthode <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>.</span><span class="sxs-lookup"><span data-stu-id="017bd-124">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method is similar to the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method.</span></span> <span data-ttu-id="017bd-125">Elle prend également l’étiquette d’entité actuelle de la ressource donnée.</span><span class="sxs-lookup"><span data-stu-id="017bd-125">It also takes the current entity tag for the given resource.</span></span> <span data-ttu-id="017bd-126">Toutefois, elle est destinée à être utilisé avec les opérations [WebInvoke] dans laquelle la méthode a la valeur « PUT » ou « DELETE ».</span><span class="sxs-lookup"><span data-stu-id="017bd-126">However, it is intended to be used with [WebInvoke] operations in which the method is set to "PUT" or "DELETE".</span></span> <span data-ttu-id="017bd-127">La méthode <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> vérifie la balise d'entité par rapport à l'en-tête HTTP If-Match de la requête.</span><span class="sxs-lookup"><span data-stu-id="017bd-127">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method checks the entity tag against the HTTP If-Match header of the request.</span></span> <span data-ttu-id="017bd-128">Si la balise d'entité n'est pas présente dans l'en-tête HTTP If-Match, une exception <xref:System.ServiceModel.Web.WebFaultException> est levée, accompagnée du code d'état Échec de la condition préalable (412).</span><span class="sxs-lookup"><span data-stu-id="017bd-128">If the entity tag is not present in the HTTP If-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Precondition Failed (412) is thrown.</span></span> <span data-ttu-id="017bd-129">Le mécanisme de mise à jour conditionnelle permet au client d'indiquer au serveur qu'il a cette entité pour la ressource et de n'autoriser le client à modifier la ressource que si l'entité dont il dispose est à jour.</span><span class="sxs-lookup"><span data-stu-id="017bd-129">The conditional update mechanism allows the client to tell the server that it has this entity for the resource and to only allow the client to alter the resource; if the entity it has is current.</span></span> <span data-ttu-id="017bd-130">Un exemple d'utilisation de la méthode <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> peut être vu dans les opérations `UpdateCustomer` et `DeleteCustomer` du service.</span><span class="sxs-lookup"><span data-stu-id="017bd-130">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method can be seen in the `UpdateCustomer` and `DeleteCustomer` operations of the service.</span></span> <span data-ttu-id="017bd-131">Tout comme pour <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, il est important de noter que les appels à <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> peuvent ne pas être retournés.</span><span class="sxs-lookup"><span data-stu-id="017bd-131">Just as with <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, it is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> may not return.</span></span> <span data-ttu-id="017bd-132">Les développeurs doivent implémenter l'opération de sorte que la réussite de la requête soit connue avant que l'appel à <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> ne soit exécuté, afin qu'en l'absence de l'appel à <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A>, le service réponde avec un code d'état de réussite.</span><span class="sxs-lookup"><span data-stu-id="017bd-132">Developers should implement the operation such that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> was not present, the service would respond with a successful status code.</span></span>  
  
 <span data-ttu-id="017bd-133">L'exemple est constitué d'un service auto-hébergé et d'un client qui s'exécute dans une application console.</span><span class="sxs-lookup"><span data-stu-id="017bd-133">The sample consists of a self-hosted service and a client that runs within a console application.</span></span> <span data-ttu-id="017bd-134">Lorsque l'application console s'exécute, le client adresse des requêtes au service et affiche les informations pertinentes des réponses dans la fenêtre de console.</span><span class="sxs-lookup"><span data-stu-id="017bd-134">As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="017bd-135">Pour exécuter l'exemple</span><span class="sxs-lookup"><span data-stu-id="017bd-135">To run the sample</span></span>  
  
1.  <span data-ttu-id="017bd-136">Ouvrez la solution de l'exemple Conditional Get and Put.</span><span class="sxs-lookup"><span data-stu-id="017bd-136">Open the solution for the Conditional Get and Put sample.</span></span> <span data-ttu-id="017bd-137">Pour que l'exemple fonctionne correctement, vous devez exécuter [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] en tant qu'administrateur.</span><span class="sxs-lookup"><span data-stu-id="017bd-137">When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator to execute the sample successfully.</span></span> <span data-ttu-id="017bd-138">Cela en double-cliquant sur le [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icône et en choisissant **exécuter en tant qu’administrateur** dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="017bd-138">Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu.</span></span>  
  
2.  <span data-ttu-id="017bd-139">Appuyez sur CTRL+MAJ+B pour générer la solution, puis appuyez sur CTRL+F5 pour exécuter le projet d'application de console.</span><span class="sxs-lookup"><span data-stu-id="017bd-139">Press CTRL+SHIFT+B to build the solution and then press CTRL+F5 to run the console application project.</span></span> <span data-ttu-id="017bd-140">Si vous exécutez ce projet avec le débogage activé (en ayant appuyé sur F5 au lieu de CTRL+F5), le débogueur s'arrête lorsqu'une exception est levée par la vérification GET et PUT conditionnelle.</span><span class="sxs-lookup"><span data-stu-id="017bd-140">If running this project with debugging enabled (by pressing F5 instead of CTRL+F5), the debugger stops when an exception is thrown by the conditional GET and PUT checking.</span></span> <span data-ttu-id="017bd-141">Dans ce cas, appuyez sur F5 pour reprendre l'exécution de l'exemple.</span><span class="sxs-lookup"><span data-stu-id="017bd-141">When this happens, press F5 to continue executing the sample.</span></span>  
  
3.  <span data-ttu-id="017bd-142">La fenêtre de console apparaît et fournit l'URI du service en cours d'exécution, ainsi que l'URI de sa page d'aide HTML.</span><span class="sxs-lookup"><span data-stu-id="017bd-142">The console window appear sand provides the URI of the running service and the URI of the HTML help page for the running service.</span></span>  
  
4.  <span data-ttu-id="017bd-143">Lorsque l'exemple s'exécute, le client envoie des requêtes au service et affiche les réponses dans la fenêtre de console.</span><span class="sxs-lookup"><span data-stu-id="017bd-143">As the sample runs, the client sends requests to the service and writes the responses to the console window.</span></span>  
  
5.  <span data-ttu-id="017bd-144">Appuyez sur une touche quelconque pour arrêter l'exemple.</span><span class="sxs-lookup"><span data-stu-id="017bd-144">Press any key to terminate the sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="017bd-145">Les exemples peuvent déjà être installés sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="017bd-145">The samples may already be installed on your machine.</span></span> <span data-ttu-id="017bd-146">Recherchez le répertoire (par défaut) suivant avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="017bd-146">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="017bd-147">Si ce répertoire n’existe pas, accédez à la page [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) pour télécharger tous les exemples [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] et [!INCLUDE[wf1](../../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="017bd-147">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="017bd-148">Cet exemple se trouve dans le répertoire suivant.</span><span class="sxs-lookup"><span data-stu-id="017bd-148">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Web\ConditionalGetAndPut`
