---
title: "Instructions de codage sécurisé pour le code non managé"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
caps.latest.revision: "13"
author: mairaw
ms.author: mairaw
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: adbdd005bba9e7276a77f2e78c53be43fdceffae
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/22/2017
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="bcd0c-102">Instructions de codage sécurisé pour le code non managé</span><span class="sxs-lookup"><span data-stu-id="bcd0c-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="bcd0c-103">Du code de bibliothèque doit appeler dans du code non managé (par exemple, des API de code natif comme Win32).</span><span class="sxs-lookup"><span data-stu-id="bcd0c-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="bcd0c-104">Comme cela signifie sortir du périmètre de sécurité pour le code managé, la prudence est de règle.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="bcd0c-105">S’il ne dépend pas de la sécurité, votre code, ainsi que tout code qui l’appelle, doit disposer de l’autorisation de code non managé (<xref:System.Security.Permissions.SecurityPermission> avec l’indicateur <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> spécifié).</span><span class="sxs-lookup"><span data-stu-id="bcd0c-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="bcd0c-106">Cependant, il est souvent préférable que votre appelant ne possède pas des autorisations aussi puissantes.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="bcd0c-107">Dans ces cas-là, votre code fiable peut servir d'intermédiaire, de la même manière que le wrapper managé ou le code de bibliothèque décrit dans [Sécurisation du code wrapper](../../../docs/framework/misc/securing-wrapper-code.md).</span><span class="sxs-lookup"><span data-stu-id="bcd0c-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../../../docs/framework/misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="bcd0c-108">Si les fonctionnalités de code non managé sous-jacentes sont totalement sécurisées, elles risquent d'être exposées directement ; si cela n'est pas le cas, une vérification d'autorisation appropriée (demande) est nécessaire dans un premier temps.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="bcd0c-109">Quand votre code appelle dans du code non managé mais que vous ne souhaitez pas que vos appelants soient obligés d'avoir l'autorisation d'accéder à du code non managé, vous devez déclarer ce droit.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="bcd0c-110">Une assertion bloque le parcours de la pile à votre frame.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="bcd0c-111">Vous devez faire attention à ne pas créer de faille de sécurité pendant ce processus.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="bcd0c-112">Habituellement, cela signifie que vous devez exiger une autorisation appropriée de vos appelants, puis vous servir du code non managé pour effectuer uniquement ce que cette autorisation permet et rien de plus.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="bcd0c-113">Dans certains cas (par exemple, une fonction récupérant l'heure du jour), du code non managé peut être directement exposé aux appelants sans vérification de la sécurité.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="bcd0c-114">Dans tous les cas, tout code qui déclare doit être responsable de la sécurité.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="bcd0c-115">Comme tout code managé qui fournit un chemin de code dans le code natif est une cible potentielle pour du code nuisible, déterminer le type de code non managé qui peut s'utiliser sans risque et la manière de l'utiliser nécessite beaucoup de précautions.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="bcd0c-116">Généralement, il ne faut jamais exposer du code non managé directement à des appelants d'un niveau de confiance partiel.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="bcd0c-117">Deux considérations principales gouvernent l'évaluation de la sécurité de l'utilisation de code non managé dans des bibliothèques pouvant être appelées par du code d'un niveau de confiance partiel :</span><span class="sxs-lookup"><span data-stu-id="bcd0c-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
-   <span data-ttu-id="bcd0c-118">**Fonctionnalité**.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-118">**Functionality**.</span></span> <span data-ttu-id="bcd0c-119">Est-ce que l'API non managée fournit des fonctionnalités qui ne permettent pas aux appelants d'effectuer des opérations potentiellement risquées ?</span><span class="sxs-lookup"><span data-stu-id="bcd0c-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="bcd0c-120">Comme la sécurité d'accès du code utilise des autorisations pour faire appliquer l'accès aux ressources, vous devez envisager si l'API utilise des fichiers, une interface utilisateur ou des technologies de threads ou si elle expose des informations protégées.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="bcd0c-121">Si tel est le cas, le code managé qui l'englobe doit exiger les autorisations nécessaires avant d'autoriser son entrée.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="bcd0c-122">De plus, même s'il ne fait pas l'objet d'une protection par autorisation, l'accès à la mémoire doit se limiter à la sécurité stricte des types.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
-   <span data-ttu-id="bcd0c-123">**Vérification des paramètres**.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-123">**Parameter checking**.</span></span> <span data-ttu-id="bcd0c-124">Une attaque courante passe des paramètres inattendus à des méthodes API de code non managé exposées dans le but de les faire fonctionner hors spécification.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="bcd0c-125">Le dépassement de mémoire tampon utilisant des index non valides ou des valeurs offset constitue un exemple courant de ce type d'attaque, comme tous les paramètres qui risquent d'exploiter un bogue dans le code sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="bcd0c-126">Ainsi, même si l'API du code non managé est sécurisée du point de vue fonctionnel (après des demandes nécessaires) pour des appelants d'un niveau de confiance partiel, le code managé doit également vérifier la validité des paramètres de manière exhaustive pour garantir qu'aucun appel involontaire n'est possible par du code nuisible utilisant la couche wrapper du code managé.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="bcd0c-127">Utilisation de SuppressUnmanagedCodeSecurityAttribute</span><span class="sxs-lookup"><span data-stu-id="bcd0c-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="bcd0c-128">Il existe un aspect performance lié à la déclaration, puis à l'appel de code non managé.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="bcd0c-129">Pour chaque appel de ce type, le système de sécurité exige automatiquement l'autorisation du code non managé, ce qui entraîne à chaque fois un parcours de pile.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="bcd0c-130">Si vous déclarez et appelez immédiatement du code non managé, le parcours de pile peut s'avérer inutile : il comporte votre déclaration et votre appel de code non managé.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="bcd0c-131">Un attribut personnalisé nommé <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> peut être appliqué à des points d’entrée du code non managé pour désactiver la vérification de sécurité normale qui exige <xref:System.Security.Permissions.SecurityPermission> avec l’autorisation <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> spécifiée.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="bcd0c-132">Vous devez effectuer ces opérations en observant systématiquement la plus grande précaution, car cette action crée une porte ouverte dans du code non managé sans vérification de sécurité au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="bcd0c-133">Notez que même si **SuppressUnmanagedCodeSecurityAttribute** est appliqué, une vérification de sécurité unique a lieu au moment de la compilation juste-à-temps (JIT, Just-In-Time) pour garantir que l'appelant immédiat possède l'autorisation d'appeler du code non managé.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="bcd0c-134">Si vous utilisez **SuppressUnmanagedCodeSecurityAttribute**, vérifiez les points suivants :</span><span class="sxs-lookup"><span data-stu-id="bcd0c-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
-   <span data-ttu-id="bcd0c-135">Faites en sorte que le point d'entrée du code non managé soit interne ou, si cela n'est pas possible, qu'il soit inaccessible hors de votre code.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
-   <span data-ttu-id="bcd0c-136">Tout appel dans du code non managé représente une faille de sécurité potentielle.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="bcd0c-137">Veillez à ce que votre code ne soit pas une porte ouverte à un appel indirect par du code nuisible dans du code non managé évitant ainsi une vérification de sécurité.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="bcd0c-138">Exigez des autorisations, si cela est approprié.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-138">Demand permissions, if appropriate.</span></span>  
  
-   <span data-ttu-id="bcd0c-139">Utilisez une convention d'affectation de noms pour identifier de manière explicite les cas où vous créez un chemin à risque dans du code non managé, comme indiqué dans la section ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="bcd0c-140">Convention d'affectation de noms pour les méthodes de code non managé</span><span class="sxs-lookup"><span data-stu-id="bcd0c-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="bcd0c-141">Une convention utile et fortement recommandée a été créée pour nommer des méthodes de code non managé.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="bcd0c-142">Toutes les méthodes de code non managé sont divisées en trois catégories : **safe**, **native**et **unsafe**.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="bcd0c-143">Ces mots clés peuvent être utilisés comme noms de classe dans lesquels les différents types de points d'entrée du code non managé sont définis.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="bcd0c-144">Dans le code source, ces mots clés doivent être ajoutés au nom de la classe, comme pour `Safe.GetTimeOfDay`, `Native.Xyz`ou `Unsafe.DangerousAPI`, par exemple.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="bcd0c-145">Chacun de ces mots clés fournit les informations de sécurité nécessaires aux développeurs utilisant cette classe, comme le montre le tableau suivant :</span><span class="sxs-lookup"><span data-stu-id="bcd0c-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="bcd0c-146">Mot clé</span><span class="sxs-lookup"><span data-stu-id="bcd0c-146">Keyword</span></span>|<span data-ttu-id="bcd0c-147">Considérations relatives à la sécurité</span><span class="sxs-lookup"><span data-stu-id="bcd0c-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|<span data-ttu-id="bcd0c-148">**safe**</span><span class="sxs-lookup"><span data-stu-id="bcd0c-148">**safe**</span></span>|<span data-ttu-id="bcd0c-149">Ne présente aucun danger pour un appel par n'importe quel code, même du code nuisible.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="bcd0c-150">Peut s'utiliser comme n'importe quel autre code managé.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-150">Can be used just like other managed code.</span></span> <span data-ttu-id="bcd0c-151">Par exemple, une fonction qui récupère l'heure du jour est en général sécurisée.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|<span data-ttu-id="bcd0c-152">**native**</span><span class="sxs-lookup"><span data-stu-id="bcd0c-152">**native**</span></span>|<span data-ttu-id="bcd0c-153">Indépendant de la sécurité ; c'est-à-dire du code non managé qui nécessite l'autorisation du code non managé pour appeler.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="bcd0c-154">La sécurité est vérifiée, ce qui bloque un appelant non autorisé.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|<span data-ttu-id="bcd0c-155">**unsafe**</span><span class="sxs-lookup"><span data-stu-id="bcd0c-155">**unsafe**</span></span>|<span data-ttu-id="bcd0c-156">Point d'entrée dans du code non managé potentiellement dangereux et sans sécurité.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="bcd0c-157">Les développeurs doivent faire preuve d'une grande prudence quand ils utilisent ce code non managé en veillant à ce que les autres protections soient en place afin d'éviter une faille en matière de sécurité.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="bcd0c-158">Les développeurs doivent se montrer responsables, car ce mot clé substitue le système de sécurité.</span><span class="sxs-lookup"><span data-stu-id="bcd0c-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="bcd0c-159">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="bcd0c-159">See Also</span></span>  
 [<span data-ttu-id="bcd0c-160">Instructions de codage sécurisé</span><span class="sxs-lookup"><span data-stu-id="bcd0c-160">Secure Coding Guidelines</span></span>](../../../docs/standard/security/secure-coding-guidelines.md)
