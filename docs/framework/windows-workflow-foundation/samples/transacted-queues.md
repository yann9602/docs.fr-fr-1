---
title: Files d'attente avec transaction
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b1b011dd-5e0b-482c-9bb0-9d8727038f14
caps.latest.revision: "9"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 11d1d0d3481fb575abd01894db631e24c50b6d56
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/02/2017
---
# <a name="transacted-queues"></a><span data-ttu-id="28a86-102">Files d'attente avec transaction</span><span class="sxs-lookup"><span data-stu-id="28a86-102">Transacted Queues</span></span>
<span data-ttu-id="28a86-103">Cet exemple montre comment intégrer des files d'attente et des transactions dans [!INCLUDE[wf](../../../../includes/wf-md.md)] pour créer des services fiables et évolutifs.</span><span class="sxs-lookup"><span data-stu-id="28a86-103">This sample shows how to integrate queues and transactions in [!INCLUDE[wf](../../../../includes/wf-md.md)] to create reliable and scalable services.</span></span> <span data-ttu-id="28a86-104">A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` est utilisé dans le workflow client pour envoyer un message à une file d’attente sous une transaction à l’aide du <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="28a86-104">A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` is used in the client workflow to send message to a queue under a transaction using the <xref:System.ServiceModel.NetMsmqBinding>.</span></span> <span data-ttu-id="28a86-105">Un <xref:System.ServiceModel.Activities.TransactedReceiveScope> est utilisé sur le serveur pour recevoir des messages de la file d'attente et mettre à jour l'état du workflow sous la même transaction.</span><span class="sxs-lookup"><span data-stu-id="28a86-105">A <xref:System.ServiceModel.Activities.TransactedReceiveScope> is used on the server to receive messages from the queue and update the state of the workflow under the same transaction.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="28a86-106">Démonstrations</span><span class="sxs-lookup"><span data-stu-id="28a86-106">Demonstrates</span></span>  
 <span data-ttu-id="28a86-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive> et corrélation basée sur le contenu.</span><span class="sxs-lookup"><span data-stu-id="28a86-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive>, and content-based correlation.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="28a86-108">Discussion</span><span class="sxs-lookup"><span data-stu-id="28a86-108">Discussion</span></span>  
 <span data-ttu-id="28a86-109">Pour illustrer les fonctionnalités couvertes dans cet exemple, un service de workflow `RewardsPoints` est créé, qui assure le suivi des points gagnés et utilisés pour un compte donné.</span><span class="sxs-lookup"><span data-stu-id="28a86-109">To demonstrate the features covered in this sample, a `RewardsPoints` workflow service is created, which keeps track of the points earned and used for a given account.</span></span> <span data-ttu-id="28a86-110">Le client utilise <xref:System.Activities.WorkflowInvoker> pour simuler la publication de différentes demandes dans la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="28a86-110">The client uses <xref:System.Activities.WorkflowInvoker> to simulate posting various requests to the queue.</span></span> <span data-ttu-id="28a86-111">Pour publier un message dans la file d'attente sous une transaction, l'activité <xref:System.ServiceModel.Activities.Send> peut être placée à l'intérieur du <xref:System.Activities.Statements.TransactionScope.Body%2A> d'un <xref:System.Activities.Statements.TransactionScope>.</span><span class="sxs-lookup"><span data-stu-id="28a86-111">To post a message to the queue under a transaction, the <xref:System.ServiceModel.Activities.Send> activity can be placed inside the <xref:System.Activities.Statements.TransactionScope.Body%2A> of a <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="28a86-112">Dans cet exemple, le client s'exécute en premier, suivi par le serveur, pour montrer comment les messages en file d'attente peuvent découpler les applications serveur et cliente.</span><span class="sxs-lookup"><span data-stu-id="28a86-112">In this sample, the client runs first, followed by the server, to demonstrate how queued messages can decouple the client and server applications.</span></span>  
  
 <span data-ttu-id="28a86-113">Une fois que le client est terminé, le service est configuré et hébergé.</span><span class="sxs-lookup"><span data-stu-id="28a86-113">Once the client completes, the service is configured and hosted.</span></span> <span data-ttu-id="28a86-114">Dès qu'il s'ouvre, il démarre le traitement des messages qui ont déjà été placés dans la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="28a86-114">As soon as it opens, it starts processing the messages that have already been placed in the queue.</span></span> <span data-ttu-id="28a86-115">Chaque message est reçu et traité sous la même transaction de serveur.</span><span class="sxs-lookup"><span data-stu-id="28a86-115">Each message is received and processed under the same server transaction.</span></span> <span data-ttu-id="28a86-116">Dans cet exemple, le premier message reçu est une demande `CreateAccount` qui crée l'instance et initialise la corrélation de contenu selon le nom du compte passé dans le cadre du message de demande.</span><span class="sxs-lookup"><span data-stu-id="28a86-116">In this sample, the first message received is a `CreateAccount` request that creates the instance and initializes the content correlation based on the account name passed as part of the request message.</span></span> <span data-ttu-id="28a86-117">Pour modéliser le type de service que vous pouvez attendre dans le monde réel, les deux activités <xref:System.ServiceModel.Activities.TransactedReceiveScope> suivantes qui traitent les messages `AddPoints` et `UsePoints` sont placées dans des branches parallèles dans une boucle `while` afin qu'elles puissent traiter à plusieurs reprises ces messages dans n'importe quel ordre.</span><span class="sxs-lookup"><span data-stu-id="28a86-117">To model the kind of service you might expect in the real world, the following two <xref:System.ServiceModel.Activities.TransactedReceiveScope> activities that process the `AddPoints` and `UsePoints` messages are placed in parallel branches within a `while` loop so that they can process these messages repeatedly in any order.</span></span>  
  
 <span data-ttu-id="28a86-118"><xref:System.Activities.Statements.TransactionScope> et <xref:System.ServiceModel.Activities.TransactedReceiveScope> ayant chacun un point de persistance implicite à la fin de leurs portées, l'utilisation de ces activités dans [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combinée avec les files d'attente est une façon fiable de déplacer votre workflow d'un état cohérent vers le suivant, tout en s'assurant que les messages ne sont jamais perdus.</span><span class="sxs-lookup"><span data-stu-id="28a86-118"><xref:System.Activities.Statements.TransactionScope> and <xref:System.ServiceModel.Activities.TransactedReceiveScope> each have an implicit persistence point at the end of their scopes, so using these activities in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combined with queues is a reliable way to move your workflow from one consistent state to the next, while ensuring that messages are never lost.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="28a86-119">Pour configurer, générer et exécuter l'exemple</span><span class="sxs-lookup"><span data-stu-id="28a86-119">To set up, build, and run the sample</span></span>  
  
1.  <span data-ttu-id="28a86-120">Installez et configurez MSMQ.</span><span class="sxs-lookup"><span data-stu-id="28a86-120">Install and configure MSMQ.</span></span> <span data-ttu-id="28a86-121">Consultez [l’installation de Message Queuing](http://go.microsoft.com/fwlink/?LinkId=178526) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="28a86-121">See [Installing Message Queuing](http://go.microsoft.com/fwlink/?LinkId=178526) for details.</span></span>  
  
2.  <span data-ttu-id="28a86-122">Vérifiez que MSDTC fonctionne en exécutant la commande suivante sur une ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="28a86-122">Ensure that MSDTC is running by executing the following command on a command line.</span></span> `net start msdtc`  
  
3.  <span data-ttu-id="28a86-123">Compilez le projet et ouvrez le fichier exécutable ou ouvrez le projet dans [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] et sélectionnez une option de démarrage dans le menu de débogage.</span><span class="sxs-lookup"><span data-stu-id="28a86-123">Compile the project and open the executable, or open the project in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and select a start option from the debug menu.</span></span> <span data-ttu-id="28a86-124">En premier lieu, la file d'attente est créée, puis le client est exécuté et publie des messages dans la file d'attente et, enfin, le service démarre et les messages sont traités.</span><span class="sxs-lookup"><span data-stu-id="28a86-124">First, the queue is created, then the client runs and posts messages to the queue, and finally the service starts and the messages are processed.</span></span> <span data-ttu-id="28a86-125">Pour quitter le programme, appuyez sur ENTRÉE.</span><span class="sxs-lookup"><span data-stu-id="28a86-125">To exit the program, press ENTER.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="28a86-126">Les exemples peuvent déjà être installés sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="28a86-126">The samples may already be installed on your machine.</span></span> <span data-ttu-id="28a86-127">Recherchez le répertoire (par défaut) suivant avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="28a86-127">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="28a86-128">Si ce répertoire n’existe pas, accédez à la page [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) pour télécharger tous les exemples [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] et [!INCLUDE[wf1](../../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="28a86-128">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="28a86-129">Cet exemple se trouve dans le répertoire suivant.</span><span class="sxs-lookup"><span data-stu-id="28a86-129">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Transactions\TransactedQueues`
