---
title: "Procédure : créer un participant de persistance personnalisé"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1d9cc47a-8966-4286-94d5-4221403d9c06
caps.latest.revision: "6"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 4c690a0233a425a706ead7441447f589d8330bc0
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/18/2017
---
# <a name="how-to-create-a-custom-persistence-participant"></a><span data-ttu-id="396db-102">Procédure : créer un participant de persistance personnalisé</span><span class="sxs-lookup"><span data-stu-id="396db-102">How to: Create a Custom Persistence Participant</span></span>
<span data-ttu-id="396db-103">La procédure suivante permet de créer un participant de persistance.</span><span class="sxs-lookup"><span data-stu-id="396db-103">The following procedure has steps to create a persistence participant.</span></span> <span data-ttu-id="396db-104">Consultez le [participant de persistance](http://go.microsoft.com/fwlink/?LinkID=177735) exemple et [extensibilité de magasin](../../../docs/framework/windows-workflow-foundation/store-extensibility.md) rubrique pour des exemples d’implémentation de participants de persistance.</span><span class="sxs-lookup"><span data-stu-id="396db-104">See the [Participating in Persistence](http://go.microsoft.com/fwlink/?LinkID=177735) sample and [Store Extensibility](../../../docs/framework/windows-workflow-foundation/store-extensibility.md) topic for sample implementations of persistence participants.</span></span>  
  
1.  <span data-ttu-id="396db-105">Créez une classe dérivant des classes <xref:System.Activities.Persistence.PersistenceParticipant> ou <xref:System.Activities.Persistence.PersistenceIOParticipant>.</span><span class="sxs-lookup"><span data-stu-id="396db-105">Create a class deriving from the <xref:System.Activities.Persistence.PersistenceParticipant> or the <xref:System.Activities.Persistence.PersistenceIOParticipant> class.</span></span> <span data-ttu-id="396db-106">En plus de pouvoir participer aux opérations IO, la classe PersistenceIOParticipant offre les mêmes points d'extensibilité que la classe PersistenceParticipant.</span><span class="sxs-lookup"><span data-stu-id="396db-106">The PersistenceIOParticipant class offers the same extensibility points as the PersistenceParticipant class in addition to being able to participate in IO operations.</span></span> <span data-ttu-id="396db-107">Effectuez l'une ou l'ensemble des étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="396db-107">Follow one or more of the following steps.</span></span>  
  
2.  <span data-ttu-id="396db-108">Implémentez la méthode <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A>.</span><span class="sxs-lookup"><span data-stu-id="396db-108">Implement the <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> method.</span></span> <span data-ttu-id="396db-109">Le **CollectValues** méthode possède deux paramètres de dictionnaire, pour le stockage des valeurs en lecture/écriture et l’autre pour stocker des valeurs en écriture seule (utilisés ultérieurement dans les requêtes).</span><span class="sxs-lookup"><span data-stu-id="396db-109">The **CollectValues** method has two dictionary parameters, one for storing read/write values and the other one for storing write-only values (used later in queries).</span></span> <span data-ttu-id="396db-110">Dans cette méthode, vous devez remplir ces dictionnaires avec les données propres à un participant de persistance.</span><span class="sxs-lookup"><span data-stu-id="396db-110">In this method, you should populate these dictionaries with data that is specific to a persistence participant.</span></span> <span data-ttu-id="396db-111">Chaque dictionnaire contient le nom de la valeur comme clé et la valeur elle-même comme un objet <xref:System.Runtime.DurableInstancing.InstanceValue>.</span><span class="sxs-lookup"><span data-stu-id="396db-111">Each dictionary contains the name of the value as the key and the value itself as an <xref:System.Runtime.DurableInstancing.InstanceValue> object.</span></span>  
  
     <span data-ttu-id="396db-112">Les valeurs du dictionnaire readWriteValues sont fournies en tant que **InstanceValue** objets.</span><span class="sxs-lookup"><span data-stu-id="396db-112">The values in the readWriteValues dictionary are packaged as **InstanceValue** objects.</span></span> <span data-ttu-id="396db-113">Les valeurs dans le dictionnaire en écriture seule sont empaquetés en tant que **InstanceValue** objets avec les valeurs InstanceValueOptions.Optional et InstanceValueOption.WriteOnly définies.</span><span class="sxs-lookup"><span data-stu-id="396db-113">The values in the write-only dictionary are packaged as **InstanceValue** objects with InstanceValueOptions.Optional and InstanceValueOption.WriteOnly set.</span></span> <span data-ttu-id="396db-114">Chaque **InstanceValue** fournie par le **CollectValues** implémentations dans tous les participants de persistance doivent avoir un nom unique.</span><span class="sxs-lookup"><span data-stu-id="396db-114">Each **InstanceValue** provided by the **CollectValues** implementations across all persistence participants must have a unique name.</span></span>  
  
    ```  
    protected virtual void CollectValues (out IDictionary<XName,Object> readWriteValues, out IDictionary<XName,Object> writeOnlyValues)  
    ```  
  
3.  <span data-ttu-id="396db-115">Implémentez la méthode <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A>.</span><span class="sxs-lookup"><span data-stu-id="396db-115">Implement the <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method.</span></span> <span data-ttu-id="396db-116">Le **MapValues** méthode accepte deux paramètres qui sont similaires aux paramètres qui le **CollectValues** méthode reçoit.</span><span class="sxs-lookup"><span data-stu-id="396db-116">The **MapValues** method takes two parameters that are similar to the parameters that the **CollectValues** method receives.</span></span> <span data-ttu-id="396db-117">Toutes les valeurs collectées dans le **CollectValues** étape sont transmises à ces paramètres de dictionnaire.</span><span class="sxs-lookup"><span data-stu-id="396db-117">All the values collected in the **CollectValues** stage are passed through these dictionary parameters.</span></span> <span data-ttu-id="396db-118">Les nouvelles valeurs ajoutées par le **MapValues** étape sont ajoutées aux valeurs en écriture seule.</span><span class="sxs-lookup"><span data-stu-id="396db-118">The new values added by the **MapValues** stage are added to the write-only values.</span></span>  <span data-ttu-id="396db-119">Le dictionnaire en écriture seule est utilisé pour fournir des données à une source externe qui n'est pas directement associée aux valeurs d'instance.</span><span class="sxs-lookup"><span data-stu-id="396db-119">The write-only dictionary is used to provide data to an external source not directly associated with the instance values.</span></span> <span data-ttu-id="396db-120">Chaque valeur fournie par les implémentations de la **MapValues** méthode tous les participants de persistance doit avoir un nom unique.</span><span class="sxs-lookup"><span data-stu-id="396db-120">Each value provided by implementations of the **MapValues** method across all persistence participants must have a unique name.</span></span>  
  
    ```  
    protected virtual IDictionary<XName,Object> MapValues (IDictionary<XName,Object> readWriteValues,IDictionary<XName,Object> writeOnlyValues)  
    ```  
  
     <span data-ttu-id="396db-121">La méthode <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> fournit des fonctionnalités non fournies par la méthode <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A>, car elle permet une dépendance sur une autre valeur fournie par un autre participant de persistance qui n'a pas encore été traité par <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A>.</span><span class="sxs-lookup"><span data-stu-id="396db-121">The <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method provides functionality that <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> does not, in that it allows for a dependency on another value provided by another persistence participant that hasn’t been processed by <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> yet.</span></span>  
  
4.  <span data-ttu-id="396db-122">Implémentez la **PublishValues** (méthode).</span><span class="sxs-lookup"><span data-stu-id="396db-122">Implement the **PublishValues** method.</span></span> <span data-ttu-id="396db-123">Le **PublishValues** méthode reçoit un dictionnaire contenant toutes les valeurs chargées à partir du magasin de persistance.</span><span class="sxs-lookup"><span data-stu-id="396db-123">The **PublishValues** method receives a dictionary containing all the values loaded from the persistence store.</span></span>  
  
    ```  
    protected virtual void PublishValues (IDictionary<XName,Object> readWriteValues)  
    ```  
  
5.  <span data-ttu-id="396db-124">Implémentez la **BeginOnSave** méthode si le participant est un participant d’e/s de persistance.</span><span class="sxs-lookup"><span data-stu-id="396db-124">Implement the **BeginOnSave** method if the participant is a persistence IO participant.</span></span> <span data-ttu-id="396db-125">Cette méthode est appelée lors d'une opération d'enregistrement.</span><span class="sxs-lookup"><span data-stu-id="396db-125">This method is called during a Save operation.</span></span> <span data-ttu-id="396db-126">Dans cette méthode, vous devez effectuer l'adjonction IO à la persistance (l'enregistrement) des instances de workflow.</span><span class="sxs-lookup"><span data-stu-id="396db-126">In this method, you should perform IO adjunct to the persisting (saving) workflow instances.</span></span>  <span data-ttu-id="396db-127">Si l'hôte utilise une transaction pour la commande de persistance correspondante, la même transaction est fournie dans Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="396db-127">If the host is using a transaction for the corresponding persistence command, the same transaction is provided in Transaction.Current.</span></span>  <span data-ttu-id="396db-128">En outre, les PersistenceIOParticipants peuvent rendre publique une spécification de cohérence transactionnelle. Dans ce cas, l’hôte crée une transaction pour l’épisode de persistance si aucune transaction ne serait utilisée sinon.</span><span class="sxs-lookup"><span data-stu-id="396db-128">Additionally, PersistenceIOParticipants may advertise a transactional consistency requirement, in which case the host creates a transaction for the persistence episode if one would not otherwise be used.</span></span>  
  
    ```  
    protected virtual IAsyncResult BeginOnSave (IDictionary<XName,Object> readWriteValues, IDictionary<XName,Object> writeOnlyValues, TimeSpan timeout, AsyncCallback callback, Object state)  
    ```  
  
6.  <span data-ttu-id="396db-129">Implémentez la **BeginOnLoad** méthode si le participant est un participant d’e/s de persistance.</span><span class="sxs-lookup"><span data-stu-id="396db-129">Implement the **BeginOnLoad** method if the participant is a persistence IO participant.</span></span> <span data-ttu-id="396db-130">Cette méthode est appelée lors d'une opération de chargement.</span><span class="sxs-lookup"><span data-stu-id="396db-130">This method is called during a Load operation.</span></span> <span data-ttu-id="396db-131">Dans cette méthode, vous devez effectuer l'adjonction IO au chargement d'instances de workflow.</span><span class="sxs-lookup"><span data-stu-id="396db-131">In this method, you should perform IO adjunct to the loading of workflow instances.</span></span> <span data-ttu-id="396db-132">Si l'hôte utilise une transaction pour la commande de persistance correspondante, la même transaction est fournie dans Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="396db-132">If the host is using a transaction for the corresponding persistence command, the same transaction is provided in Transaction.Current.</span></span> <span data-ttu-id="396db-133">En outre, les participants IO de persistance peuvent rendre publique une spécification de cohérence transactionnelle. Dans ce cas, l'hôte crée une transaction pour l'épisode de persistance si aucune transaction ne serait utilisée sinon.</span><span class="sxs-lookup"><span data-stu-id="396db-133">Additionally, Persistence IO participants may advertise a transactional consistency requirement, in which case the host creates a transaction for the persistence episode if one would not otherwise be used.</span></span>  
  
    ```  
    protected virtual IAsyncResult BeginOnLoad (IDictionary<XName,Object> readWriteValues, TimeSpan timeout, AsyncCallback callback, Object state)  
    ```
