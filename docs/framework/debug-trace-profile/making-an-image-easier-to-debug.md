---
title: "Simplification du débogage d'une image"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- images [.NET Framework], debugging
- executable image for debugging
- debugging [.NET Framework], executable images for
ms.assetid: 7d90ea7a-150f-4f97-98a7-f9c26541b9a3
caps.latest.revision: "13"
author: mairaw
ms.author: mairaw
manager: wpickett
ms.openlocfilehash: 46a9c11f3545e5d2b9f91572a87ee2614810e4d0
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2017
---
# <a name="making-an-image-easier-to-debug"></a><span data-ttu-id="c2b83-102">Simplification du débogage d'une image</span><span class="sxs-lookup"><span data-stu-id="c2b83-102">Making an Image Easier to Debug</span></span>
<span data-ttu-id="c2b83-103">Lors de la compilation de code non managé, vous pouvez configurer une image exécutable pour le débogage en définissant des commutateurs ou des options de ligne de commande de l’IDE.</span><span class="sxs-lookup"><span data-stu-id="c2b83-103">When compiling unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="c2b83-104">Par exemple, vous pouvez utiliser l’option de ligne de commande /**Zi** dans Visual C++ pour lui demander de produire des fichiers de symboles de débogage (extension de fichier .pdb).</span><span class="sxs-lookup"><span data-stu-id="c2b83-104">For example, you can use the /**Zi** command-line option in Visual C++ to ask it to emit debug symbol files (file extension .pdb).</span></span> <span data-ttu-id="c2b83-105">De même, l’option de ligne de commande /**Od** indique au compilateur de désactiver l’optimisation.</span><span class="sxs-lookup"><span data-stu-id="c2b83-105">Similarly, the /**Od** command-line option tells the compiler to disable optimization.</span></span> <span data-ttu-id="c2b83-106">Le code résultant s’exécute plus lentement, mais il est plus facile à déboguer quand c’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="c2b83-106">The resulting code runs more slowly, but is easier to debug, should this be necessary.</span></span>  
  
 <span data-ttu-id="c2b83-107">Lors de la compilation de code managé .NET Framework, des compilateurs comme Visual C++, Visual Basic et C# compilent leur programme source en langage MSIL (Microsoft Intermediate Language).</span><span class="sxs-lookup"><span data-stu-id="c2b83-107">When compiling .NET Framework managed code, compilers such as Visual C++, Visual Basic, and C# compile their source program into Microsoft Intermediate Language (MSIL).</span></span> <span data-ttu-id="c2b83-108">MSIL est ensuite compilé selon le mode JIT, juste avant l’exécution, en code machine natif.</span><span class="sxs-lookup"><span data-stu-id="c2b83-108">MSIL is subsequently JIT-compiled, just before execution, into native machine code.</span></span> <span data-ttu-id="c2b83-109">Comme avec le code non managé, vous pouvez configurer une image exécutable pour le débogage en définissant des commutateurs ou des options de ligne de commande de l’IDE.</span><span class="sxs-lookup"><span data-stu-id="c2b83-109">As with unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="c2b83-110">De plus, vous pouvez configurer la compilation JIT pour le débogage presque de la même façon.</span><span class="sxs-lookup"><span data-stu-id="c2b83-110">In addition, you can configure the JIT compilation for debugging in much the same way.</span></span>  
  
 <span data-ttu-id="c2b83-111">Cette configuration JIT a deux aspects :</span><span class="sxs-lookup"><span data-stu-id="c2b83-111">This JIT configuration has two aspects:</span></span>  
  
-   <span data-ttu-id="c2b83-112">Vous pouvez demander au compilateur JIT de générer des informations de suivi.</span><span class="sxs-lookup"><span data-stu-id="c2b83-112">You can request the JIT-compiler to generate tracking information.</span></span> <span data-ttu-id="c2b83-113">Ceci permet au débogueur de faire correspondre une chaîne d’instructions MSIL à son équivalent en code machine, et d’effectuer le suivi des emplacements de stockage des variables locales et des arguments de fonction.</span><span class="sxs-lookup"><span data-stu-id="c2b83-113">This makes it possible for the debugger to match up a chain of MSIL with its machine code counterpart, and to track where local variables and function arguments are stored.</span></span>  <span data-ttu-id="c2b83-114">Dans le .NET Framework version 2.0, le compilateur JIT génère toujours des informations de suivi : il est donc inutile de les demander.</span><span class="sxs-lookup"><span data-stu-id="c2b83-114">In the .NET Framework version 2.0, the JIT compiler will always generate tracking information, so there is no need to request it.</span></span>  
  
-   <span data-ttu-id="c2b83-115">Vous pouvez demander au compilateur JIT de ne pas optimiser le code machine résultant.</span><span class="sxs-lookup"><span data-stu-id="c2b83-115">You can request the JIT-compiler to not optimize the resulting machine code.</span></span>  
  
 <span data-ttu-id="c2b83-116">Normalement, le compilateur qui génère le code MSIL définit ces options du compilateur JIT de façon appropriée, en fonction des commutateurs ou des options de ligne de commande de l’IDE que vous spécifiez, par exemple /**Od**.</span><span class="sxs-lookup"><span data-stu-id="c2b83-116">Normally, the compiler that generates the MSIL sets these JIT-compiler options appropriately, based upon the IDE switches or command-line options you specify, for example, /**Od**.</span></span>  
  
 <span data-ttu-id="c2b83-117">Dans certains cas, vous pouvez changer le comportement du compilateur JIT afin que le code machine généré soit plus facile à déboguer.</span><span class="sxs-lookup"><span data-stu-id="c2b83-117">In some cases, you might want to change the behavior of the JIT compiler so that the machine code it generates is easier to debug.</span></span> <span data-ttu-id="c2b83-118">Par exemple, vous pouvez générer des informations de suivi JIT pour une version commerciale ou pour l’optimisation du contrôle.</span><span class="sxs-lookup"><span data-stu-id="c2b83-118">For example, you might want to generate JIT tracking information for a retail build or control optimization.</span></span> <span data-ttu-id="c2b83-119">Vous pouvez faire cela avec un fichier d’initialisation (.ini).</span><span class="sxs-lookup"><span data-stu-id="c2b83-119">You can do so with an initialization (.ini) file.</span></span>  
  
 <span data-ttu-id="c2b83-120">Par exemple, si l’assembly que vous voulez déboguer s’appelle MyApp.exe, vous pouvez créer un fichier texte nommé MyApp.ini dans le même dossier sous le nom MyApp.exe, qui contient ces trois lignes :</span><span class="sxs-lookup"><span data-stu-id="c2b83-120">For example, if the assembly you want to debug is called MyApp.exe, then you can create a text file named MyApp.ini, in the same folder as MyApp.exe, which contains these three lines:</span></span>  
  
```  
[.NET Framework Debugging Control]  
GenerateTrackingInfo=1  
AllowOptimize=0  
```  
  
 <span data-ttu-id="c2b83-121">Vous pouvez définir la valeur de chaque option sur 0 ou 1. Les options absentes ont 0 comme valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="c2b83-121">You can set the value of each option to 0 or 1, and any absent option defaults to 0.</span></span> <span data-ttu-id="c2b83-122">La définition de `GenerateTrackingInfo` sur 1 et de `AllowOptimize` sur 0 est ce qui permet le débogage le plus facile.</span><span class="sxs-lookup"><span data-stu-id="c2b83-122">Setting `GenerateTrackingInfo` to 1 and `AllowOptimize` to 0 provides the easiest debugging.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c2b83-123">Dans le .NET Framework version 2.0, le compilateur JIT génère toujours des informations de suivi, quelle que soit la valeur de `GenerateTrackingInfo` ; la valeur de `AllowOptimize` a cependant toujours un effet.</span><span class="sxs-lookup"><span data-stu-id="c2b83-123">In the .NET Framework version 2.0, the JIT compiler always generates tracking information regardless of the value for `GenerateTrackingInfo`; however, the `AllowOptimize` value still has an effect.</span></span> <span data-ttu-id="c2b83-124">Quand vous utilisez le générateur d’images natives [Ngen.exe (Native Image Generator)](../../../docs/framework/tools/ngen-exe-native-image-generator.md) pour précompiler l’image native sans optimisation, le fichier .ini doit être présent dans le dossier cible avec `AllowOptimize=0` quand Ngen.exe s’exécute.</span><span class="sxs-lookup"><span data-stu-id="c2b83-124">When using the [Ngen.exe (Native Image Generator)](../../../docs/framework/tools/ngen-exe-native-image-generator.md) to precompile the native image without optimization, the .ini file must be present in the target folder with `AllowOptimize=0` when Ngen.exe executes.</span></span> <span data-ttu-id="c2b83-125">Si vous avez précompilé un assembly sans optimisation, vous devez supprimer le code précompilé à l’aide de l’option **/uninstall**de NGen.exe avant de réexécuter Ngen.exe pour précompiler le code avec optimisation.</span><span class="sxs-lookup"><span data-stu-id="c2b83-125">If you have precompiled an assembly without optimization, you must remove the precompiled code using the NGen.exe **/uninstall** option before rerunning Ngen.exe to precompile the code as optimized.</span></span> <span data-ttu-id="c2b83-126">Si le fichier .ini n’est pas présent dans le dossier, Ngen.exe précompile par défaut le code avec optimisation.</span><span class="sxs-lookup"><span data-stu-id="c2b83-126">If the .ini file is not present in the folder, by default Ngen.exe precompiles the code as optimized.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c2b83-127"><xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> contrôle les paramètres pour un assembly.</span><span class="sxs-lookup"><span data-stu-id="c2b83-127">The <xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> controls the settings for an assembly.</span></span> <span data-ttu-id="c2b83-128">**DebuggableAttribute** comprend deux champs qui enregistrent les paramètres spécifiant si le compilateur JIT doit optimiser et/ou générer des informations de suivi.</span><span class="sxs-lookup"><span data-stu-id="c2b83-128">**DebuggableAttribute** includes two fields that record the settings for whether the JIT compiler should optimize, and/or generate tracking information.</span></span> <span data-ttu-id="c2b83-129">Dans le .NET Framework version 2.0, le compilateur JIT génère toujours des informations de suivi.</span><span class="sxs-lookup"><span data-stu-id="c2b83-129">In the .NET Framework version 2.0, the JIT compiler will always generate tracking information.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c2b83-130">Pour une version commerciale, les compilateurs ne définissent rien pour **DebuggableAttribute**.</span><span class="sxs-lookup"><span data-stu-id="c2b83-130">For a retail build, compilers do not set any **DebuggableAttribute**.</span></span> <span data-ttu-id="c2b83-131">Le comportement par défaut du compilateur JIT est de générer du code machine avec les performances les plus élevées, mais le plus difficile à déboguer.</span><span class="sxs-lookup"><span data-stu-id="c2b83-131">The JIT-compiler default behavior is to generate the highest performance, hardest to debug machine code.</span></span> <span data-ttu-id="c2b83-132">L’activation du suivi dans JIT diminue légèrement les performances, tandis que la désactivation de l’optimisation les réduit considérablement.</span><span class="sxs-lookup"><span data-stu-id="c2b83-132">Enabling JIT tracking lowers performance a little, and disabling optimization lowers performance a lot.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c2b83-133">**DebuggableAttribute** s’applique à la totalité d’un assembly, et non pas à des modules individuels dans l’assembly.</span><span class="sxs-lookup"><span data-stu-id="c2b83-133">The **DebuggableAttribute** applies to a whole assembly at a time, not to individual modules within the assembly.</span></span> <span data-ttu-id="c2b83-134">Les outils de développement doivent donc attacher des attributs personnalisés au jeton de métadonnées de l’assembly si un assembly a déjà été créé, ou à la classe appelée **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span><span class="sxs-lookup"><span data-stu-id="c2b83-134">Development tools must therefore attach custom attributes to the assembly metadata token, if an assembly has already been created, or to the class called **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span></span> <span data-ttu-id="c2b83-135">L’outil ALink promeut ensuite ces attributs **DebuggableAttribute** de chaque module vers l’assembly dont ils font partie.</span><span class="sxs-lookup"><span data-stu-id="c2b83-135">The ALink tool will then promote these **DebuggableAttribute** attributes from each module to the assembly they become a part of.</span></span> <span data-ttu-id="c2b83-136">Si un conflit se produit, l’opération ALink échoue.</span><span class="sxs-lookup"><span data-stu-id="c2b83-136">If there is a conflict, the ALink operation will fail.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c2b83-137">Dans la version 1.0 du .NET Framework, le compilateur Microsoft Visual C++ ajoute **DebuggableAttribute** quand les options du compilateur **/clr** et **/Zi** sont spécifiées.</span><span class="sxs-lookup"><span data-stu-id="c2b83-137">In version 1.0 of the .NET Framework, the Microsoft Visual C++ compiler adds the **DebuggableAttribute** when the **/clr** and **/Zi** compiler options are specified.</span></span> <span data-ttu-id="c2b83-138">Dans la version 1.1 du .NET Framework, vous devez ajouter **DebugabbleAttribute** manuellement dans votre code ou en utilisant l’option de l’éditeur de liens **/ASSEMBLYDEBUG**.</span><span class="sxs-lookup"><span data-stu-id="c2b83-138">In version 1.1 of the .NET Framework, you must either add the **DebugabbleAttribute** manually in your code or use the **/ASSEMBLYDEBUG** linker option.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c2b83-139">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="c2b83-139">See Also</span></span>  
 [<span data-ttu-id="c2b83-140">Débogage, traçage et profilage</span><span class="sxs-lookup"><span data-stu-id="c2b83-140">Debugging, Tracing, and Profiling</span></span>](../../../docs/framework/debug-trace-profile/index.md)  
 [<span data-ttu-id="c2b83-141">Activation du débogage juste-à-temps</span><span class="sxs-lookup"><span data-stu-id="c2b83-141">Enabling JIT-Attach Debugging</span></span>](../../../docs/framework/debug-trace-profile/enabling-jit-attach-debugging.md)  
 [<span data-ttu-id="c2b83-142">Activation du profilage</span><span class="sxs-lookup"><span data-stu-id="c2b83-142">Enabling Profiling</span></span>](http://msdn.microsoft.com/en-us/3b669676-f0e0-4ebf-8674-68986dd2020d)
