---
title: "Compteurs de performance et applications côte à côte in-process"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- performance counters
- performance counters,and in-process side-by-side applications
- performance,.NET Framework applications
- performance monitoring,counters
ms.assetid: 6888f9be-c65b-4b03-a07b-df7ebdee2436
caps.latest.revision: "26"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: acbdf1ff1f2827bf607c2f838685d5161af61fd0
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/22/2017
---
# <a name="performance-counters-and-in-process-side-by-side-applications"></a><span data-ttu-id="ac4e5-102">Compteurs de performance et applications côte à côte in-process</span><span class="sxs-lookup"><span data-stu-id="ac4e5-102">Performance Counters and In-Process Side-By-Side Applications</span></span>
<span data-ttu-id="ac4e5-103">À l’aide de l’Analyseur de performances (Perfmon.exe), il est possible de différencier les compteurs de performance pour chaque runtime.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-103">Using the Performance Monitor (Perfmon.exe), it is possible to differentiate the performance counters on a per-runtime basis.</span></span> <span data-ttu-id="ac4e5-104">Cette rubrique décrit la modification du Registre nécessaire pour activer cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-104">This topic describes the registry change needed to enable this functionality.</span></span>  
  
## <a name="the-default-behavior"></a><span data-ttu-id="ac4e5-105">Comportement par défaut</span><span class="sxs-lookup"><span data-stu-id="ac4e5-105">The Default Behavior</span></span>  
 <span data-ttu-id="ac4e5-106">Par défaut, l’Analyseur de performances affiche les compteurs de performance pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-106">By default, the Performance Monitor displays performance counters on a per-application basis.</span></span> <span data-ttu-id="ac4e5-107">Toutefois, il existe deux scénarios dans lesquels cela pose problème :</span><span class="sxs-lookup"><span data-stu-id="ac4e5-107">However, there are two scenarios in which this is problematic:</span></span>  
  
-   <span data-ttu-id="ac4e5-108">Quand vous surveillez deux applications qui ont le même nom.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-108">When you monitor two applications that have the same name.</span></span> <span data-ttu-id="ac4e5-109">Par exemple, si les deux applications se nomment MonApp.exe, l’une sera affichée en tant que **MonApp** et l’autre en tant que **MonApp#1** dans la colonne **Instance**.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-109">For example, if both applications are named myapp.exe, one will be displayed as **myapp** and the other as **myapp#1** in the **Instance** column.</span></span> <span data-ttu-id="ac4e5-110">Dans ce cas, il est difficile de faire correspondre un compteur de performance à une application particulière.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-110">In this case, it is difficult to match a performance counter to a particular application.</span></span> <span data-ttu-id="ac4e5-111">On ne sait pas trop si les données recueillies pour **MonApp#1** font référence à la première MonApp.exe ou à la deuxième MonApp.exe.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-111">It is not clear whether the data collected for **myapp#1** refers to the first myapp.exe or the second myapp.exe.</span></span>  
  
-   <span data-ttu-id="ac4e5-112">Quand une application utilise plusieurs instances du Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-112">When an application uses multiple instances of the common language runtime.</span></span> <span data-ttu-id="ac4e5-113">Le [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] prend en charge les scénarios d’hébergement côte à côte in-process ; autrement dit, un même processus ou une même application peut charger plusieurs instances du Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-113">The [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] supports in-process side-by-side hosting scenarios; that is, a single process or application can load multiple instances of the common language runtime.</span></span> <span data-ttu-id="ac4e5-114">Si une application nommée MonApp.exe charge deux instances d’exécution par défaut, elles sont désignées dans la colonne **Instance** en tant que **MonApp** et **MonApp#1**.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-114">If a single application named myapp.exe loads two runtime instances, by default, they will be designated in the **Instance** column as **myapp** and **myapp#1**.</span></span> <span data-ttu-id="ac4e5-115">Dans ce cas, il est difficile de savoir si **MonApp** et **MonApp#1** font référence à deux applications portant le même nom ou à la même application avec deux runtimes.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-115">In this case, it is not clear whether **myapp** and **myapp#1** refer to two applications with the same name, or to the same application with two runtimes.</span></span> <span data-ttu-id="ac4e5-116">Si plusieurs applications du même nom chargent plusieurs runtimes, il y a encore plus d’ambiguïté.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-116">If multiple applications with the same name load multiple runtimes, the ambiguity is even greater.</span></span>  
  
 <span data-ttu-id="ac4e5-117">Vous pouvez définir une clé de Registre pour lever cette ambiguïté.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-117">You can set a registry key to eliminate this ambiguity.</span></span> <span data-ttu-id="ac4e5-118">Pour les applications développées à l’aide du [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], cette modification du Registre ajoute un identificateur de processus suivi d’un identificateur d’instance de runtime au nom de l’application dans la colonne **Instance**.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-118">For applications developed using the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], this registry change adds a process identifier followed by a runtime instance identifier to the application name in the **Instance** column.</span></span> <span data-ttu-id="ac4e5-119">Au lieu de *application* ou *application*#1, l’application est maintenant identifiée comme *application*_`p`*ID_processus* \_ `r` *ID_runtime* dans la colonne **Instance**.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-119">Instead of *application* or *application*#1, the application is now identified as *application*_`p`*processID*\_`r`*runtimeID* in the **Instance** column.</span></span> <span data-ttu-id="ac4e5-120">Si une application a été développée à l’aide d’une version antérieure du Common Language Runtime, cette instance est représentée en tant que *application\_*`p`*ID_processus* à condition que le [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] soit installé.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-120">If an application was developed using a previous version of the common language runtime, that instance is represented as *application\_*`p`*processID* provided that the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is installed.</span></span>  
  
## <a name="performance-counters-for-in-process-side-by-side-applications"></a><span data-ttu-id="ac4e5-121">Compteurs de performance pour les applications côte à côte in-process</span><span class="sxs-lookup"><span data-stu-id="ac4e5-121">Performance Counters for In-Process Side-by-Side Applications</span></span>  
 <span data-ttu-id="ac4e5-122">Pour gérer les compteurs de performance pour plusieurs versions du Common Language Runtime hébergées dans une application unique, vous devez modifier un paramètre de clé de Registre, comme indiqué dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-122">To handle performance counters for multiple common language runtime versions that are hosted in a single application, you must change a single registry key setting, as shown in the following table.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="ac4e5-123">Nom de la clé</span><span class="sxs-lookup"><span data-stu-id="ac4e5-123">Key name</span></span>|<span data-ttu-id="ac4e5-124">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance</span><span class="sxs-lookup"><span data-stu-id="ac4e5-124">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance</span></span>|  
|<span data-ttu-id="ac4e5-125">Nom de la valeur</span><span class="sxs-lookup"><span data-stu-id="ac4e5-125">Value name</span></span>|<span data-ttu-id="ac4e5-126">ProcessNameFormat</span><span class="sxs-lookup"><span data-stu-id="ac4e5-126">ProcessNameFormat</span></span>|  
|<span data-ttu-id="ac4e5-127">Type de valeur</span><span class="sxs-lookup"><span data-stu-id="ac4e5-127">Value type</span></span>|<span data-ttu-id="ac4e5-128">REG_DWORD</span><span class="sxs-lookup"><span data-stu-id="ac4e5-128">REG_DWORD</span></span>|  
|<span data-ttu-id="ac4e5-129">Value</span><span class="sxs-lookup"><span data-stu-id="ac4e5-129">Value</span></span>|<span data-ttu-id="ac4e5-130">1 (0x00000001)</span><span class="sxs-lookup"><span data-stu-id="ac4e5-130">1 (0x00000001)</span></span>|  
  
 <span data-ttu-id="ac4e5-131">La valeur 0 pour `ProcessNameFormat` indique que le comportement par défaut est « Activé » ; autrement dit, Perfmon.exe affiche les compteurs de performance pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-131">A value of 0 for `ProcessNameFormat` indicates that the default behavior is enabled; that is, Perfmon.exe displays performance counters on a per-application basis.</span></span> <span data-ttu-id="ac4e5-132">Quand vous affectez la valeur 1, Perfmon.exe lève l’ambiguïté liée aux versions multiples d’une application et fournit des compteurs de performance pour chaque runtime.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-132">When you set this value to 1, Perfmon.exe disambiguates multiple versions of an application and provides performance counters on a per-runtime basis.</span></span> <span data-ttu-id="ac4e5-133">Toute autre valeur pour le paramètre de clé de Registre `ProcessNameFormat` est non prise en charge et réservée à un usage ultérieur.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-133">Any other value for the `ProcessNameFormat` registry key setting is unsupported and reserved for future use.</span></span>  
  
 <span data-ttu-id="ac4e5-134">Après avoir mis à jour le paramètre de clé de Registre `ProcessNameFormat`, vous devez redémarrer Perfmon.exe ou tout autre consommateur de compteurs de performance afin que la nouvelle fonctionnalité de nommage d’instance fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-134">After you update the `ProcessNameFormat` registry key setting, you must restart Perfmon.exe or any other consumers of performance counters so that the new instance naming feature works correctly.</span></span>  
  
 <span data-ttu-id="ac4e5-135">L’exemple suivant montre comment modifier la valeur `ProcessNameFormat` par programmation.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-135">The following example shows how to change the `ProcessNameFormat` value programmatically.</span></span>  
  
 [!code-csharp[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/cs/regsetting1.cs#1)]
 [!code-vb[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/vb/regsetting1.vb#1)]  
  
 <span data-ttu-id="ac4e5-136">Quand vous modifiez cette clé de Registre, Perfmon.exe affiche les noms des applications qui ciblent le [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] en tant que *application*_`p`*ID_processus* \_ `r` *ID_runtime*, où *application* est le nom de l’application, *ID_processus* est l’identificateur de processus de l’application et *ID_runtime* est un identificateur du Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-136">When you make this registry change, Perfmon.exe displays the names of applications that target the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] as *application*_`p`*processID*\_`r`*runtimeID*, where *application* is the name of the application, *processID* is the application's process identifier, and *runtimeID* is a common language runtime identifier.</span></span> <span data-ttu-id="ac4e5-137">Par exemple, si une application nommée MonApp.exe charge deux instances du Common Language Runtime, Perfmon.exe peut identifier une instance comme MonApp_p1416_r10 et la deuxième comme MonApp_p3160_r10.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-137">For example, if an application named myapp.exe loads two instances of the common language runtime, Perfmon.exe may identify one instance as myapp_p1416_r10 and the second as myapp_p3160_r10.</span></span> <span data-ttu-id="ac4e5-138">L’identificateur de runtime lève uniquement l’ambiguïté liée aux runtimes dans un processus ; il ne fournit aucune autre information sur le runtime.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-138">The runtime identifier only disambiguates the runtimes within a process; it does not provide any other information about the runtime.</span></span> <span data-ttu-id="ac4e5-139">(Par exemple, l’ID de runtime n’a aucun lien avec la version ou la référence SKU du runtime.)</span><span class="sxs-lookup"><span data-stu-id="ac4e5-139">(For example, the runtime ID has no relation to the version or the SKU of the runtime.)</span></span>  
  
 <span data-ttu-id="ac4e5-140">Si le [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] est installé, la modification du Registre affecte également les applications qui ont été développées à l’aide de versions antérieures du .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-140">If the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is installed, the registry change also affects applications that were developed using earlier versions of the .NET Framework.</span></span> <span data-ttu-id="ac4e5-141">Celles-ci apparaissent dans Perfmon.exe au format *application_*`p`*ID_processus*, où *application* est le nom de l’application et *ID_processus* est l’identificateur de processus.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-141">These appear in Perfmon.exe as *application_*`p`*processID*, where *application* is the application name and *processID* is the process identifier.</span></span> <span data-ttu-id="ac4e5-142">Par exemple, si les compteurs de performance de deux applications nommées MonApp.exe sont analysés, l’un d’eux peut apparaître comme MonApp_p23900 et l’autre comme MonApp_p24908.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-142">For example, if the performance counters of two applications named myapp.exe are monitored, one might appear as myapp_p23900 and the other as myapp_p24908.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ac4e5-143">L’identificateur de processus élimine l’ambiguïté liée à la résolution de deux applications du même nom qui utilisent des versions antérieures du runtime.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-143">The process identifier eliminates the ambiguity of resolving two applications with the same name that use earlier versions of the runtime.</span></span> <span data-ttu-id="ac4e5-144">Aucun identificateur de runtime n’est nécessaire pour les versions antérieures, car les versions précédentes du Common Language Runtime ne prennent pas en charge les scénarios côte à côte.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-144">A runtime identifier is not required for previous versions, because previous versions of the common language runtime do not support side-by-side scenarios.</span></span>  
  
 <span data-ttu-id="ac4e5-145">Si le [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] n’est pas présent ou a été désinstallé, la définition de la clé de Registre n’a aucun effet.</span><span class="sxs-lookup"><span data-stu-id="ac4e5-145">If the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is not present or was uninstalled, setting the registry key has no effect.</span></span> <span data-ttu-id="ac4e5-146">Cela signifie que deux applications portant le même nom continueront d’apparaître dans Perfmon.exe comme *application* et *application#1* (par exemple, **MonApp** et **MonApp#1**).</span><span class="sxs-lookup"><span data-stu-id="ac4e5-146">This means that two applications with the same name will continue to appear in Perfmon.exe as *application* and *application#1* (for example, as **myapp** and **myapp#1**).</span></span>
