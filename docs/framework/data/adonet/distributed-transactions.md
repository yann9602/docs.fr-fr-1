---
title: "Transactions distribuées"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
caps.latest.revision: "7"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: c2de777dbd8bf6ac18db95a1cf647d259a252f8d
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/17/2018
---
# <a name="distributed-transactions"></a><span data-ttu-id="39929-102">Transactions distribuées</span><span class="sxs-lookup"><span data-stu-id="39929-102">Distributed Transactions</span></span>
<span data-ttu-id="39929-103">Une transaction est un ensemble de tâches liées entre elles qui échouent (abort) ou sont validées (commit) globalement, entre autres choses.</span><span class="sxs-lookup"><span data-stu-id="39929-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="39929-104">A *distributed transaction* est une transaction qui affecte plusieurs ressources.</span><span class="sxs-lookup"><span data-stu-id="39929-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="39929-105">Pour qu’une transaction distribuée soit validée, l’ensemble des participants doivent garantir que tout changement apporté aux données sera permanent.</span><span class="sxs-lookup"><span data-stu-id="39929-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="39929-106">Ces modifications doivent persister même en cas de panne du système ou de tout autre événement imprévu.</span><span class="sxs-lookup"><span data-stu-id="39929-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="39929-107">Il suffit qu'un seul des participants n'apporte pas cette garantie pour que l'ensemble de la transaction échoue et toutes les modifications apportées aux données dans le cadre de la transaction sont annulées.</span><span class="sxs-lookup"><span data-stu-id="39929-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="39929-108">Une exception est levée lorsque vous tentez de valider ou d'annuler une transaction si `DataReader` démarre pendant que la transaction est active.</span><span class="sxs-lookup"><span data-stu-id="39929-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="39929-109">Utilisation de System.Transactions</span><span class="sxs-lookup"><span data-stu-id="39929-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="39929-110">Dans .NET Framework, les transactions distribuées sont gérées via l'API dans l'espace de noms <xref:System.Transactions>.</span><span class="sxs-lookup"><span data-stu-id="39929-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="39929-111">L'API <xref:System.Transactions> délègue la gestion de transaction distribuée à un moniteur de transaction tel que le Microsoft Distributed Transaction Coordinator (MS DTC) lorsque plusieurs gestionnaires de ressources persistants sont impliqués.</span><span class="sxs-lookup"><span data-stu-id="39929-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="39929-112">Pour plus d’informations, consultez [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="39929-112">For more information, see [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="39929-113">ADO.NET 2.0 a introduit la prise en charge de l'inscription dans une transaction distribuée à l'aide de la méthode `EnlistTransaction`, qui inscrit une connexion dans une instance <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="39929-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="39929-114">Dans les versions précédentes d'ADO.NET, l'inscription explicite dans des transactions distribuées était effectuée à l'aide de la méthode `EnlistDistributedTransaction` d'une connexion afin d'inscrire une connexion dans une instance de l'objet <xref:System.EnterpriseServices.ITransaction>, qui est prise en charge à des fins de compatibilité ascendante.</span><span class="sxs-lookup"><span data-stu-id="39929-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="39929-115">Pour plus d’informations sur les transactions Enterprise Services, consultez [l’interopérabilité avec les Services d’entreprise et les Transactions COM +](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="39929-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="39929-116">Lors de l'utilisation d'une transaction <xref:System.Transactions> avec le fournisseur .NET Framework pour SQL Server en relation avec une base de données SQL Server, un <xref:System.Transactions.Transaction> léger est automatiquement utilisé.</span><span class="sxs-lookup"><span data-stu-id="39929-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="39929-117">La transaction peut être promue en transaction totalement distribuée en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="39929-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="39929-118">Pour plus d’informations, consultez [intégration de System.Transactions à SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="39929-118">For more information, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="39929-119">Le nombre maximal de transactions distribuées auxquelles une base de données Oracle peut participer à un moment donné a la valeur 10 par défaut.</span><span class="sxs-lookup"><span data-stu-id="39929-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="39929-120">Après la 10e transaction lors d'une connexion à une base de données Oracle, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="39929-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="39929-121">Oracle ne prend pas en charge `DDL` à l'intérieur d'une transaction distribuée.</span><span class="sxs-lookup"><span data-stu-id="39929-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="39929-122">Inscription automatique dans une transaction distribuée</span><span class="sxs-lookup"><span data-stu-id="39929-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="39929-123">L'inscription automatique est la méthode par défaut (et conseillée) pour intégrer des connexions ADO.NET avec `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="39929-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="39929-124">Un objet Connection est automatiquement inscrit dans une transaction distribuée existante s'il détermine qu'une transaction est active, ce qui, pour `System.Transaction`, signifie que `Transaction.Current` n'a pas la valeur null.</span><span class="sxs-lookup"><span data-stu-id="39929-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="39929-125">Une inscription de transaction automatique se produit lors de l'ouverture de la connexion.</span><span class="sxs-lookup"><span data-stu-id="39929-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="39929-126">Elle ne se produit pas ensuite, même si une commande est exécutée dans le cadre d'une transaction.</span><span class="sxs-lookup"><span data-stu-id="39929-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="39929-127">Vous pouvez désactiver l'inscription automatique dans des transactions existantes en spécifiant `Enlist=false` comme paramètre de chaîne de connexion pour un <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType> ou `OLE DB Services=-7` comme paramètre de chaîne de connexion pour un <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="39929-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="39929-128">Pour plus d'informations sur les paramètres de chaîne de connexion Oracle et ODBC, voir <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> et <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="39929-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="39929-129">Inscription manuelle dans une transaction distribuée</span><span class="sxs-lookup"><span data-stu-id="39929-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="39929-130">Si l'inscription automatique est désactivée ou si vous devez inscrire une transaction qui a été démarrée après l'ouverture de la connexion, vous pouvez l'inscrire dans une transaction distribuée existante en utilisant la méthode `EnlistTransaction` de l'objet <xref:System.Data.Common.DbConnection> pour le fournisseur avec lequel vous travaillez.</span><span class="sxs-lookup"><span data-stu-id="39929-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="39929-131">L'inscription dans une transaction distribuée existante garantit que si la transaction vient à être annulée ou validée, les modifications apportées par le code dans la source de données seront elles aussi validées ou annulées.</span><span class="sxs-lookup"><span data-stu-id="39929-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="39929-132">L'inscription dans des transactions distribuées s'applique en particulier lors du regroupement d'objets métier.</span><span class="sxs-lookup"><span data-stu-id="39929-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="39929-133">Si un objet métier est regroupé avec une connexion ouverte, l'inscription automatique dans la transaction se produit uniquement lorsque cette connexion est ouverte.</span><span class="sxs-lookup"><span data-stu-id="39929-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="39929-134">Si plusieurs transactions sont effectuées à l'aide de l'objet métier regroupé, la connexion ouverte pour cet objet n'est pas automatiquement inscrite dans les nouvelles transactions lancées.</span><span class="sxs-lookup"><span data-stu-id="39929-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="39929-135">Dans ce cas, vous pouvez désactiver l'inscription de transaction automatique pour la connexion et inscrire la connexion dans des transactions à l'aide de `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="39929-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="39929-136">`EnlistTransaction`accepte un seul argument de type <xref:System.Transactions.Transaction> qui est une référence à la transaction existante.</span><span class="sxs-lookup"><span data-stu-id="39929-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="39929-137">Après avoir appelé la méthode `EnlistTransaction` de la connexion, toutes les modifications apportées à la source de données à l'aide de la connexion sont incluses dans la transaction.</span><span class="sxs-lookup"><span data-stu-id="39929-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="39929-138">Le fait de passer une valeur null désinscrit la connexion de l'inscription de transaction distribuée actuelle.</span><span class="sxs-lookup"><span data-stu-id="39929-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="39929-139">Notez que la connexion doit être ouverte avant l'appel de `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="39929-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="39929-140">Une fois qu'une connexion est explicitement inscrite sur une transaction, il n'est plus possible de la désinscrire ou de l'inscrire dans une autre transaction tant que la première transaction n'est pas terminée.</span><span class="sxs-lookup"><span data-stu-id="39929-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="39929-141">`EnlistTransaction` lève une exception si la connexion a déjà entamé une transaction à l'aide de la méthode <xref:System.Data.Common.DbConnection.BeginTransaction%2A> de la connexion.</span><span class="sxs-lookup"><span data-stu-id="39929-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="39929-142">Toutefois, si la transaction est une transaction locale démarrée dans la source de données (par exemple, l'exécution explicite de l'instruction BEGIN TRANSACTION à l'aide d'un <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` annule la transaction locale et s'inscrit dans la transaction distribuée existante comme requis.</span><span class="sxs-lookup"><span data-stu-id="39929-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="39929-143">Vous ne recevrez pas de notification indiquant que la transaction locale a été annulée et que vous devez gérer les transactions locales non lancées à l'aide de <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span><span class="sxs-lookup"><span data-stu-id="39929-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="39929-144">Si vous utilisez le fournisseur de données .NET Framework pour SQL Server (`SqlClient`) avec SQL Server, toute tentative d'inscription lève une exception.</span><span class="sxs-lookup"><span data-stu-id="39929-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="39929-145">Les autres cas ne sont pas détectés.</span><span class="sxs-lookup"><span data-stu-id="39929-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="39929-146">Transactions pouvant être promues dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="39929-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="39929-147">SQL Server prend en charge les transactions pouvant être promues dans lesquelles une transaction légère locale peut être automatiquement promue en transaction distribuée uniquement si c'est requis.</span><span class="sxs-lookup"><span data-stu-id="39929-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="39929-148">Une transaction pouvant être promue n'invoque pas la charge supplémentaire d'une transaction distribuée à moins qu'elle ne soit requise.</span><span class="sxs-lookup"><span data-stu-id="39929-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="39929-149">Pour plus d’informations et un exemple de code, consultez [intégration de System.Transactions à SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="39929-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="39929-150">Configuration de transactions distribuées</span><span class="sxs-lookup"><span data-stu-id="39929-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="39929-151">Vous devrez peut-être activer MS DTC sur le réseau afin d'utiliser des transactions distribuées.</span><span class="sxs-lookup"><span data-stu-id="39929-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="39929-152">Si le Pare-feu Windows est activé, vous devez autoriser le service MS DTC à utiliser le réseau ou à ouvrir le port MS DTC.</span><span class="sxs-lookup"><span data-stu-id="39929-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="39929-153">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="39929-153">See Also</span></span>  
 [<span data-ttu-id="39929-154">Transactions et accès concurrentiel</span><span class="sxs-lookup"><span data-stu-id="39929-154">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)  
 [<span data-ttu-id="39929-155">Intégration de System.Transactions à SQL Server</span><span class="sxs-lookup"><span data-stu-id="39929-155">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)  
 [<span data-ttu-id="39929-156">Fournisseurs managés ADO.NET et centre de développement DataSet</span><span class="sxs-lookup"><span data-stu-id="39929-156">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
