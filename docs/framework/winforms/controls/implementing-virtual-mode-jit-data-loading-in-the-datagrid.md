---
title: "Implémentation du mode virtuel avec le chargement de données juste-à-temps dans le contrôle DataGridView Windows Forms"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-winforms
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- examples [Windows Forms], just-in-time data loading
- data [Windows Forms], managing large data sets
- DataGridView control [Windows Forms], virtual mode
- just-in-time data loading
- DataGridView control [Windows Forms], large data sets
- virtual mode [Windows Forms], just-in-time data loading
ms.assetid: c2a052b9-423c-4ff7-91dc-d8c7c79345f6
caps.latest.revision: "13"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 2a830c11e8df73b71f16c1b9dfd1007461d910f5
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/22/2017
---
# <a name="implementing-virtual-mode-with-just-in-time-data-loading-in-the-windows-forms-datagridview-control"></a><span data-ttu-id="fc666-102">Implémentation du mode virtuel avec le chargement de données juste-à-temps dans le contrôle DataGridView Windows Forms</span><span class="sxs-lookup"><span data-stu-id="fc666-102">Implementing Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>
<span data-ttu-id="fc666-103">L’une des raisons pour implémenter le mode virtuel dans le <xref:System.Windows.Forms.DataGridView> contrôle consiste à récupérer des données uniquement qu’il est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="fc666-103">One reason to implement virtual mode in the <xref:System.Windows.Forms.DataGridView> control is to retrieve data only as it is needed.</span></span> <span data-ttu-id="fc666-104">Il s’agit *lors du chargement de données juste-à-temps*.</span><span class="sxs-lookup"><span data-stu-id="fc666-104">This is called *just-in-time data loading*.</span></span>  
  
 <span data-ttu-id="fc666-105">Si vous travaillez avec une table très volumineuse dans une base de données distante, par exemple, vous souhaiterez éviter les retards de démarrage en récupérant uniquement les données qui sont nécessaires pour l’affichage et la récupération des données supplémentaires uniquement lorsque l’utilisateur fait défiler de nouvelles lignes dans la vue.</span><span class="sxs-lookup"><span data-stu-id="fc666-105">If you are working with a very large table in a remote database, for example, you might want to avoid startup delays by retrieving only the data that is necessary for display and retrieving additional data only when the user scrolls new rows into view.</span></span> <span data-ttu-id="fc666-106">Si les ordinateurs clients qui exécutent votre application ont une quantité limitée de mémoire disponible pour le stockage des données, vous souhaiterez également ignorer les données inutilisées lors de la récupération de nouvelles valeurs à partir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="fc666-106">If the client computers running your application have a limited amount of memory available for storing data, you might also want to discard unused data when retrieving new values from the database.</span></span>  
  
 <span data-ttu-id="fc666-107">Les sections suivantes décrivent comment utiliser un <xref:System.Windows.Forms.DataGridView> contrôle avec un cache juste-à-temps.</span><span class="sxs-lookup"><span data-stu-id="fc666-107">The following sections describe how to use a <xref:System.Windows.Forms.DataGridView> control with a just-in-time cache.</span></span>  
  
 <span data-ttu-id="fc666-108">Pour copier le code dans cette rubrique sous forme de liste unique, consultez [Comment : implémenter le Mode virtuel avec le chargement de données juste à temps dans le contrôle DataGridView Windows Forms](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span><span class="sxs-lookup"><span data-stu-id="fc666-108">To copy the code in this topic as a single listing, see [How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span></span>  
  
## <a name="the-form"></a><span data-ttu-id="fc666-109">Le formulaire</span><span class="sxs-lookup"><span data-stu-id="fc666-109">The Form</span></span>  
 <span data-ttu-id="fc666-110">L’exemple de code suivant définit un formulaire contenant en lecture seule <xref:System.Windows.Forms.DataGridView> contrôle interagit avec un `Cache` via un <xref:System.Windows.Forms.DataGridView.CellValueNeeded> Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="fc666-110">The following code example defines a form containing a read-only <xref:System.Windows.Forms.DataGridView> control that interacts with a `Cache` object through a <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler.</span></span> <span data-ttu-id="fc666-111">Le `Cache` objet gère les valeurs stockées localement et utilise un `DataRetriever` objet pour récupérer les valeurs de la table Orders de la base de données exemple Northwind.</span><span class="sxs-lookup"><span data-stu-id="fc666-111">The `Cache` object manages the locally stored values and uses a `DataRetriever` object to retrieve values from the Orders table of the sample Northwind database.</span></span> <span data-ttu-id="fc666-112">Le `DataRetriever` objet qui implémente le `IDataPageRetriever` interface requise par le `Cache` de classes, est également utilisé pour initialiser le <xref:System.Windows.Forms.DataGridView> contrôler les lignes et colonnes.</span><span class="sxs-lookup"><span data-stu-id="fc666-112">The `DataRetriever` object, which implements the `IDataPageRetriever` interface required by the `Cache` class, is also used to initialize the <xref:System.Windows.Forms.DataGridView> control rows and columns.</span></span>  
  
 <span data-ttu-id="fc666-113">Le `IDataPageRetriever`, `DataRetriever`, et `Cache` types sont décrits plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="fc666-113">The `IDataPageRetriever`, `DataRetriever`, and `Cache` types are described later in this topic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="fc666-114">Le stockage d'informations sensibles (telles qu'un mot de passe) dans la chaîne de connexion peut affecter la sécurité de votre application.</span><span class="sxs-lookup"><span data-stu-id="fc666-114">Storing sensitive information, such as a password, within the connection string can affect the security of your application.</span></span> <span data-ttu-id="fc666-115">L'utilisation de l'authentification Windows (également appelée sécurité intégrée) offre un moyen plus sûr de contrôler l'accès à une base de données.</span><span class="sxs-lookup"><span data-stu-id="fc666-115">Using Windows Authentication (also known as integrated security) is a more secure way to control access to a database.</span></span> <span data-ttu-id="fc666-116">Pour plus d’informations, consultez [Protection des informations de connexion](../../../../docs/framework/data/adonet/protecting-connection-information.md).</span><span class="sxs-lookup"><span data-stu-id="fc666-116">For more information, see [Protecting Connection Information](../../../../docs/framework/data/adonet/protecting-connection-information.md).</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#100)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#100)]  
  
## <a name="the-idatapageretriever-interface"></a><span data-ttu-id="fc666-117">L’Interface IDataPageRetriever</span><span class="sxs-lookup"><span data-stu-id="fc666-117">The IDataPageRetriever Interface</span></span>  
 <span data-ttu-id="fc666-118">L’exemple de code suivant définit la `IDataPageRetriever` interface, qui est implémentée par la `DataRetriever` classe.</span><span class="sxs-lookup"><span data-stu-id="fc666-118">The following code example defines the `IDataPageRetriever` interface, which is implemented by the `DataRetriever` class.</span></span> <span data-ttu-id="fc666-119">La seule méthode déclarée dans cette interface est le `SupplyPageOfData` (méthode), ce qui nécessite un index de ligne initial et le nombre de lignes dans une seule page de données.</span><span class="sxs-lookup"><span data-stu-id="fc666-119">The only method declared in this interface is the `SupplyPageOfData` method, which requires an initial row index and a count of the number of rows in a single page of data.</span></span> <span data-ttu-id="fc666-120">Ces valeurs sont utilisées par l’implémenteur pour récupérer un sous-ensemble de données à partir d’une source de données.</span><span class="sxs-lookup"><span data-stu-id="fc666-120">These values are used by the implementer to retrieve a subset of data from a data source.</span></span>  
  
 <span data-ttu-id="fc666-121">A `Cache` objet utilise une implémentation de cette interface pendant la construction pour charger des deux premières pages de données.</span><span class="sxs-lookup"><span data-stu-id="fc666-121">A `Cache` object uses an implementation of this interface during construction to load two initial pages of data.</span></span> <span data-ttu-id="fc666-122">Chaque fois qu’une valeur n’est nécessaire, le cache ignore l’une de ces pages et demande une nouvelle page contenant la valeur de la `IDataPageRetriever`.</span><span class="sxs-lookup"><span data-stu-id="fc666-122">Whenever an uncached value is needed, the cache discards one of these pages and requests a new page containing the value from the `IDataPageRetriever`.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#201)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#201)]  
  
## <a name="the-dataretriever-class"></a><span data-ttu-id="fc666-123">La classe DataRetriever</span><span class="sxs-lookup"><span data-stu-id="fc666-123">The DataRetriever Class</span></span>  
 <span data-ttu-id="fc666-124">L’exemple de code suivant définit la `DataRetriever` classe qui implémente le `IDataPageRetriever` interface pour récupérer des pages de données à partir d’un serveur.</span><span class="sxs-lookup"><span data-stu-id="fc666-124">The following code example defines the `DataRetriever` class, which implements the `IDataPageRetriever` interface to retrieve pages of data from a server.</span></span> <span data-ttu-id="fc666-125">Le `DataRetriever` classe fournit également `Columns` et `RowCount` propriétés, ce qui le <xref:System.Windows.Forms.DataGridView> contrôle utilise pour créer les colonnes nécessaires et ajouter le nombre approprié de lignes vides pour la <xref:System.Windows.Forms.DataGridView.Rows%2A> collection.</span><span class="sxs-lookup"><span data-stu-id="fc666-125">The `DataRetriever` class also provides `Columns` and `RowCount` properties, which the <xref:System.Windows.Forms.DataGridView> control uses to create the necessary columns and to add the appropriate number of empty rows to the <xref:System.Windows.Forms.DataGridView.Rows%2A> collection.</span></span> <span data-ttu-id="fc666-126">Ajout de lignes vides est nécessaire afin que le contrôle se comporte comme s’il contient toutes les données dans la table.</span><span class="sxs-lookup"><span data-stu-id="fc666-126">Adding the empty rows is necessary so that the control will behave as though it contains all the data in the table.</span></span> <span data-ttu-id="fc666-127">Cela signifie que la case de défilement dans la barre de défilement aura la taille appropriée, et l’utilisateur sera en mesure d’accéder n’importe quelle ligne dans la table.</span><span class="sxs-lookup"><span data-stu-id="fc666-127">This means that the scroll box in the scroll bar will have the appropriate size, and the user will be able to access any row in the table.</span></span> <span data-ttu-id="fc666-128">Les lignes sont remplies par le <xref:System.Windows.Forms.DataGridView.CellValueNeeded> Gestionnaire d’événements uniquement lorsqu’ils sont devient visible.</span><span class="sxs-lookup"><span data-stu-id="fc666-128">The rows are filled by the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler only when they are scrolled into view.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#200)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#200)]  
  
## <a name="the-cache-class"></a><span data-ttu-id="fc666-129">La classe de Cache</span><span class="sxs-lookup"><span data-stu-id="fc666-129">The Cache Class</span></span>  
 <span data-ttu-id="fc666-130">L’exemple de code suivant définit la `Cache` (classe), qui gère deux pages de données remplies via une `IDataPageRetriever` implémentation.</span><span class="sxs-lookup"><span data-stu-id="fc666-130">The following code example defines the `Cache` class, which manages two pages of data populated through an `IDataPageRetriever` implementation.</span></span> <span data-ttu-id="fc666-131">Le `Cache` classe définit une exception interne `DataPage` structure qui contient un <xref:System.Data.DataTable> pour stocker les valeurs dans un seul cache qui calcule les index de ligne et page représentent les limites supérieures et inférieures de la page.</span><span class="sxs-lookup"><span data-stu-id="fc666-131">The `Cache` class defines an inner `DataPage` structure, which contains a <xref:System.Data.DataTable> to store the values in a single cache page and which calculates the row indexes that represent the upper and lower boundaries of the page.</span></span>  
  
 <span data-ttu-id="fc666-132">La `Cache` classe charge deux pages de données au moment de la construction.</span><span class="sxs-lookup"><span data-stu-id="fc666-132">The `Cache` class loads two pages of data at construction time.</span></span> <span data-ttu-id="fc666-133">Chaque fois que le <xref:System.Windows.Forms.DataGridView.CellValueNeeded> événement demande une valeur, le `Cache` objet détermine si la valeur est disponible dans un de ses deux pages et, dans ce cas, elle retourne.</span><span class="sxs-lookup"><span data-stu-id="fc666-133">Whenever the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event requests a value, the `Cache` object determines if the value is available in one of its two pages and, if so, returns it.</span></span> <span data-ttu-id="fc666-134">Si la valeur n’est pas disponible localement, le `Cache` objet détermine laquelle de ses deux pages plus éloigné de lignes actuellement affichées et remplace la page par un autre qui contient la valeur demandée qu’il retourne ensuite.</span><span class="sxs-lookup"><span data-stu-id="fc666-134">If the value is not available locally, the `Cache` object determines which of its two pages is farthest from the currently displayed rows and replaces the page with a new one containing the requested value, which it then returns.</span></span>  
  
 <span data-ttu-id="fc666-135">En supposant que le nombre de lignes dans une page de données est le même que le nombre de lignes qui peuvent être affichés à l’écran à la fois, ce modèle permet aux utilisateurs la pagination via la table de retourner efficacement à la dernière page affichée.</span><span class="sxs-lookup"><span data-stu-id="fc666-135">Assuming that the number of rows in a data page is the same as the number of rows that can be displayed on screen at once, this model allows users paging through the table to efficiently return to the most recently viewed page.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#300)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#300)]  
  
## <a name="additional-considerations"></a><span data-ttu-id="fc666-136">Considérations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="fc666-136">Additional Considerations</span></span>  
 <span data-ttu-id="fc666-137">Les exemples de code précédents sont fournis comme démonstration de chargement de données juste-à-temps.</span><span class="sxs-lookup"><span data-stu-id="fc666-137">The previous code examples are provided as a demonstration of just-in-time data loading.</span></span> <span data-ttu-id="fc666-138">Vous devez modifier le code pour vos propres besoins pour obtenir une efficacité maximale.</span><span class="sxs-lookup"><span data-stu-id="fc666-138">You will need to modify the code for your own needs to achieve maximum efficiency.</span></span> <span data-ttu-id="fc666-139">Au minimum, vous devez choisir une valeur appropriée pour le nombre de lignes par page de données dans le cache.</span><span class="sxs-lookup"><span data-stu-id="fc666-139">At minimum, you will need to choose an appropriate value for the number of rows per page of data in the cache.</span></span> <span data-ttu-id="fc666-140">Cette valeur est passée dans le `Cache` constructeur.</span><span class="sxs-lookup"><span data-stu-id="fc666-140">This value is passed into the `Cache` constructor.</span></span> <span data-ttu-id="fc666-141">Le nombre de lignes par page doit être non inférieur au nombre de lignes qui peuvent être affichées simultanément dans votre <xref:System.Windows.Forms.DataGridView> contrôle.</span><span class="sxs-lookup"><span data-stu-id="fc666-141">The number of rows per page should be no less than the number of rows that can be displayed simultaneously in your <xref:System.Windows.Forms.DataGridView> control.</span></span>  
  
 <span data-ttu-id="fc666-142">Pour de meilleurs résultats, vous devez effectuer des tests de performances et facilité d’utilisation pour déterminer les besoins de votre système et de vos utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="fc666-142">For best results, you will need to conduct performance testing and usability testing to determine the requirements of your system and your users.</span></span> <span data-ttu-id="fc666-143">Vous devez impérativement prendre en compte plusieurs facteurs incluent la quantité de mémoire dans les ordinateurs clients exécutant votre application, la bande passante disponible de la connexion réseau utilisée et la latence du serveur utilisé.</span><span class="sxs-lookup"><span data-stu-id="fc666-143">Several factors that you will need to take into consideration include the amount of memory in the client machines running your application, the available bandwidth of the network connection used, and the latency of the server used.</span></span> <span data-ttu-id="fc666-144">La bande passante et la latence doivent être déterminées à des moments d’utilisation maximale.</span><span class="sxs-lookup"><span data-stu-id="fc666-144">The bandwidth and latency should be determined at times of peak usage.</span></span>  
  
 <span data-ttu-id="fc666-145">Pour améliorer les performances de défilement de votre application, vous pouvez augmenter la quantité de données stockées localement.</span><span class="sxs-lookup"><span data-stu-id="fc666-145">To improve the scrolling performance of your application, you can increase the amount of data stored locally.</span></span> <span data-ttu-id="fc666-146">Pour améliorer les temps de démarrage, toutefois, vous devez éviter de charger trop de données initialement.</span><span class="sxs-lookup"><span data-stu-id="fc666-146">To improve startup time, however, you must avoid loading too much data initially.</span></span> <span data-ttu-id="fc666-147">Il pouvez que vous souhaitez modifier la `Cache` classe pour augmenter le nombre de pages de données qu’elle peut stocker.</span><span class="sxs-lookup"><span data-stu-id="fc666-147">You may want to modify the `Cache` class to increase the number of data pages it can store.</span></span> <span data-ttu-id="fc666-148">L’utilisation de plusieurs pages de données peut améliorer l’efficacité de défilement, mais vous devrez déterminer le nombre idéal de lignes dans une page de données, en fonction de la bande passante disponible et la latence du serveur.</span><span class="sxs-lookup"><span data-stu-id="fc666-148">Using more data pages can improve scrolling efficiency, but you will need to determine the ideal number of rows in a data page, depending on the available bandwidth and the server latency.</span></span> <span data-ttu-id="fc666-149">Avec des pages plus petites, le serveur est plus accessible, mais nécessite moins de temps pour retourner les données demandées.</span><span class="sxs-lookup"><span data-stu-id="fc666-149">With smaller pages, the server will be accessed more frequently, but will take less time to return the requested data.</span></span> <span data-ttu-id="fc666-150">Si la latence est un problème que la bande passante, vous souhaiterez probablement utiliser les pages de données plus volumineux.</span><span class="sxs-lookup"><span data-stu-id="fc666-150">If latency is more of an issue than bandwidth, you may want to use larger data pages.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fc666-151">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="fc666-151">See Also</span></span>  
 <xref:System.Windows.Forms.DataGridView>  
 <xref:System.Windows.Forms.DataGridView.VirtualMode%2A>  
 [<span data-ttu-id="fc666-152">Réglage des performances dans le contrôle DataGridView Windows Forms</span><span class="sxs-lookup"><span data-stu-id="fc666-152">Performance Tuning in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/performance-tuning-in-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="fc666-153">Meilleures pratiques pour la mise à l'échelle du contrôle DataGridView Windows Forms</span><span class="sxs-lookup"><span data-stu-id="fc666-153">Best Practices for Scaling the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/best-practices-for-scaling-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="fc666-154">Mode virtuel dans le contrôle DataGridView Windows Forms</span><span class="sxs-lookup"><span data-stu-id="fc666-154">Virtual Mode in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/virtual-mode-in-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="fc666-155">Procédure pas à pas : implémentation du mode virtuel dans le contrôle DataGridView Windows Forms</span><span class="sxs-lookup"><span data-stu-id="fc666-155">Walkthrough: Implementing Virtual Mode in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/implementing-virtual-mode-wf-datagridview-control.md)  
 [<span data-ttu-id="fc666-156">Guide pratique pour implémenter le mode virtuel avec le chargement immédiat des données dans le contrôle DataGridView Windows Forms</span><span class="sxs-lookup"><span data-stu-id="fc666-156">How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md)
